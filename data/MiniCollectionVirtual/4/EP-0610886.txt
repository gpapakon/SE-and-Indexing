<DOC>
<DOCNO>EP-0610886</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Microcomputer for IC card
</INVENTION-TITLE>
<CLASSIFICATIONS>G06F1124	G07F710	G01R31317	G06F1214	G06F1100	G06F1214	G01R3128	G06F1578	G06F1122	G07F710	G06F1100	G06K19073	G06F1122	G06F1124	G06F1576	G06K19073	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G06F	G07F	G01R	G06F	G06F	G06F	G01R	G06F	G06F	G07F	G06F	G06K	G06F	G06F	G06F	G06K	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G06F11	G07F7	G01R31	G06F12	G06F11	G06F12	G01R31	G06F15	G06F11	G07F7	G06F11	G06K19	G06F11	G06F11	G06F15	G06K19	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
It is an object to obtain a microcomputer for an IC card 
arranged in such a manner that only a user mode can be performed 

after the microcomputer has been shipped to a user. A region on 
which shipment data representing a fact that the microcomputer 

has been shipped is written at the time of the shipment is 
formed in a test EEPROM region. A shipment confirmation routine 

for confirming whether or not the shipment data has been written 
is disposed to be performed before execution of a branch routine 

for branching to each program in accordance with an execution 
command supplied from outside. If the fact that the shipment 

data has been written on the test EEPROM region has been 
confirmed in a shipment confirmation routine, branching is 

limited to only the user mode. 

</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
MITSUBISHI ELECTRIC CORP
</APPLICANT-NAME>
<APPLICANT-NAME>
MITSUBISHI DENKI KABUSHIKI KAISHA
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
ASAMI KAZUO
</INVENTOR-NAME>
<INVENTOR-NAME>
ASAMI, KAZUO
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
This invention relates to a microcomputer for an IC
card, and more particularly to a microcomputer including a
user program for performing various processes and a test
program for performing a test (a product test) of the
microcomputer.An IC card including a microcomputer of the foregoing
type has been disclosed in, for example, EP-A-0 411 255.
Furthermore, ELEKTRONIK, vol. 37, no. 22, 28 October 1988,
MUENCHEN DE pages 204-208, XP000051110 TIMM V. 'Mit einem
EEPROM an Bord' shows the use of an EEPROM as a nonvolatile
memory for data used by a microcomputer.It is known that a test program performs a product
test to which the microcomputer is subjected, the test
program having a function capable of giving access to an
arbitrary address of all regions of the microcomputer to
perform satisfactorily the function test. The test program
is usually used by a manufacturer (of the microcomputer) or
a publisher, and execution of the test program and access
to the same must be secured by means of collation of:
passwords or the like after the shipment in order to
prevent abuse of the test program such that access is,
through the test program, intended to be given to a region
of a program of another person to copy or falsify the data. 
Fig. 13 is a functional block diagram of a conventional
microcomputer for, an IC card of the foregoing type.
Referring to Fig. 13, reference numeral 1 represents a
microcomputer for an IC card (hereinafter called a
"microcomputer for a card"), 2 represents a CPU for
processing data, 3 represents a mask ROM which is a
nonvolatile memory in which a variety of programs are
stored, 4 represents a RAM which is a volatile memory for
temporarily storing data and 5 represents an input/output
control circuit for controlling data input and output to
and from an external device. Reference numeral 6 represents
an EEPROM which is a write-enable nonvolatile memory for
storing data of the results of the process or the like and
7 represents a bus for mutually connecting the foregoing
elements. Reference numeral 8 represents a power source
terminal (a Vcc terminal), 9 represents a ground terminal
(a GND terminal), 10 represents a reset terminal (a RST
terminal), 11 represents a clock terminal (a CLK terminal)
and 12 represents an input/output terminal (an I/O
terminal). The foregoing terminals form a terminal group
for establishing electrical contact with an external
device.Fig. 14 illustrates a flow chart of the operation of
the conventional microcomputer for a card. Figs. 15A and
15B illustrate
</DESCRIPTION>
<CLAIMS>
A microcomputer (
1a
) for an IC card comprising:

a mask ROM (
3a
) for storing a user program (
31
), a test
program (
32
) and a branch routine (
34
) for selectively
branching to said programs in accordance with an execution

command;
a CPU 
(2)
 for processing data in accordance with said
routine and said programs stored in said mask ROM;
a RAM (
4
) for temporarily storing data;
an EEPROM (
6a
) which stores data which must be memorized
and which includes a test EEPROM region (
61
) which cannot be
accessed from said user program;
an input/output control circuit (
5
) for controlling
input/output of data to and from outside;
a terminal group (
8-12
) for establishing the electrical
connections with outside; and
a bus (
7
) for mutually connecting said mask ROM (
3a
), said CPU (
2
), said RAM (
4
), said EEPROM (
6a
) and said input/output control circuit (
5
), wherein
said terminal group includes a power source terminal 
(8)
;

   
characterized by
voltage detection means (
13
) for detecting a fact that the
power supply voltage of said power source terminal has not been

lowered;
said mask ROM including a shipment confirmation routine
(
36
) to be performed before said branch routine is performed,
and further including a voltage detection routine (
37
) for
detecting the power supply voltage of said power source

terminal before or after said shipment confirmation routine has
been performed; and
said test EEPROM region including a region on which
shipment data (
612
) representing that said microcomputer has
been shipp
ed is written; 
wherein branching to said user program takes place without
exception in a case where lowering of said power supply voltage

of said power source terminal has been detected in said voltage
detection routine even if a fact that said shipment data has

not been written on said test EEPROM region has been confirmed
in said shipment confirmation routine.
A microcomputer according to claim 1, 
characterized in
that
 said mask ROM is capable of storing also a burn-in test
program (
33
) and a burn-in data confirmation routine (
38
) to be
performed before branching to said burn-in test program takes

place, said test EEPROM region includes a region on which burn-in
data (
613
) for declaring that said burn-in test
program has been previously executed is written, and branching to said burn-in

test program takes place without exception if a fact has been
confirmed in said burn-in data confirmation routine that said

burn-in data has not been written in said test EEPROM region.
A microcomputer according to claim 2, 
characterized by
 said
burn-in test program having a plurality of modes (
S72-S75
);
said terminal group including an input/output terminal (
12
);
and said burn-in test program including a discrimination signal

output step (
S10; S76-S78
) in which a mode discrimination
signal (
15
) representing a mode among said plurality of said
modes which is being executed is transmitted to outside through

said input/output terminal.
</CLAIMS>
</TEXT>
</DOC>
