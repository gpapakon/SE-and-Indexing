<DOC>
<DOCNO>EP-0630105</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Voltage controlled attenuator for speakerphones.
</INVENTION-TITLE>
<CLASSIFICATIONS>H03F345	H03F345	H03G100	H03G100	H03G300	H03G300	H03G330	H03G330	H03G700	H03G700	H03H1102	H03H1124	H04M160	H04M160	H04M908	H04M908	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>H03F	H03F	H03G	H03G	H03G	H03G	H03G	H03G	H03G	H03G	H03H	H03H	H04M	H04M	H04M	H04M	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>H03F3	H03F3	H03G1	H03G1	H03G3	H03G3	H03G3	H03G3	H03G7	H03G7	H03H11	H03H11	H04M1	H04M1	H04M9	H04M9	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
An integrated circuit voltage controlled attenuator 
which reduces control voltage feedthrough by employing NPN 

transistors for both sets of current steering elements is 
disclosed. A pair of emitter coupled NPN transistors are 

provided, connected to a common current source. The collector 
currents of these transistors form input currents of two 

precision PNP current mirrors. Output currents from the 
mirrors are coupled to a second pair of emitter coupled NPN 

transistors, having a current source connected to their 
emitters, whose value is adjusted by feedback to exactly match 

the sum of output currents of the precision mirrors. A single 
set of control voltages is supplied to both sets of emitter 

coupled NPN transistors. Signal input and output current is 
coupled from the precision current source output legs and made 

available in voltage form through operational amplifiers which 
perform input voltage to current, and output current to voltage 

conversions, respectively. An integrated control voltage 
generation technique is also disclosed, which provides accurate 

gain settings for a voltage controlled attenuator without the 
need for absolute value external components or signal feedback 

between the voltage controlled attenuator and control circuit. 

</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
EXAR CORP
</APPLICANT-NAME>
<APPLICANT-NAME>
EXAR CORP
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
ROBINSON NEIL
</INVENTOR-NAME>
<INVENTOR-NAME>
ROBINSON NEIL
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to voltage controlled 
attenuator circuits, and a means to provide accurate gain 
settings for such attenuators. In particular, the invention 
relates to such circuits for use in integrated circuit 
speakerphone systems. Voltage controlled attenuators find applications in a 
wide variety of systems, to adjust the amplitude of signals 
passed through such systems according to the magnitude of a 
control signal. For example, in a speakerphone circuit, 
attenuators are included in both the transmit and receive 
channels to provide half duplex communication. The transmit 
and receive attenuators are typically operated in a 
complementary manner, while one is at maximum gain the other is 
at maximum attenuation and vice versa. The setting of each 
attenuator is adjusted so that the difference between the 
levels remains the same. Using this technique a constant loss 
is inserted between the two channels and prevents instability 
that would otherwise occur, due to signal coupling between the 
loudspeaker and microphone, or sidetone through a hybrid 
circuit. One requirement of attenuators used in a such an 
arrangement is accurate gain settings to ensure consistent 
performance of the speakerphone system. Large variations of 
the gain level of each attenuator makes the inserted loss 
between the two channels unpredictable and presents 
difficulties maintaining the stability of the system. In a typical speakerphone, the gain setting of a 
channel is dependent upon the detection of speech within that 
channel. If a far end talker is speaking, the receive signal 
is greater than the transmit signal, and the transmit 
attenuator should be set to maximum loss while the receive 
attenuator is set to maximum gain. The reverse is true if the 
mirror-end talker is speaking. By monitoring the amplitudes of  
 
the signals in both channels, a control circuit may be 
developed to determine which channel is active and adjust the 
gains accordingly. A further requirement of an attenuator used 
in a speakerphone is the need to minimize the feedthrough of 
control signal into the audio path. Feedthrough generates an 
audible "thump" in the speech channel which occurs when 
switching from one channel to the other. With sufficient 
magnitude, the feedthrough causes errors in switching due to 
its detection as a false speech signal. The primary source of 
feedthrough is gain dependent offset within the attenuator. Fig. 2 illustrates an example of a prior art voltage 
controlled attenuator. An input
</DESCRIPTION>
<CLAIMS>
A voltage controlled attenuator comprising: 
   first and second NPN transistors having emitters 

coupled together; 
   a current source coupled to said emitters of said 

first and second NPN transistors; 
   a first PNP transistor having a collector coupled to 

a collector of said first NPN transistor; 
   a second PNP transistor having a collector and base 

coupled to an emitter of said first PNP transistor, and an 
emitter coupled to a first voltage source; 

   a third PNP transistor having a collector coupled to 
a collector of said second NPN transistor; 

   a fourth PNP transistor having a collector and base 
coupled to an emitter of said third PNP transistor, and an 

emitter coupled to said first voltage source; 
   an input to said attenuator coupled to said collector 

of said first NPN transistor; 
   an output to said attenuator coupled to said 

collector of said second NPN transistor; 
   a first current mirror having a first leg coupled to 

a base of said first PNP transistor, said first and second PNP 
transistors being a second leg of said first current mirror; 

   a second current mirror having a first leg coupled to 
a base of said third PNP transistor, said third and fourth PNP 

transistors being a second leg of said second current mirror; 
and 

   first and second control inputs coupled to said first 
legs of said first and second current mirrors, respectively. 
The voltage controlled attenuator of claim 1 
further comprising: 

   a first resistor having a terminal connected to an 
emitter of said second PNP transistor and a second terminal 

connected to a first voltage source; and
 

   a second resistor having a terminal connected to an 
emitter of said fourth PNP transistor and a second terminal 

connected to said first voltage source. 
The voltage controlled attenuator of claim 1 
wherein said first control input is also coupled to a base of 

said first NPN transistor and said second control input is 
coupled to a base of said second NPN transistor. 
The voltage controlled attenuator of claim 3 
wherein said first and second control inputs are a differential 

control voltage input. 
The voltage controlled attenuator of claim 1 
wherein said first and second control inputs are coupled to the 

bases of third and fourth NPN transistors coupled to said first 
legs of said current mirrors. 
The voltage controlled attenuator of Claim 5 
wherein said first control input is also coupled to a base of 

said third NPN transistor and said second control input is also 
coupled to a base of said fourth NPN transistor. 
The voltage controlled attenuator of claim 6 
wherein said first and second control inputs are a differential 

control voltage input. 
The voltage controlled attenuator of claim 7 
further comprising: 

   an input amplifier having an input coupled to said 
input of said attenuator and an output coupled to the base of a 

fifth NPN transistor in said first current source; 
   a second current source having a sixth NPN transistor 

with a base coupled to a bias voltage and collector coupled to 
the emitters of said third and fourth NPN transistors; and 

   a resistor having a first terminal connected to said 
input of said input amplifier and a second terminal available 

as a signal input. 
The voltage controlled attenuator of claim 8 
further comprising: 

   an output amplifier having an input coupled to said 
output of said attenuator; and 

   a resistor having a first terminal connected to said 
input of said output amplifier and a second terminal connected 

to an output of said output amplifier. 
A control circuit for generating a differential 
gain control signal for a voltage controlled attenuator in 

response to receive and transmit detect signals in a 
speakerphone circuit, comprising: 

   means for sourcing current in response to said 
receive detect signal, having an output coupled to a control 

node; 
   means for sinking current in response to said 

transmit detect signal, having an output coupled to a control 
node; 

   a capacitor coupled to said control node; 
   a differential amplifier having a first input coupled 

to said control node, a second input connected to a reference 
voltage, and outputs providing said differential gain control 

signal; 
   first and second emitter coupled transistors having 

bases coupled to said differential amplifier outputs, a 
resistor of value R coupled to a collector o
f said first 
emitter coupled transistor, a resistor of value NR coupled to a 

collector of said second emitter coupled transistor; 
   a first operational amplifier having first and second 

inputs coupled to said collectors of said first and second 
emitter coupled transistors, respectively; and 

   a third transistor having a base coupled to an output 
of said first operational amplifier and a collector coupled to 

said control node. 
The control circuit of claim 10 further 
comprising a resistor coupled to said control node. 
The control circuit of claim 10 wherein said 
first, second and third transistors are NPN transistors, and 

further comprising: 
   first and second PNP transistors having bases coupled 

to the outputs of said differential amplifier; 
   third and fourth emitter coupled NPN transistors 

having bases coupled to the emitters of said first and second 
PNP transistors, a resistor of value NR coupled to a collector 

of said third emitter coupled transistor, a resistor of value R 
coupled to a collector of said fourth emitter coupled 

transistor; 
   a second operational amplifier having first and 

second inputs coupled to said collectors of said third and 
fourth emitter coupled transistors, respectively; and 

   a PNP transistor having a base coupled to an output 
of said second operational amplifier and a collector coupled to 

said control node. 
</CLAIMS>
</TEXT>
</DOC>
