<DOC>
<DOCNO>EP-0615674</DOCNO> 
<TEXT>
<INVENTION-TITLE>
NETWORK ECHO CANCELLER
</INVENTION-TITLE>
<CLASSIFICATIONS>H04M160	H04M908	H04B323	G10L1900	H04M908	H04M160	G10L1900	H04B323	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>H04M	H04M	H04B	G10L	H04M	H04M	G10L	H04B	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>H04M1	H04M9	H04B3	G10L19	H04M9	H04M1	G10L19	H04B3	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
An echo canceller and method for cancelling in a return channel signal an echoed receive channel signal where the echoed receive channel signal is combined by an echo channel (142) with an input return channel signal. A control unit (152) determines from the receive channel signal, the combined signal, and first and second echo residuals, one of a plurality of control states wherein a first control state is indicative of a receive channel signal above a first predetermined energy level, wherein when the control unit (152) is in the first control state it generates the first control signal and generates the second control signal when at least one of a first energy ratio of the first echo residual signal and the combined signal exceed a predetermined level.
</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
QUALCOMM INC
</APPLICANT-NAME>
<APPLICANT-NAME>
QUALCOMM INCORPORATED
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
SIH GILBERT C
</INVENTOR-NAME>
<INVENTOR-NAME>
SIH, GILBERT, C.
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to communication systems. More
particularly, the present invention relates to a novel and improved
method and apparatus for cancelling echos in telephone systems.Every current land-based telephone is connected to a central office
by a two-wire line (called the customer or subscriber loop) which supports
transmission in both directions. However, for calls longer than about
35 miles, the two directions of transmission must be segregated onto
physically separate wires, resulting in a four-wire line. The device that
interfaces the two-wire and four wire segments is called a hybrid. A typical
long-distance telephone circuit can be described as being two-wire in the
subscriber loop to the local hybrid, four-wire over the long-haul network
to the distant hybrid, and then two-wire to the distant speaker.Although the use of hybrids facilitates long distance speech
transmission, impedance mismatches at the hybrid may result in echos.
The speech of the speaker A is reflected off the distant hybrid (the hybrid
closest to the speaker B) in the telephone network back toward the speaker
A, causing the speaker A to hear an annoying echo of his/her own voice.
Network echo cancellers are thus used in the land-based telephone
network to eliminate echos caused by impedance mismatches at the
hybrids and are typically located in the central office along with the hybrid.
The echo canceller located closest to speaker A or B is thus used to cancel
the echo caused by the hybrid at the other end of the call.Network echo cancellers, employed in the land-based telephone
system, are typically digital devices so as to facilitate digital transmission of
the signals. Since the analog speech signals need to be converted to digital
form, a codec located at the central office is typically employed. The analog
signals provided from telephone A (speaker A) to central office A are
passed through hybrid A and are converted to digital form by codec A. 
The digital signals are then transmitted to central office B where they are
provided to codec B for conversion to analog form. The analog signals are
then coupled through hybrid B to the telephone B (speaker B). At the
hybrid B, an echo of the speaker A's signal is created. This echo is encoded
by the codec B and transmitted back to the central office A. At central
office A an echo canceller removes the return echo.In the conventional analog cellular telephone system, echo
cancellers are also employed and are typically located at the base station.
These echo
</DESCRIPTION>
<CLAIMS>
An echo canceller for cancelling in a return channel signal an
echoed receive channel signal where the echoed receive channel
 signal is
combined by an echo channel (142) with an input return channel signal, the

echo canceller comprising:

first filter means (156) for generating first filter coefficients, generating a
first echo estimate signal with the first filter coefficients, and updating the

first filter coefficients in response to a first filter control signal;
first summing means (148) for subtracting the first echo estimate signal
from a combined return channel and echo receive channel signal to

generate a first echo residual signal;
second filter means (158) for generating second filter coefficient,
generating a second echo estimate signal with the second filter coefficients,

and updating the second filter coefficients in response to a second filter
control signal;
second summing means (150) for subtracting the second echo estimate
signal from the combined signal to generate a second echo residual signal,

and providing upon the return channel the second echo residual signal;
and
control means (152) for determining from the receive channel signal, the
combined signal, and the first and second echo residual signals, one of a

plurality of control states wherein a first control state is indicative of a
receive channel signal above a first predetermined energy level, wherein

when the control means (152) is in the first control state generating the first
control signal and generating the second control signal when at least one

of a first energy ratio of the first echo residual signal and the combined
signal and a second energy ratio of the second echo residual signal and the

combined signal exceed a first predetermined energy ratio level.
The echo canceller of Claim 1 wherein the control means (152)
when in the first control state is arranged to determine the first predetermined energy

ratio level by, determining if the second energy ratio is greater than a sum
of a first threshold value and a first predetermined fixed value, and if so to

set the first predetermined energy ratio level to the greater of the first
threshold value and a difference of the second energy ratio and the first 

predetermined fixed value, and if the second energy ratio is less than the
sum of the first threshold value and the first predetermined fixed value,

and to set the first predetermined energy ratio level to a second
predetermined fixed value when the second energy ratio is less than the

difference between the second predetermined fixed value and a third
predetermined fixed value.
The echo canceller of Claim 1 wherein the control means (152)
further is arranged to determine a second control state in the plurality of control states,

the second control state indicative of the input return channel signal
above a second predetermined energy level, and when the control means (152)

is in the second control state to inhibit the generation of both the first and
second control signals.
The echo canceller of Claim 1 wherein the control means (152)
further is arranged to determine a second control state in the plurality of control states,

the second control state indicative of the receive channel signal above the
first predetermined energy level and the input return channel signal is

above a second predetermined energy level, and when the control means
is in the second control state to generate the first control signal.
The echo canceller of Claim 4 wherein the control means (152)
when in the second control state is arranged to generate the first control signal when a

ratio of the receive channel signal energy and combined signal is greater
than a third predetermined energy ratio level.
The echo canceller of Claim 1 further comprising output
means for generating a noise signal, providing the noise signal in

replacement of the second echo residual signal upon the return channel in
response to a noise select signal, wherein the control means (152) when in the

first control state is arranged to further generate the noise select signal.
The echo canceller of Claim 6 wherein the control means (152)
when in the first control state is arranged to generate the noise select signal when a

ratio of the receive channel signal energy and combined signal is greater
than a third predetermined energy ratio level. 
The echo canceller of Claim 7 wherein the control means (152)
further is arranged to determine a second control state in said plurality of control states,

the second control state indicative of both the receive channel signal and
the input return channel signal respectively below second and third

predetermined energy levels, and when the control means (152) is in the second
control state to inhibit the generation of the first and second control

signals and wherein the output means comprises:

noise analysis means (166) for, when the control means (152) is in the second
control state, performing a linear predictive coding analysis of the second

echo residual signal and providing an analysis output;
noise synthesis means (168) for receiving the analysis output and
synthesizing the noise signal representative of the second echo residual

signal; and
switch means (164) for providing an output of the second echo residual
signal upon the return channel and responsive to the noise select signal

for providing the noise signal upon the return channel in replacement of
the second echo residual signal.
</CLAIMS>
</TEXT>
</DOC>
