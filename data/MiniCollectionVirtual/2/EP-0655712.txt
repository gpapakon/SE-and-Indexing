<DOC>
<DOCNO>EP-0655712</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Image processing method and apparatus
</INVENTION-TITLE>
<CLASSIFICATIONS>G06T300	G06T300	G06T700	G06T760	G06T760	H04N1387	H04N1387	G06T700	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G06T	G06T	G06T	G06T	G06T	H04N	H04N	G06T	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G06T3	G06T3	G06T7	G06T7	G06T7	H04N1	H04N1	G06T7	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
In an image processing apparatus, a plurality of 
substantially corresponding points are designated on a 

reference image and a peripheral image. The degree of 
coincidence is detected between a window in the 

peripheral image with a corresponding point as the 
center, and windows successively cut from the reference 

image, whose center is a corresponding point. The 
corresponding point at the center of the window having 

the highest degree of coincidence in the reference image 
is moved and an offset between this corresponding point 

and the corresponding point on the peripheral image is 
detected. When a corresponding point whose offset is 

greater than a threshold exists, the peripheral image is 
subjected to an affine transformation using a 

corresponding point on the reference image whose offset 

is less than the threshold. The processing is repeated 
by using the corresponding point on the transformed 

peripheral image. The two images are merged by an 
affine transformation when the offsets of all 

corresponding points become smaller than the threshold. 

</ABSTRACT>
<APPLICANTS>
</APPLICANTS>
<INVENTORS>
</INVENTORS>
<DESCRIPTION>
This invention relates to an image processing
method and apparatus for pasting together two or more
images.A prior-art image processing apparatus is available
for pasting together and connecting a plurality of
images at their common portions. In general, in an
image processing apparatus of this kind, the operator
uses a pointing device such as a mouse to designate
corresponding points in an area common to two images,
namely a pasted image and an image to be pasted. Affine
transformation coefficients are obtained in such a
manner that the designated corresponding points of both
images are made to coincide, and the pasted image is
subjected to an affine transformation using the affine
transformation coefficients obtained.In the above-described image processing apparatus,
however, since the affine coefficients are obtained in
accordance solely with the designated corresponding
points, the correct affine coefficients cannot be
obtained unless the corresponding points are designated
accurately. Accordingly, since the operator is forced
to designate accurate corresponding points, a large load 
is placed upon the operator.A concern of the present invention is to provide an
image processing method and apparatus in which, when a
plurality of images are pasted together, it is possible
to find accurate corresponding points from designated
corresponding points and obtain affine coefficients on
the basis of the found corresponding points, thereby
reducing the load upon the operator when the
corresponding points are being designated.Another concern of the present invention is to
provide an image processing method and apparatus in
which, when corresponding points designated at the
pasting together of a plurality of images include
corresponding points whose positions are offset by a
large margin, the designated points can be corrected.A further concern of the present invention is to
provide an image processing method and apparatus in
which it is possible to find appropriate positions of
corresponding points, which have been designated on
first and second images, in a prescribed zone which
includes the designated corresponding points, and to
correct the positions of the corresponding points,
thereby making it possible to paste together images
precisely.Yet another concern of the present invention is to 
provide an image processing method and apparatus in
which it is possible to acquire, from a plurality of
partial images extracted from a prescribed zone which
includes a corresponding point of a first image, a
partial
</DESCRIPTION>
<CLAIMS>
An image processing apparatus comprising:

display means (5) for displaying first and second
images which are to be pasted together;
setting means (7) for setting one or more first
points on the first image and one or more second points

on the second image, each of the second points being
associated with an individual first point; and
transform means (3, S4) for transforming the second
image on the basis of matching each pair of first and

second points, 
characterised in that
said setting means (7) are manual so that an
operator can set each of the second points so as to

correspond coarsely to its associated first point; and
that the apparatus further comprises:


acquisition means (3, S5) for acquiring with respect
to a selected point of one or more second points of the

transformed second image, a first partial area (304) of
a first predetermined size which includes at its centre

selected point;
determination means (3, S6) for determining a
partial area of said first predetermined size having the

maximum correlation with respect to said first partial
area (304), within a search area (305) of a second

predetermined size centred on the corresponding first 
point of the first image;
update means (3, S6) for updating with respect to
the first point the centre of the partial area with the

maximum correlation as a new first point; and
merging means (3, S9) for merging the first and
second images into a merged image once the distances

between each pair of the second points and the associated
new first points on the merged image is smaller than a

threshold.
Apparatus according to claim 1 wherein the
determination and update means are adapted to act on a

plurality of first and new points.
Apparatus according to claim 1 or claim 2, wherein
said merging means includes transforming means for

performing an affine transformation of the first image to
generate the initial merger.
Apparatus according to any one of claims 1 to 3,

wherein said determining means includes:

cutting means for cutting out from the search area
a plurality of partial images each of which having the

first predetermined size; and
selection means for selecting the second partial 
image from among the plurality of cut out partial images.
Apparatus according to any preceding claim, wherein
said acquisition means includes second transforming means

for performing an affine transformation on the first
image and the first partial image (304).
Apparatus according to any preceding claim, wherein
the first and second images are color images and the

correlation between the first and second images is an
average of the correlation acquired for each color

component of the color image.
Apparatus according to claim 1 or claim 3, wherein
said merging means includes:


distance determination means (3) for determining
whether each distance between respective one of the first

points and the new second point corresponding thereto is
smaller than the threshold; and
correcting means (3) which in the case where
plurality of pairs of the first points and the second

points corresponding thereto includes a pair for which
the distance between is not smaller than the threshold

are adapted to correct the position of said first point
in such a manner that said distance becomes smaller than 

the predetermined value;

   wherein said acquisition means, said determination
means and said distance determination means are adapted

to re-execute their respective operations using the
corrected position.
Apparatus according to claim 7, wherein said
correcting means includes:


third transforming means which, in the case where
the plurality of pairs of the first points and

corresponding second points includes a pair for which the
distance therebetween is not smaller than the threshold,

is adapted to obtain a second transformed image by
transforming the first image using a pair of

corresponding first and second points for which the
distance is smaller than the threshold; and
altering means for altering the position of the
second point on the basis of the position of each

corresponding first point located on the second
transformed image.
Apparatus according to claim 8, wherein said merging
means is adapted to merge the first and second images on

the basis of finally obtained results of transformation
by said third transformation means. 
Apparatus according to claim 8 or claim 9, wherein
said altering means is adapted to alter the position of

the second point of the pair for which the distance is
not smaller than the threshold to the position of the

corresponding first point on the second transformed
image.
Apparatus according to claim 8, wherein said
altering means is adapted to alter all positions of the

second points to the positions of the corresponding first
points on the second transformed image.
Apparatus according to claim 8, and adapted to
reduce the second predetermined size of the search area

whenever determination by said determining means is re-executed.
Apparatus according to any one of claims 7 to 12,
further comprising notification means which, in the case

where the number of pairs of corresponding points for
which the distances are smaller than the threshold is

insufficient for execution of the affine transformation
by said third transformation means, are adapted to give

notification to this effect to a user. 
Apparatus according to any one of claims 8 to 12,
wherein in the case that the number of pairs of

corresponding points for which the distances are smaller
than the threshold is insufficient for executing the

affine transformation by said third transformation means,
selection of a pair of corresponding points to be used in

the affine transformation is performed based upon a
second threshold greater than the threshold.
An image processing method comprising:

displaying first and second images which are to be

pasted together;
setting one or more first points on the first image
and one or more second points on the second image, each

of the second points being associated with an individual
first point; and
transforming the second image on the basis of
matching each pair of first and second points,
characterised in that
said setting means are manual so that an operator
sets each of the second points so as to correspond

coarsely to its associated first point; the method
further comprising:


acquiring with respect to a selected point of one or
more second points of the transformed second image, a 

first partial area (304) of a first predetermined size
which includes at its centre selected point;
determining a partial area of said first
predetermined size having the maximum correlation with

respect to said first partial area (304), within a search
area (305) of a second predetermined size centred on the

corresponding first point of the first image;
updating with respect to the first point the centre
of the partial area with the maximum correlation as a new

first point; and
for merging the first and second images into a
merged image once the distances between each pair of

the second points and the associated new first points on
the merged image is smaller than a threshold.
A method according to claim 2, wherein said first
and second images are merged so that the distances of a

plurality of first and new points are smaller than the
threshold.
A method according to claim 15 or claim 16, wherein
said first and second images are merged by performing an

affine transformation.
A method according to claim 16 or claim 17, wherein 
said determining step includes:


cutting out from the search area a plurality of
partial images each of which have the first predetermined

size; and
selecting the partial image from among the plurality
of cut out partial images which has the maximum

correlation with said search area (305).
A method according to any one of claims 15 to 18,
means including performing an affine transformation on

the first image and the first partial area (304).
A method according to any one of claims 15 to 19,
wherein the first and second images are color images and

the correlation between the first and second images is an
average of the correlation acquired for each color

component of the color image.
A method according to claim 15, 16 or 17, including
determining whether the distance between respective ones

of the first points and the new second points
corresponding thereto is smaller than the threshold; and


correcting in the case where the plurality of pairs
of the first points and the second points corresponding

thereto includes a pair for which the distance 
therebetween is not smaller than the threshold, the

position of said first point of such a pair in such a
manner that said distance becomes smaller than the

predetermined value;

   wherein said acquisition, said determination and
said distance determination are re-executed using the

corrected position.
A method according to claim 21, wherein said
correction includes:


a third transforming step which, in the case where
the plurality of pairs of the first points and

corresponding second points includes a pair for which the
distance therebetween is not smaller than the threshold,

obtains a second transformed image by transforming the
first image using a pair of corresponding first and

second points for which the distance is smaller than the
threshold; and
altering the position of the second points on the
basis of the position of each corresponding first point

located on the second transformed image.
A method according to claim 22, wherein said merging
of the first and second images is carried out on the

basis of the finally obtained results of transformation 
by said third transformation step.
A method according to claim 22 or claim 23, said
alter step alters the position of the second point of the

pair for which the distance is not smaller than the
threshold to the position of the corresponding first

point on the second transformed image.
A method according to claim 22, wherein said
alteration step alters all positions of the second points

to the positions of the corresponding first points on the
second transformed image.
A method according to any one of claims 15 to 25,
adapted to reduce the second predetermined size of the

search area whenever determination by said determining
means is re-executed.
A method according to any one of claims 15 to 25,
further comprising utilising notification means which, in

the case where the number of pairs of corresponding
points for which the distances are smaller than the

threshold is insufficient for execution of the affine
transformation are adapted to give notification to this

effect to a user. 
A method according to any one of claims 15 to 26,
wherein in the case that the number of pairs of

corresponding points for which the distances are smaller
than the threshold is insufficient for executing the

transformation step, selection of a pair of corresponding
points to be used in the affine transformation in said

third transforming step is performed based upon a second
threshold greater than the initial threshold.
</CLAIMS>
</TEXT>
</DOC>
