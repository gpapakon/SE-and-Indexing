<DOC>
<DOCNO>EP-0631442</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Video coding and decoding apparatuses with an improved motion vector coding method
</INVENTION-TITLE>
<CLASSIFICATIONS>H04N750	H04N736	G06T900	H04N734	H04N732	H04N726	H04N732	H04N764	H04N730	H04N726	H04N730	H04N750	H04N734	G06T900	H04N736	H04N768	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>H04N	H04N	G06T	H04N	H04N	H04N	H04N	H04N	H04N	H04N	H04N	H04N	H04N	G06T	H04N	H04N	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>H04N7	H04N7	G06T9	H04N7	H04N7	H04N7	H04N7	H04N7	H04N7	H04N7	H04N7	H04N7	H04N7	G06T9	H04N7	H04N7	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
In a digital video coding and decoding apparatus, 
motion vectors are stored in motion vector frame store. 

Thereby the transmission of the differences of the motion 
vectors of the actual frame and the previous frame can be 

effected. 
Furthermore, this difference can be sent to a thresholding 
device to decide on coding it either with a VLC or a Fixed Length Code. 
In case of transmission errors, the decoder can use the motion vectors 
of the previous frame to replace erroneous motion vectors. 


</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
MATSUSHITA ELECTRIC IND CO LTD
</APPLICANT-NAME>
<APPLICANT-NAME>
MATSUSHITA ELECTRIC INDUSTRIAL CO., LTD.
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
MASAKI SHOICHI
</INVENTOR-NAME>
<INVENTOR-NAME>
MASAKI, SHOICHI
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to an improvement in
coding/decoding operations for motion vectors, which indicate
transition of moving pictures in consecutive frames, in order
to lessen image deterioration caused by transmission errors in
video coding apparatuses and video decoding apparatuses.The video coding apparatuses code the difference between
motion vectors and the video decoding apparatuses decode the
difference between images which are closely related.Various arts for processing digitalized motion pictures
have been realized these days. Generally, picture data are
transmitted in a large amount so that it is necessary to
compress or reduce the data in volume in order to make them
available for record or transmission.One example of such a method for coding motion pictures
with the use of motion vectors is "ITU (International
Telecommunication Union) Recommendation H.261 Video Codec for
Audiovisual Services".According to this method, a frame which is to be coded
(hereinafter a target frame) is divided into several blocks and
then a motion picture in a block is compared with a motion 
picture in an area for one block in a frame preceding the
target frame (hereinafter a previous frame), thereby detecting
a motion vector. Since this motion vector indicates the area
for one block in the previous frame which has the closest
correlation with the block in the target frame, the difference
between the block and the area and the difference between the
motion vectors are both coded for transmission. Various
corporations have been produced various LSIs having such a
coding function such as IIT Vision Processor, NEC VSP3,
Mitsubishi DISP, OKI MSM752, and Matushita VDSP(MN195901).FIG. 1 shows the construction of a conventional video
coding apparatus based on the above-mentioned ITU
Recommendation H.261.The apparatus includes a motion picture signal reception
terminal 711, a convention unit 712, a motion vector detection
unit 713, a frame memory 714, a motion compensation unit 715,
a delay unit 716, a differential unit 717, a quantization unit
718, an inverse quantization unit 719, an addition unit 71a,
a variable length coding unit 71b, a differential motion vector
detection unit 71c, a motion vector variable length coding unit
71d, a multiplexer coding unit 71e, a transmission unit 71f,
a code output terminal 71g, and a coding control unit 71h.The motion picture signal reception terminal 711 receives
digitalized motion picture signals which are composed of a
plurality of frames consecutive in time. Each frame
</DESCRIPTION>
<CLAIMS>
A motion picture coding apparatus for dividing each frame which forms a
motion picture into a plurality of blocks, for coding a prediction error in each of the

blocks between a target frame and a reference frame, said target frame being a frame
to be coded and said reference frame being a frame that precedes said target frame,

and for further coding a motion vector to be used for obtaining the prediction error,
said motion picture coding apparatus comprising:


a motion vector storage means (11c) for storing motion vectors of all blocks in
the reference frame;
a motion vector detection means (113) for detecting a motion vector of each
block in the target frame based on the reference frame;
a differential motion vector detection means (11d) for detecting a differential
motion vector between a motion vector detected by said motion vector detection

means (113) and a motion vector of a corresponding block in the reference frame;
a differential motion vector coding means (11e) for coding the differential
motion vector detected, the coded differential motion vector being multiplexed with

the coded prediction error and outputted on a transmission path.
The motion picture coding apparatus of claim 1, wherein said motion vector
storage means (11c) has a first area for sequentially storing detected motion vectors

for a first frame and a second area for sequentially storing detected motion vectors for
a second frame which follows the first frame, whereby one of the first area and the

second area always holds motion vectors of all blocks in a reference frame.
The motion picture coding apparatus according to claim 1 or 2, further
comprising:


a block division means (112) for dividing said target frame into a plurality of
blocks; 
a prediction error coding means (118) for coding a difference between a block
having a detected motion vector and a corresponding block in the reference frame,

said difference being said prediction error;
a local decoding means (119) for decoding said prediction error, thereby
reproducing a block having the detected motion vector;
a frame memory means (114) for holding all reproduced blocks for the
reference frame and for sequentially storing blocks reproduced by said local decoding

means (119);

wherein said motion vector detection means (113) detects a motion vector
based on the reference frame held in said frame memory means (114), and the coded

differential motion vector is multiplexed with the coded prediction error, thereby
being outputted on the transmission path.
A motion picture coding apparatus for dividing each frame which forms a
motion picture into a plurality of blocks, for coding a prediction error in each of the

blocks between a target frame and a reference frame, said target frame being a frame
to be coded and said reference frame being a frame that precedes said target frame,

and for further coding a motion vector to be used for obtaining the prediction error,
said motion picture coding apparatus comprising:


a motion vector storage means (11c) for storing motion vectors of all blocks in
the reference frame;
a motion vector detection means (113) for detecting a motion vector of each
block in the target frame based on the reference frame;
a differential motion vector detection means (11d) for detecting a differential
motion vector between a motion vector detected by said motion vector detection

means (113) and a motion vector of a corresponding block in the reference frame; and
a coding means (143) for coding a differential motion vector when a
differential motion vector is equal or smaller than a predetermined threshold and for

coding a motion vector when the differential motion vector is greater than the 
predetermined threshold,

   wherein the coded prediction error, one of the coded differential motion vector
and the coded motion vector, and information indicating which one of the differential

motion vector and the motion vector has been coded are multiplexed together and then
outputted on a transmission path.wherein the coded prediction error, one of the coded differential motion vector

and the coded motion vector, and information indicating which one of the differential
motion vector and the motion vector has been coded are multiplexed together and then

outputted on a transmission path.
The motion picture coding apparatus of claim 4, wherein said motion vector
storage means (11c) has a first area for sequentially storing detected motion vectors

for a first frame and a second area for sequentially storing detected motion vectors for
a second frame which follows the first frame, whereby one of the first area and the

second area always holds motion vectors of all blocks in a reference frame.
The motion picture coding apparatus of claim 4 or 5, wherein said coding means
(143) comprises:


a threshold holding means (141) for holding said predetermined threshold;
a comparison means (142) for comparing said differential motion vector with
said predetermined threshold;
a fixed length coding means (143a) for fixed length coding a detected motion
vector when said differential motion vector is greater than said predetermined

threshold; and
a variable length coding means (143b) for variable length coding the differential
motion vector when said differential motion vector is equal or smaller than said

predetermined threshold,

   wherein an average of the variable length coded differential motion vector is
equal or smaller than the fixed length coded motion vector.
The motion picture coding apparatus of claim 6, wherein said comparison
means (142) compares each component of said differential motion vector with said

predetermined threshold, said fixed length coding means (143a) fixed length codes 
each component of said detected motion vector, and said variable length coding means (143b)

variable length codes each component for said differential motion vector.
The motion picture coding apparatus of claim 7, wherein said predetermined
threshold is 2 and said fixed length code is 5 bits long.
The motion picture coding apparatus according to any of claims 4 to 8, further
comprising:


a block division means (112) for dividing a target frame into a plurality of
blocks, said target frame being a frame to be coded;
a prediction error coding means (118) for coding a difference between a block
having a detected motion vector and a corresponding block in the reference frame,

said difference being said prediction error;
a local decoding means (119) for decoding said prediction error, thereby
reproducing a block having the detected motion vector;
a frame memory means (114) for holding all reproduced blocks for the
reference frame and for sequentially storing blocks reproduced by said local decoding

means (119);
a multiplexer means (144) for multiplexing one of the coded differential
motion vector and the coded motion vector with information indicating whi
ch one of
the differential motion vector and the motion vector has been coded, and the coded

prediction error, thereby being outputted on the transmission path.
A motion picture decoding apparatus for decoding a coded prediction error for
each block between a target frame and a reference frame, said target frame being a

frame to be decoded and said reference frame being a frame that precedes said target
frame, and for further decoding a coded differential motion vector between each block

in the target frame and a corresponding block in the reference frame, said motion
picture decoding apparatus comprising: 


a motion vector storage means (193) for storing motion vectors of all blocks in
the reference frame;
a differential motion vector decoding means (192) for decoding a coded
differential motion vector, thereby obtaining a differential motion vector; and
a motion vector addition means (128) for adding the differential motion vector
obtained by said differential motion vector decoding means (192) and a motion vector

of a corresponding block in the reference frame, thereby obtaining a motion vector to
be used for decoding the prediction error.
The motion picture decoding apparatus of claim 10, wherein said motion vector
storage means (193) has a first area for sequentially storing motion vectors for a first

frame, which have been obtained in said motion vector addition means (128) and a
second area for sequentially storing detected motion vectors for a second frame which

follows the first frame, whereby one of the first area and the second area always holds
motion vectors of all blocks in a reference frame.
The motion picture decoding apparatus of claim 11, further comprising:

an error detection means (221) for detecting a presence of an error in a coded
differential motion vector;
a prevention means for preventing said motion vector storage means (193) and
said motion vector addition means (128) from processing a differential motion vector,

when the differential motion vector has been detected to have an error; and
an amendment means (222) for, when a presence of an error has been detected,
storing to said motion vector storage means (193) a motion vector of a predetermined

block instead of a motion vector having the error, said predetermined block being
stored in said motion vector storage means (193).
The motion picture decoding apparatus of claim 12, wherein said predetermined
block is one of a block which is adjacent to the block whose motion vector having the 

error and a block which is located in a same position in the reference frame as the
block whose motion vector having the error.
The motion picture decoding apparatus according to any of claims 10 to 13,
further comprising:


a code distinction means (191) for distinguishing a fixed length coded motion
vector from a variable length coded differential motion vector, based on a code

distinction information sent from a motion picture coding apparatus;
a fixed length decoding means (192a) for decoding a motion vector which has
been coded with a fixed length code, thereby outputting a motion vector;

   wherein the differential motion vector decoding means (192) comprises a
variable length decoding means for decoding a differential motion vector which

has been coded with a variable length code, thereby outputting a differential motion
vector; and

   wherein the motion vector outputted from said fixed length decoding means
and the motion vector obtained by said motion vector addition means are used for

decoding the prediction error.
The motion picture decoding apparatus of claim 14 as dependent from claim 11,
wherein a first area of said motion vector storage means (193) is arranged to store

motion vectors for the first frame sent from said fixed length coding means (192a) and
said motion vector addition means (128).
The motion picture decoding apparatus of claim 14 or 15, wherein said fixed
length decoding means (192a) decodes each component of said coded motion vector,

and said variable length decoding means (192b) decodes each component of said
coded differential motion vector.
The motion picture decoding means of any of claims 14 to 16 as dependent from 
claim 10 or 11, further comprising:


an error detection means (221) for detecting a presence of an error in one of a
coded differential motion vector and a coded motion vector;
a prevention means for preventing said motion vector storage means (193) and
said motion vector addition means (128) from processing a differential motion vector,

when the differential motion vector has been detected to have an error; and
an amendment means (222) for, when a presence of an error has been detected,
storing to said motion vector storage means (193) a motion vector of a predetermined

block instead of a motion vector having the error, said predetermined block being
stored in said motion vector storage means (193).
The motion picture decoding apparatus of claim 17, wherein said predetermined
block is a block which is adjacent to the block whose motion vector having the error,

when said code distinction means (191) indicates a fixed length code, and is a block
which is located in a same position in the reference frame as the block whose motion

vector having the error, when said code distinction means (191) indicates a variable
length code.
A motion picture coding method for dividing each frame which forms a motion
picture into a plurality of blocks, for coding a prediction error in each of the blocks

between a target frame and a reference frame, said target frame being a frame to be
coded and said reference frame being a frame that precedes said target frame, and for

further coding a motion vector to be used for obtaining the prediction error, said
motion picture coding method comprising the steps of:


storing motion vectors of all blocks in the reference frame to a memory (11c);
detecting a motion vector of each block in the target frame to a corresponding
block in the reference frame;
detecting a differential motion vector between a motion vector detected by said
motion vector detection step and a motion vector of a corresponding block in the 

reference frame stored in the memory (11c); and
coding the differential motion vector detected,

   wherein the coded differential motion vector is multiplexed with the coded
prediction error, thereby outputting on a transmission path.
The motion picture coding method of claim 19, wherein the motion vector
storing step includes an operation of sequentially storing detected motion vectors for a

first frame to a first area of the memory (11c) and another operation of sequentially
storing detected motion vectors for a second frame which follows the first frame to a

second area of the memory (11c), whereby one of the first area and the second area of
the memory (11c) always holds motion vectors of all blocks in a reference frame.
The motion picture coding method according to claim 19 or 20, further
comprising the steps of:


dividing a target frame into a plurality of blocks;
coding a difference between a block having a detected motion vector and a
corresponding block in the reference frame, said difference being said prediction

error;
decoding said prediction error, thereby reproducing a block having the
detected motion vector;
storing all reproduced blocks for the reference frame to a temporary storage
unit (114) and sequentially storing blocks reproduced in the decoding step to the

temporary storage unit (114);

   wherein the step of detecting a motion vector is based on the reference frame
held in the memory (11c), and the coded differential motion vector is multiplexed

with the coded prediction error, thereby outputting on the transmission path.
A motion picture coding method for dividing each frame which forms a motion
picture into a plurality of blocks, for coding a prediction error in each of the blocks 

between a target frame and a reference frame, said target frame being a frame to be
coded and said reference frame being a frame that precedes said target frame, and for

further coding a motion vector to be used for obtaining the prediction error, said
motion picture coding method comprising the steps of:


storing motion vectors of all blocks in the reference frame to a memory (11c);
detecting a motion vector of each block in the target frame to a corresponding
block in the reference frame;
detecting a differential motion vector between a first motion vector detected by
said motion vector detection step and a motion vector of a corresponding block in the

reference frame stored in the memory (11c); and
coding a differential motion vector when a differential motion vector is equal
or smaller than a predetermined threshold and coding a motion vector when the

differential motion vector is greater than the predetermined threshold,

   wherein the coded prediction error, one of the coded difference motion vector
and the coded motion vector, and information indicating which one of the differential

motion vector and the motion vector has been coded are multiplexed together and then
outputted on a transmission path.
The motion picture coding method of claim 22, wherein the motion vector
storing step includes an operation of sequentially storing detected motion vectors for a

first frame to a first area of the memory (11c) and another operation of sequentially
storing detected motion vectors for a second frame which follows the first frame to a

second area of the memory (11c), whereby one of the first area and the second area of
the memory (11c) always holds motion vectors of all blocks in a reference frame.
The motion picture coding method of claim 22 or 23, wherein said coding step
comprises the steps of:


holding a predetermined threshold;
comparing said differential motion vector with said predetermined threshold; 
fixed length coding a detected motion vector when said differential motion
vector is greater than said predetermined threshold; and
variable length coding the differential motion vector when said differential motion
vector is equal or smaller than said predetermined threshold,

   wherein an average of the variable length coded differential motion vector
is equal or smaller than the fixed length coded motion vector.
The motion picture coding method of claim 24, wherein the comparing step
compares each component of said differential motion vector with said predetermined

threshold, the fixed length coding step fixed length codes each component of said
detected motion vector, and the variable length coding step variable length codes each

component for said differential motion vector.
The motion picture coding method according to any of claims 22 to 25, further
comprising the steps of:


dividing said target frame into a plurality of blocks;
coding a difference between a block having a detected motion vector and a
corresponding block in the reference frame, said difference being said prediction

error;
decoding said prediction error, thereby reproducing a block having the
detected motion vector;
storing all reproduced blocks for the reference frame to a temporary storage
unit (114) and sequentially storing blocks reproduced in the decoding step to the

temporary storage unit (114); and
multiplexing one of the coded differential motion vector and the coded
motion vector with information indicating which one of the differential motion vector

and the motion vector has been coded, and the coded prediction error, thereby
outputting on the transmission path.
A motion picture decoding method for decoding a coded prediction error for
each block between a target frame and a reference frame, said target frame being a

frame to be decoded and said reference frame being a frame that precedes said target
frame, and for further decoding a coded differential motion vector between each block

in the target frame and a corresponding block in the reference frame, said motion
picture decoding method comprising the steps of:


storing motion vectors of all blocks in the reference frame to a memory
(11c);
decoding a coded differential motion vector, thereby obtaining a differential
motion vector; and
adding the differential motion vector obtained in the decoding step and a
motion vector of a corresponding block in the reference frame, thereby obtaining a

motion vector to be used for decoding the prediction error.
The motion picture decoding method of claim 27, wherein the motion vector
storing step includes an operation of sequentially storing motion vectors for a first

frame, which are obtained in said motion vector addition step to a first area of the
memory (11c) and another operation of sequentially storing detected motion vectors

for a second frame which follows the first frame to a second area of the memory
(11c), whereby one of the first area and the second area of the memory (11c) always

holds motion vectors of all blocks in a reference frame.
The motion picture decoding method of claim 28 further comprising the steps
of:


detecting a presence of an error in a coded differential motion vector;
preventing the motion vector storing step and the motion vector adding step
from processing a differential motion vector, when the differential motion vector has

been detected to have an error; and
when a presence of an error has been detected, amending a motion vector 
having the error by storing a motion vector of a predetermined block to said motion

vector storing step.
The motion picture decoding method of claim 29, wherein said predetermined
block is one of a block which is adjacent to the block whose motion vector having the

error and a block which is located in a same position in the reference frame as the
block whose motion vector having the error.
The motion picture decoding method according to any of claims 27 to 30,
further comprising the steps of:


distinguishing a fixed length coded motion vector from a variable length
coded differential motion vector, based on a code distinction information contained in

a coded motion picture;
decoding a motion vector which has been coded with a fixed length code,

thereby outputting a motion vector;

   wherein the step of decoding the differential motion vector comprises the
step of decoding the differential motion vector which has been coded with a variable

length code, thereby outputting the differential motion vector; and

   wherein the motion vector outputted in the first decoding step and the motion
vector obtained from the adding step are used for decoding the prediction error.
The motion picture decoding method of claim 31 as dependent from claim 28,
wherein the motion vector storing step includes an operation of sequentially storing

motion vectors for a first frame, which have been obtained in the fixed length
decoding step and said motion vector addition step.
The motion picture decoding method of claim 31 or 32, wherein the fixed length
decoding step fixed length decodes each component of said motion vector, and the

variable length decoding step variable length decodes each component of said 
differential motion vector.
The motion picture decoding method of any of claims 31 to 33 as dependent
from claim 27 or 28, further comprising the steps of:


detecting a presence of an error in one of a coded differential motion vector
and a coded motion vector;
preventing the motion vector storing step and the motion vector adding step
from processing a differential motion vector, when the differential motion vector has

been detected to have an error; and
when a presence of an error has been detected, amending a motion vector
having the error by storing a motion vector of a predetermined block to said motion

vector storing step.
The motion picture decoding method of claim 34, wherein said predetermined
block is a block which is adjacent to the block whose motion vector having the error,

when said code distinguishing step indicates a fixed length code, and is a block which
is located in a same position in the reference frame as the block whose motion vector

having the error, when said code distinction step indicates a variable length code.
</CLAIMS>
</TEXT>
</DOC>
