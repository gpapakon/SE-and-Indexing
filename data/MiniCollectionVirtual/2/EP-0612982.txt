<DOC>
<DOCNO>EP-0612982</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Conditioning circuit for analogue resistance sensor, especially for fuel gauge
</INVENTION-TITLE>
<CLASSIFICATIONS>G01D302	G01D302	G01D102	G01D100	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G01D	G01D	G01D	G01D	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G01D3	G01D3	G01D1	G01D1	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
The present invention relates to a circuit for processing the output signal of an analogue resistive sensor (Ca), characterised in that it comprises, on the one hand, a digital filtering means (100) and, on the other hand, a module (200) forming a digital/impedance converter, which are interposed in series between the output of the sensor (Ca) and the input of an associated load (Log), the said digital/impedance converter (200) having variable output impedance as a function of the output signal of the digital filtering means, which is equivalent to the output resistance of the sensor (Ca). 
<
IMAGE
>
</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
MAGNETI MARELLI FRANCE
</APPLICANT-NAME>
<APPLICANT-NAME>
MARWAL SYSTEMS
</APPLICANT-NAME>
<APPLICANT-NAME>
MAGNETI MARELLI FRANCE
</APPLICANT-NAME>
<APPLICANT-NAME>
MARWAL SYSTEMS
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
CHAPOTOT MICHEL
</INVENTOR-NAME>
<INVENTOR-NAME>
MARTEAU BERNARD
</INVENTOR-NAME>
<INVENTOR-NAME>
PHILIPPON XAVIER
</INVENTOR-NAME>
<INVENTOR-NAME>
POLETTO VANNI
</INVENTOR-NAME>
<INVENTOR-NAME>
POMA ALBERTO
</INVENTOR-NAME>
<INVENTOR-NAME>
CHAPOTOT, MICHEL
</INVENTOR-NAME>
<INVENTOR-NAME>
MARTEAU, BERNARD
</INVENTOR-NAME>
<INVENTOR-NAME>
PHILIPPON, XAVIER
</INVENTOR-NAME>
<INVENTOR-NAME>
POLETTO, VANNI
</INVENTOR-NAME>
<INVENTOR-NAME>
POMA, ALBERTO
</INVENTOR-NAME>
</INVENTORS>
<CLAIMS>
A circuit for processing a signal, the circuit comprising a module (200)
forming a digital-to-impedance converter which seeds the input of an

associated load (Log), said digital-to-impedance converter (200) presenting
an output impedance that is variable as a function of said signal,

the circuit being characterized by the facts that said signal is an output signal
from a resistive analog sensor (Ca) having output resistance that is variable

as a function of a detected physical magnitude, and that the circuit further
comprises a digital filter means (100) including an analog-to-digital converter

(180) connected to the output of the sensor (Ca) and a digital filter (185)
associated to the analog-to-digital converter and having its output connected

to the input of the module (200) forming a digital-to-impedance converter,
such that the digital-to-impedance converter presents an impedance that is

equivalent to the output resistance of the sensor (Ca).
A circuit according to claim 1, characterized by the fact that the digital-to-impedance
converter (200) comprises means (230; 274; 294; 310) for

measuring the voltage at the terminals of the load (B1, B2) and an output
stage (240; 290; 320) of the controlled current source type for delivering a

current that is proportional to the ratio between the voltage measured at the
terminals of the load (B1, B2) and the output resistance of the sensor (Ca).
A circuit according to claim 1 or 2, characterized in that the digital-to-impedance
converter (200) is constituted by a resistor array (210) and by an

impedance converter (220).
A circuit according to claim 3, characterized by the fact that the impedance
converter (200) comprises a unit comprising in series a current generator

(240) and a resistor (R245) connected to the input terminal of the load (Log),
and means (230, 250; 270, 271) for controlling the current generator (240).
A circuit according to claim 4, characterized by the fact that the means
(230, 250; 270, 271) for controlling the current generator (240) comprise a

resistor array (210; 272) driven by the digital filter means (100). 
A circuit according to claim 4 or 5, characterized by the fact that the means
(230, 250; 270, 271) for controlling the current generator (240) are responsive

to the voltage present at the input terminals of the load (Log).
A circuit according to any one of claims 3 to 6, characterized by the fact
that the impedance converter (220) comprises a shunt resistor (R226)

connected in series with the output of the resistor array (210), a first voltage-copying
stage (230) suitable for copying the voltage that is present at the

input of the load onto the output terminals of the resistor array (210), a current
generator (240) connected in series with a resistor (R245) forming a unit

connected to the input terminals of the load (Log), and a second voltage-copying
stage (250) suitable for copying the voltage present at the terminals

of the shunt resistor (R226) onto the resistor (R245) that is connected in
series with the current source (240).
A circuit according to claim 7, characterized by the fact that the resistor
(R245) connected in series with the current generator (240) is of smaller

resistance than the shunt resistor (R226), typically being equal to one-thousandth
of the resistance of the shunt (R226).
A circuit according to claim 7 or 8, characterized by the fact that the resistor
array (210) comprises a set of switches (S0 to Sn) connected in series, driven

by respective different bits of the output signal of the digital filter means (100)
and connected in parallel with respective associated resistors.
A circuit according to claim 9, characterized by the fact that the resistors
are of resistances that increase progressively in application of the relationship

2
n
R.
A circuit according to any one of claims 2 to 6, characterized by the fact
that the control means (270, 271) of the current source (240) comprise a

variable gain amplifier (270) connected to one input of a comparator (274)
whose other input is connected to the input of the load (Log) and whose

output is connected to the current source (240). 
A circuit according to claim 11, characterized by the fact that the variable
gain amplifier (270) comprises an attenuator (272) constituted by a resistor

array driven by the output of the digital filter means.
A circuit according to claim 12, characterized by the fact that the variable
gain amplifier (270) comprises a first amplifier stage (271), an attenuator (272)

constituted by a resistor array, and a second amplifier stage (273).
A circuit according to claim 1 or 2, characterized by the fact that the
digital-to-impedance converter (200) comprises a digital-to-analog converter

(280) and an analog to impedance converter (285).
A circuit according to claim 1 or 2, characterized by the fact that the
control means (292) for the current source comprise digital calculation means.
A circuit according to claim 15, characterized by the fact that the digital
calculation means (292) have one input connected to the input of the load via

an analog-to-digital converter (294) and their output connected to the control
input of the current source (290) via a digital-to-analog converter (295).
A circuit according to claim 1 or 2, characterized by the fact that the
control means (292) of the current source comprise analog calculation means.
A circuit according to claim 17, characterized by the fact that the control
means (292) receives analog data representative of the output resistance of a

resistor array (130) under the control of the digital filter means (100).
A circuit according to any one of claims 2 to 18, characterized by the fact
that the means (310) for measuring the voltage at the terminals of the load

(B1, B2) include a resistive divider bridge (R312; R314).
A circuit according to any one of claims 2 to 19, characterized by the fact
that the current source type output stage (320) comprises a transistor (T327)

connected in series with the sensor (Ca). 
A circuit according to any one of claims 2 to 20, characterized by the fact
that the current source type output stage (320) comprises two parallel-connected

branches (321, 325) each including a transistor (T323, T327).
A circuit according to claim 21, characterized by the fact that a first branch
(321) comprises a resistor (R322) connected in series with a transistor (T323),

and the second branch (325) comprises a resistor (R326) connected in series
with a transistor (T327) and with the sensor (Ca).
A circuit according to claim 21 or 22, characterized by the fact that one of

the transistors (T323) is driven by an operational amplifier (360) that receives
on respective inputs both the voltage signal as measured at the terminals of

the load and the output signal from the filter.
A circuit according to claim 23, characterized by the fact that the second
transistor (T327) is driven by an operational amplifier (370) that receives on

respective inputs the potentials present at respective intermediate points of
the two branches (321, 325).
A circuit according to any one of claims 1 to 24, characterized by the fact
that the digital filter means (100) comprise a comparator stage (110) having a

first input receiving the output signal from the sensor (Ca), an up/down
counter (120) having an input that receives a clock signal at a constant

frequency, and having an up/down control input that receives the output from
the comparator stage (110), and a resistor array (130) connected between the

output of the up/down counter (120) and a second input of the comparator
stage (110).
A circuit according to any one of claims 12, 13, or 25, characterized by the
fact that the resistor array (130) comprises a divider bridge having a plurality

of resistors of resistance R connected in series via a resistor of resistance 2R
between ground and the output of the array, each common point between two

adjacent resistors of said divider bridge, and the output point thereof also
being connected via respective resistors of resistance 2R to respective

switches (A0 to An), each switch being respectively controlled by one of the
outputs of the digital filter means (100) in such a manner that each switch 

connects the corresponding resistor (2R) either to ground, or to a reference
voltage.
A circuit according to any one of claims 12, 13, or 25, characterized by the
fact that the resistor array (130) comprises a divider bridge comprising a

plurality of resistors of resistance R connected in series via a resistor of
resistance 2R between ground and a reference voltage, each point common

to two adjacent resistors in said divider bridge and its end point receiving the
reference voltage also being connected via a respective resistor of resistance

2R to a respective switch, the switches (A0 to An) being driven by respective
associated outputs of the digital filter means (100) in such a manner that each

switch connects the corresponding resistor (2R) either to ground or to the
input of an amplifier stage (132).
A circuit according to any one of claims 3 to 27, characterized by the fact
that the resistor array (130, 210) is driven by the more significant output bits

from the digital filter means (100).
A circuit according to claim 25, characterized by the fact that it includes
means suitable for modifying the frequency of the clock signal when switched

on.
A circuit according to claim 29, characterized by the fact that the means
generating the clock signal comprise an oscillator (142) and a divider (140)

connected in cascade, and by the fact that the means for modifying the
frequency of the clock signal comprise means suitable for inhibiting the divider

(140) at switch on.
A circuit according to claim 30, characterized by the fact that the inhibition
means (160) are connected to the output of the comparator stage (110) to

interrupt inhibition of the divider (140) after a predetermined number of zero
crossings have been detected in the output of the comparator stage (110).
A circuit according to any one of claims 1 to 24, characterized by the fact
that the digital filter means (100) comprise a series connection of an analog-to-digital

converter (180) and a digital filter (185). 
A circuit according to any one of claims 1 to 24, characterized by the fact
that the digital filter means (100) comprise a comparator stage (330) having a

first input receiving the output signal from the sensor (Ca), an up/down
counter (332) having an input (333) that receives a clock signal at constant

frequency, and having an up/down control input that receives the output from
the comparator stage (330), a digital filter (335) whose input is connected to

the output of the up/down counter (332), and an analog-to-digital converter
(344) connected between the output of the digital filter (335) and a second

input of the comparator (330).
A circuit according to any one of claims 23 to 33 taken in combination,
characterized by the fact that a sample-and-hold circuit (350) is interposed

between the output of the analog-to-digital converter (344) and one of the
inputs of the operational amplifier (360).
A circuit according to any one of claims 1 to 34, characterized by the fact
that the filter means comprise control means (420) including:


detection means (422) suitable for detecting crossovers between the
input signal and a filtered value of said input signal;
timing means (424) restarted on each crossover detected by the
detection means (422); and
inhibit means (426) for inhibiting the filter (410) if no crossover is
detected by the detection means (422) before the timing means have timed

out, and for enabling the filter (410) on the first crossover that is detected by
the detection means (422) after the filter has been inhibited.
A circuit according to claim 35, characterized by the fact that the digital
filter means (410) comprises a first order filter.
A circuit according to claim 35 or 36, characterized by the fact that the
digital filter means (410) is of the form:


filter
n
 = filter
n-1
 + Mniv (NIV
n
 - filter
n-1
)/P

where:

filter
n
 designates the value of the filter signal at instant 
n
;
filter
n-1
 designates the value of the filter signal at instant n-1;
Mniv designates a multiplicative factor;
NIV
n
 designates the input value measured at instant 
n
; and 
P designates a time constant.
A circuit according to any one of claims 35 to 37, characterized by the fact
that its timeout is of the order of 1 second to 2 seconds.
A circuit according to any one of claims 35 to 38, characterized by the fact
that the inhibit means (426) comprise means suitable for changing the time

constant of the filter (410).
A circuit according to claim 39, characterized by the fact that the means
suitable for modifying the time constant of the filter (410) are adapted to

modify a multiplicative factor (Mniv) of the filter function so as to length the
filter time constant during the inhibit period.
A circuit according to any one of claims 35 to 40, characterized by the fact
that the filter means comprise means suitable for preventing the inhibit means

(426) from operating when the circuit is switched on until the detection means
(422) have detected a predetermined number of crossovers between the input

signal and the filtered value of said input signal.
A circuit according to any one of claims 35 to 41, characterized by the fact

that it includes non-linear means suitable for compensating the non-linearity
of the combination of sensor (Ca) and the load (B1, B2).
A circuit according to claim 42, characterized by the fact that it includes an
analog-to-digital converter (344) that is non-linear.
A circuit according to claim 42, characterized by the fact that it includes
means suitable for modifying the time constant of the filter as a function of the

non-linear response of the combination comprising the sensor (Ca) and the
load (B1, B2).
A circuit according to claim 44, characterized by the fact that the means
for modifying the time constant of the filter act on a multiplicative factor in the

filter function. 
A circuit according to claim 45, characterized by the fact that ,the
multiplicative factor Mniv in the filter function is of the form:


Mniv = 16(2 - (NIV
max
 - NIV
n
)/NIV
max
).
A circuit according to any one of claims 1 to 46, characterized by the fact
that the digital filter means (100) and the module (200) constituting the digital-to-impedance

converter are implemented in the form of a single integrated
circuit.
A circuit according to any one of claims 1 to 47, characterized by the fact
that it is located in the sensor (Ca).
A circuit according to any one of claims 1 to 47, characterized by the fact
that it is located in the load (Log).
A circuit according to any one of claims 1 to 49, characterized by the fact
that the sensor (Ca) is a resistive sensor, in particular for measuring the level

of a liquid.
A circuit according to any one of claims 1 to 50, characterized by the fact
that the sensor (Ca) is a potentiometer type sensor, fed with a regulated

voltage from which output data is taken by means of the wiper of the
potentiometer.
A circuit according to any one of claims 1 to 50, characterized by the fact
that the sensor (Ca) is of the rheostat type, fed by a current source, and form

which output data is taken from the terminals of the variable resistance
constituted in this way.
A circuit according to any one of claims 1 to 52, characterized by the fact
that the current flowing through the sensor (Ca) is less than the current

flowing through the load (Log).
A circuit according to any one claims 1 to 52, characterized by the fact
that the sensor (Ca) is fed with alternating current and a rectifier circuit is

provided between the output from the sensor and the input to the digital filter
means (100). 
A circuit according to any one of claims 1 to 54, characterized by the fact
that the load (Log) is constituted by a meter, preferably by a ratio meter.
A circuit according to any one of claims 1 to 55, characterized by the fact
that it comprises:


a comparator (330) having a first input on which it receives the voltage
at the terminals of the sensor (Ca);
an up/down counter (332) having an up/down control input connected
to the output of the comparator (330);
a digital filter (335) whose input is connected to the output of the
up/down counter (332);
a multiplexer (340) whose inputs are connected respectively to the
output of the up/down counter (332) and to the output of the digital filter (335);
a digital-to-analog converter (344) whose input is connected to the
output of the multiplexer (340) and whose output is connected to the second

input of the up/down counter (332);
a sample-and-hold circuit (350) whose input is connected to the output
of the digital-to-analog converter (344); and
a control circuit (360, 321, 325) that controls a current source (T323,
T327) at the output of the circuit as a whole on the basis of the voltage

measured at the terminals of the load and of the signal from the sample-and-hold
circuit (350).
A circuit according to any one of claims 1 to 56, characterized by the fact
that it comprises a current source (T327, 104) that feeds the sensor (Ca),

which current source (T327, 104) is controlled to deliver a current (Ij)
proportional to the output current (IL) supplied to the load.
A circuit according to any one of claims 1 to 57, characterized by the fact
that it comprises:


an analog-to-digital converter (190) whose input is connected to the
output of the sensor (Ca);
a digital filter (100) whose input is connected to the output of the
analog-to-digital converter (190);
a digital-to-analog converter (192) whose input is connected to the
output of the digital filter (100); 
an attenuator (197) whose input is connected to the load; and
an output current source (T194) which is driven by the difference
between the signal from the digital-to-analog converter (192) and the signal

from the attenuator (197).
An application of the circuit according to any one of claims 1 to 58, to
processing the output signal from a resistive sensor in a motor vehicle.
</CLAIMS>
</TEXT>
</DOC>
