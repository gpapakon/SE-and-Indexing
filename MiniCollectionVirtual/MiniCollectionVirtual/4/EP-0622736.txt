<DOC>
<DOCNO>EP-0622736</DOCNO> 
<TEXT>
<INVENTION-TITLE>
File management system with file-size flexibility
</INVENTION-TITLE>
<CLASSIFICATIONS>G06F1200	G06K1907	G06F1202	G06K1907	G07F710	G06F1200	G06F1202	G07F710	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G06F	G06K	G06F	G06K	G07F	G06F	G06F	G07F	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G06F12	G06K19	G06F12	G06K19	G07F7	G06F12	G06F12	G07F7	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
In an IC card (1), a memory (12) is divided into a 
plurality of files and data management of each divided 

file is performed. The IC card (1) comprises a size 
allocation section (12) for allocating an optional file 

size to each file, and a control section (11) for 
performing a control operation so that size management 

may be effected according to the size allocated by the 
size allocation section (12) in which an instruction 

section for commanding that size management should not 
be performed in each file is included. 


</ABSTRACT>
<APPLICANTS>
</APPLICANTS>
<INVENTORS>
</INVENTORS>
<DESCRIPTION>
This invention relates to a file management apparatus
which gives flexibility to the sizes of divided files
set in a memory in an electronic apparatus such as an IC
card containing a nonvolatile memory and an IC chip
having a control element, like a CPU, that controls the
memory.EP-A-0 446 940 discloses a file management
apparatus having the features which are
recited in the preamble of claim 1.Presently, IC cards containing nonvolatile data
memories and IC chips with control elements, including
CPUs, that control those memories are attracting attention
as portable data process/memory mediums.An IC card of this type is known from U.S. Patent
No. 5,226,155 in which a built-in data memory is divided
into a plurality of files and data to be utilized when
the card is used in an application is stored in each
file. By entering an application identification name
into the IC card from an external device, only a
corresponding file is selectively brought into a usable
state. With this file selection, multipurpose
application can be achieved by grouping a plurality of
application data items into files and storing them into
a single IC card. These application files include a
plurality of data files for storing data such as transaction
data.These application files are added with size data.
When the data files are created in the application
files, whether or not these data files can be created is determined based on 
the size of memory used for these files and
the size given to the application files. By doing this,
the memory areas of applications are prevented from
interfering with one another.With the above method, however, the sizes of application
files are set previously, which therefore makes
it impossible to change the sizes later. For example,
it is assumed that 1000 bytes are given to a file used
in application A and 2000 bytes are given to a file used
in application B. Even if only 500 bytes out of the
given 1000 bytes are used in application A and another
500 bytes are required in application B in the course of
executing the two applications, they must be executed
within the range of the given size.Accordingly, the file (500 bytes) for use in application
B will not suffice the efficiency of execution
for an application.Accordingly, the object of the present invention is
to provide a file management system which eliminates the
necessity of setting the upper limit to the size of a
data file corresponding to an application, enables areas
to be added when necessary at the time of operation, and
allows mixing
</DESCRIPTION>
<CLAIMS>
A file management apparatus comprising:

a storage means (12) including a parent file (MF), a
first file (DF1) and a second file (DF2), the first and

second files being arranged in a lower order under the
parent file, said storage means (12) being provided for

storing first definition information for defining an
allocated size and a used size of the parent file and

second definition information for defining an allocated
size and a used size of the first file;
first calculation means (11) for calculating an unused
size of the first file according to the second

definition information stored in said storage means
when a third file is to be arranged in a lower order of

the first file;
first determining means (11) for determining whether
the size of the third file is included within a range

of the unused size of the first file in accordance with
a calculation result of the first calculation means;
first writing means (11) for writing into said storage
means a fourth definition information representing an

allocated size of the third file when it is determined 
from the calculation result of the first calculation

means that the third file size is within the unused
size of the first file;
characterized in that

said storage means (12) further stores third definition
information for defining that size management of the

second file should not be performed; and that

said file management apparatus further comprises:

second calculation means (11) for calculating an unused
size of the parent file based on the first definition

information stored in said storage means when a fourth
file to be positioned in a lower order under said

second file of which third definition information
representing that the size management thereof is not

performed is stored in said storage means;
second determining means (11) for determining whether
the size of the fourth file is included within the

unused size of the parent file in accordance with a
calculation result of the second calculation means; and
second writing means (11) for writing into said storage
means a fifth definition information representing an

allocated size of the fourth file when it is determined
from the calculation result of the second calculation

means that fourth file size to be formed is within the

unused size of the parent file.
A file management apparatus according to claim 1,

characterized by
 further comprising means (121) for
defining the plurality of files as upper order files

and lower order files depending on the upper order
files.
A file management apparatus according to claim 2,

characterized by
 further comprising:

means (11) for detecting an instruction to create a new
file under a file instructed that the size management

thereof should not be performed;
means (11, 121) for detecting a size-managed upper file
from the upper files in accordance with a detection

result of said detecting means;
means (11) for creating the new file having a size
within unused areas allocated to the size-managed upper

file; and
means (11, 121) for renewing the file size of the size-managed
upper file according to creation of the new

file.
A file management apparatus according to claim 1,

characterized by
 further including means for setting a
specific value for a file size to designate that size

management should not be performed in each file. 
A file management apparatus according to claim 1,

characterized by
 further comprising:

means (11) for detecting an instruction to create a new
file under a file instructed that the size management

thereof should not be performed;
means (11) for detecting a size-managed upper file from
the upper files in accordance with a detection result

of said detecting means;
means (11) for varying a size of another file depending
on the size-managed upper file within an unused range

allocated to the size-managed upper file; and
means (11) for renewing the file size of the size-managed
upper file according to creation of the new

file.
A file management apparatus according to claim 1,

characterized by
 further comprising:

control means (11) for performing a control operation
so that size management may be effected according to

the allocated size of the storage means; and
means (121) for setting identification information as
to whether or not to perform size management for a file

as attribute information to instruct that size
management should not be performed in the file.
An apparatus according to claim 6, 
characterized by

further comprising file defining means (121) for
defining the plurality of files as upper order files

and lower order files depending on the upper order
files, and wherein said control means (11) includes

means for performing the size management of the lower
order files within a range of a size allocated to the

upper order files.
An apparatus according to claim 6, 
characterized in
that
 said file defining means (121) includes a table
means for storing file dependency data in data file

definition word in a directory set in said memory (12).
An apparatus according to claim 7, 
characterized by

further comprising:

means (11) for detecting an instruction to create a new
file under a file instructed that the size management

thereof should not be performed;
means (11) for detecting a size-managed upper file from
the upper files in accordance with a detection result

of said instruction detecting means;
means (11) for creating the new file having a size
defined within an unused range allocated to the size-managed

upper file; and 
means (11) for renewing the file size of the size-managed
upper file according to creation of the new

file.
A file management apparatus according to claim 1,

characterized by
 further comprising:

third calculation means (11) for calculating an unused
size of the first file of the upper order in accordance

with the second definition information when the size of
the third file is being changed;
third determining means (11) for determining whether
the change of the file size is possible from the unused

size of the first file calculated by the third
calculation means and a changed size of the third file;
third means (11) for changing the size of the third
file when it is determined by the third determining

means that the change of the file size is possible;
fourth calculation means (11) for calculating an unused
size of the parent file of a size-determined upper file

in accordance with the third definition information
when the size of the fourth file is to be changed;
fourth determining means (11) for determining whether
the change of the file size is possible from the unused

size of the parent file calculated by the fourth 
calculation means and a changed size of the fourth

file; and
fourth means (11) for changing the size of the fourth
file when it is determined by the fourth determining

means that the change of the file size is possible.
A file management apparatus according to claim 10,

characterized in that
 said fourth means (11) includes
means for creating a new file depending on the

interested file within a range of unused size of an
upper order file.
A file management apparatus according to claim 10,

characterized in that
 said fourth means (11) includes
means for writing data into the interested file within

a range of unused size of an upper order file.
A file management apparatus according to claim 10,

characterized in that
 said fourth means (11) includes
means for varying a data size of another file depending

on the upper order file within a range of unused size
of an upper order file.
An file management apparatus according to claim 10,

characterized by
 further comprising means (11) for
changing the size data stored in said storage means to

specified data representing that a size is not defined. 
A file management apparatus according to claim 1,

characterized by
 further comprising:

means (12) for storing an accessing condition for
accessing a selected file of the parent file and the

first to fourth files as another definition
information; and
means (11) for, when a new file is being created,
confirming whether the new file satisfies the accessing

condition of an upper order file of the new file.
A file management apparatus according to claim 10,

characterized by
 further comprising:

changing means (11) for changing, by said first means,
the size of the data file definition information

corresponding to a data file designated by a command
data into information representing that no size

management is being performed, when the change size
information represents that no size management is being

performed without calculating an unused size by said
calculation means and performing the determination by

said determining means.
A file management apparatus according to claim 10,

characterized by
 further comprising:

means (12) for storing an accessing condition for
accessing a selected file of the parent file and the 

first to fifth files as another definition information;
and
means (11) for, when a new file is being created,
confirming whether the new file satisfies the accessing

condition of an upper order file of the new file.
</CLAIMS>
</TEXT>
</DOC>
