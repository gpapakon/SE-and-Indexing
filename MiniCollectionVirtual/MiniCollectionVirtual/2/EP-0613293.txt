<DOC>
<DOCNO>EP-0613293</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Multiple module block matching architecture
</INVENTION-TITLE>
<CLASSIFICATIONS>H04N726	H04N514	H04N726	G06T720	G06T720	H04N514	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>H04N	H04N	H04N	G06T	G06T	H04N	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>H04N7	H04N5	H04N7	G06T7	G06T7	H04N5	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
A circuit implementation of a block matching algorithm 
comprises a plurality of modules. Each module is a one-dimensional 

systolic array. The modules can be connected in 
tandem to increase the power of computation so that the best 

match of a current block in a search window can be obtained more 
rapidly without increasing the number of input ports. In 

accordance with an alternative embodiment of the invention, the 
modules can be connected in tandem so as to enable the size of 

the search window to be increased. 

</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
IND TECH RES INST
</APPLICANT-NAME>
<APPLICANT-NAME>
INDUSTRIAL TECHNOLOGY RESEARCH INSTITUTE
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
LEE FOO-MING
</INVENTOR-NAME>
<INVENTOR-NAME>
LIN VINCENT M S
</INVENTOR-NAME>
<INVENTOR-NAME>
LEE, FOO-MING
</INVENTOR-NAME>
<INVENTOR-NAME>
LIN, VINCENT M.S.
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to the compression of video
signals. More particularly, the present invention relates to a
multiple module architecture for implementing a full search
block matching algorithm. Each module comprises a one-dimensional
systolic array of processing elements. The block
matching algorithm allows temporal redundancy to be eliminated
from a video signal in real time and in a highly efficient
manner.A full motion video sequence usually contains a significant
amount of frame-to-frame redundancy. For video phone or
teleconferencing applications, motion in the entire scene is
usually low and successive frames are highly correlated. In
such a case, interframe coding techniques can reduce the
information redundancy in video sequences and achieve high data
compression.The block matching motion compensation algorithm is widely
used in many video codecs to remove interframe redundancy. The
basic idea in the block matching algorithm is to divide the
current frame in the video sequence into blocks, and for each
block to search for a best match position in a search window of
the previous video frame. The best match of the current block in the search window is
determined by finding the minimum value of an error function,

where the a(i,j)'s are pixel values of the current block of the
current frame, the b(i,j)'s are the pixel values of the search
window of the previous frame, i is a vertical coordinate index,
j is a horizontal coordinate index, and mi,mj represents a
candidate displacement vector. The power factor q usually
equals 1 or 2.The displacement vector (i.e., value of mi, mj) which
minimizes the error function E is called the motion vector.The current block of the current video frame may be coded
as follows. The difference between the current block and the
best match block in the search window of the previous frame is
obtained. This difference is then compressed using the Discrete
Cosine Transform, quantization of transform coefficients and
variable length coding. Given the motion vector information, the
receiver can then reconstruct the current block using the
available previous frame and the compressed block difference.
The better the motion compensated prediction, the higher is the
efficiency in compressing the block difference. Thus, the use
of motion compensation results in a tremendous reduction in the
amount of bits used to code a frame.There are several ways in which the best match position of
a current block of a current video frame can be found in a 
search window of a
</DESCRIPTION>
<CLAIMS>
A full search block matching circuit comprising:

a plurality of m, where m
>
1, modules (10) connected in
tandem, each of said modules comprising a one-dimensional array

of processing elements (PE), each module receives pixel data relating
to different rows of data of the video scan,
a first input for inputting pixel values C from a block of
pixels in a current video frame in a predetermined sequence to

said modules (10), beginning with the first of said m modules,
a second input for inputting pixel values from a search
window of a previous video frame in a predetermined sequence to each of

said modules (10),
a control circuit (52) for generating a stream of mask
signals (MASK_1-MASK_m) for each of said m modules (10), and
at least m+1 gate circuits (G1-Gm1) for receiving said pixels
from said first and second inputs and said mask signals (MASK_1-MASK_m),

and for selectively transmitting particular pixels
inputted at said inputs to particular ones of said modules (10)

such that each one of said modules (10) is enabled for equal,
staggered periods of time.
The circuit of claim 1 wherein each of said modules (10)
determines error functions for one row of positions of the

current block in the search window and said circuit determines
in parallel the error functions for m rows of positions of the

current block in the search window. 
The circuit of claim 1 wherein said

current block comprises NxN pixels,
said search window comprises (2p+1+N)
2
 pixels, where
N=2p+2, and
each of said modules comprises 2p+2 processing
elements.
The circuit of claim 1 wherein said second input means
comprises one input for receiving pixels P from a first portion of

said search window and a second input for receiving pixels P' from
a second portion of said search window.
The circuit of claim 4 wherein said gate means (G1-Gm1) comprises
two gates associated with each module (10) for selectively enabling

pixels from the first and second search window portions to be
transmitted to the associated module (10) under the control of said

mask signals (MASK).
The circuit of claim 5 wherein the pixels of said current
block are transmitted serially from one processing element (PE) to

the next in the series of processing elements (PE) formed by said
modules (10) connected in tandem and wherein said pixels of said

search window are selectively broadcast to particular processing
elements (PE) of said modules (10).
A full search block matching circuit comprising:

a plurality of m modules (10) connected in tandem, each of
said modules (10) comprising a one dimensional systolic array,

and each module receives pixel data relating to different rows of data of
the video scan,
a first pixel input or transmitting to said m modules (10)
pixels C from a current block of a current video frame, beginning

with the first of said m modules, 
a second pixel input for transmitting to each of said m modules (10)
pixels P from a left-side area of a search window of a previous

frame having said left-side area and a right-side area,
a third pixel input for transmitting to said m modules
pixels P' from the right-side area of said search window of a

previous frame, wherein said pixels C, P and P' are transmitted
in a predetermined sequence for enabling said plurality of m

modules (10) to determine the errors for m rows of positions of
the current block in the search window in parallel.
A full search block matching circuit for a current block of
pixels having N pixels in each row of a current video frame in a

search window of a previous video frame having {N+(2n+2)p+2n+1}
pixels per row, where n ≥ 1, and p ≥ 1 comprising:


a plurality of n+1 modules (10) connected in tandem, each of
said n+1 modules (10) comprising a one-dimensional systolic array

of 2p+2 processing elements (PE) for computing an error function,
each module receives pixel data relating to different rows of data of the video

scan,
a first input for inputting said pixels C of said current
block to said modules (10), beginning with the first of said m modules,
a second input comprising n+2 search window inputs for
inputting said search window pixels to said modules (10), each of

said search window inputs inputting pixels from a separate
portion of said search window.
The circuit of claim 8 wherein n=1, the number or modules (10)
connected in tandem is two, and wherein the second input means

comprises three distinct inputs.
The circuit of claim 8 wherein said n+1 modules (10) compute in
parallel the error functions for one complete row of positions

of the current block in the search window.
A full search block matching circuit comprising:

a first module (MODULE 1) comprising a one-dimensional
systolic array of processing elements (PE_0-PE_15) which is able

by itself to compute in parallel the error functions for one row
of positions of a current block of pixels of a current video

frame in a search window of a first predetermined size of a
previous video frame,
a second module (MODULE 2) comprising a one-dimensional

systolic array of processing elements (PE_16-PE_31) connected in
tandem to said first module (MODULE 1), said first and second

modules (MODULE 1/2) cooperating to compute said error functions
in parallel one row of positions of said current block in a

search window of a second predetermined size larger than said
first predetermined size having a left-side area, a middle area

and a right-side area, each module receives pixel data relating to
different rows of data of the video scan, and
wherein said circuit includes a first input for inputting
pixels C of said current block to said modules (10)

beginning with the first of said m modules, and second,
third, and fourth inputs for inputting, to said modules, pixels

(P, P', P") from the left-side area, the middle area, and the
right-side area of said search window of said second size,

respectively.
The circuit of claim 11 wherein pixel data C from said
current block is passed sequentially from one processing element

to the next (PE_0-PE_31) in said first and second tandemly of connected
modules (10) and wherein pixel data (P,P',P") from said search window of said

second size is selectively broadcast to said processing elements (PE_0-PE_31)
of said first and second modules (10).
The circuit of claim 11 further comprising one or more
additional modules comprising a one-dimensional systolic array

connected in tandem to said first and second modules, wherein
said additional modules cooperate with said first and second

modules to compute in parallel one row of positions of said
current block in a search window of a size larger than said

second size.
The circuit of claim 11 wherein

each systolic array comprises 2p+2 processing elements (PE),
where p ≥ 1,
said current block has N pixels in each row, where N=2p+2,
said search window of a first predetermined size has 2p+1+N
pixels in each row, and
said search window of a second size has 2p+1+N+2(p+1) pixels
in each row.
The circuit of claim 13 wherein each module (10) comprises
2p+2 processing elements (PE), where p ≥ 1, and each additional

module enables the number of pixels in a row of the search window
to be increased by 2(p+1). 
A full search block matching circuit (70) comprising:

a first plurality (A) of modules (1A-4A) connected in
tandem, each module receives pixel data relating to different rows

of data of the video scan,
a second plurality (B) of modules (1B-4B) connected in
tandem,
each of said modules in said first and second pluralities
(A,B) comprising a one-dimensional systolic array of processing

elements (PE),
each of said modules including means for receiving pixels of
a current block of a current video frame, said pixels C of said

current block being transmitted serially from one processing
element (PE) to the next in said first plurality (A) of tandemly

connected modules (1A-4A), and being transmitted serially from
one processing element to the next in the second plurality (B) of

tandemly connected modules (1B-4B), the first processing element
(PE_0) of the first module (1B) in the second plurality (B)

serially receiving said current frame pixels after the last
processing element (PE_15) of the first module (1A) in the first

plurality (A), and
each of said modules including means for receiving selected
pixels of a search window of a previous video frame at selected

times under the control of mask signals (MASK).
The circuit of claim 16 wherein said modules determine in
parallel the error functions of a plurality of rows of positions

of the current block in said search window. 
The circuit of claim 17 wherein

said circuit includes first, second, and third inputs for
receiving pixels from first, second and third different portions

of said search window, search window pixels from said first and
second inputs being selectively transmitted to the modules (1A-4A) in

the first plurality (A) under the control of said mask signals (MASK), and
search window pixels from said second and third inputs being

selectively transmitted to said modules (1B-4B) of said second plurality (B)
under the control of said mask signals (MASK).
The circuit of claim 18 wherein said current block comprises
N pixels in each row, each of said modules comprises 2p+2

processing elements, wherein p ≥ 1, and said second plurality (B)
of modules (1B-4B) enabling the number of pixels in a row of the

search window to be increased by 2(p+1).
The circuit of Claim 1 comprising second, third and fourth
inputs for inputting pixel values from a respective left-side

area, middle area and right-side area of a search window of a
previous video frame in a predetermined sequence to said modules

(10), 
The circuit of claim 20 comprising

a second plurality of m modules (10) connected in tandem,
input means for transmitting to said modules (10) in said
first and second pluralities pixels C from a current block of a

current video frame and pixels (P,P',P") from a search window of
a previous video frame,
the modules of said first and second pluralities of modules
(10) determining in parallel error functions for m rows of

positions of the current block in the search window,
said second plurality of modules enabling the number of
pixels in each row of said search window to increased over the

number of pixels in each row of the search window which could be
processed in the absence of the second plurality by providing an

additional number of processing elements, each computing in
parallel the error function of one more position in the search

window,
wherein each module (10) comprises 2p+2 processing elements
(PE), where p ≥ 1, and said second plurality of modules enabling

the number of pixels in each row of the search window to increase
by 2(p+1).
The circuit of claim 21 wherein said input means comprises
first, second and third inputs for selectively broadcasting

pixels (P,P',P") from first, second and third portions of said search
window to the processing elements (PE) of said modules (10) under the

control of mask signals. 
The circuit of claim 22 wherein said pixels C of said current
block are transmitted serially from one processing element (PE) to

the next in said systolic arrays of said first plurality and are
transmitted serially from one processing element to the next in

said systolic arrays of said second plurality, the first
processing element of first systolic array of said second

plurality receiving each of said current block pixels C after a
last processing element of a first systolic array of the first

plurality.
The circuit of Claim 11, wherein said second input inputs
pixels P to said first module (MODULE 1), said third input inputs

pixels P' to said first and second modules (MODULE 1/2), and said
fourth input inputs pixels P" to said second module (MODULE 2).
</CLAIMS>
</TEXT>
</DOC>
