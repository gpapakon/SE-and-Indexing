<DOC>
<DOCNO>EP-0654940</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Method and apparatus for vector error diffusion with output color control
</INVENTION-TITLE>
<CLASSIFICATIONS>H04N152	G06T500	H04N160	H04N146	H04N146	H04N152	H04N160	G06T500	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>H04N	G06T	H04N	H04N	H04N	H04N	H04N	G06T	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>H04N1	G06T5	H04N1	H04N1	H04N1	H04N1	H04N1	G06T5	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
A method and apparatus perform vector error diffusion and result in reduced 
graininess of a color halftone image representing a continuous tone image. 

The method 
controls the output colors while reducing the visibility of the error diffusion 

pattern inherent 
in forming a bilevel image. Specifically, the method involves influencing the dot pattern 

correlation using vector error diffusion and takes into account the effects caused by the 
interactions of dot patters for all of the different color components. 

A distorted color space is used in which colors not favoured, e.g. 
secondaries, white and black, are further away from most colors in the 

space than are favoured colors. This can be achieved by changing 
thresholds used to select the closest color. 


</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
XEROX CORP
</APPLICANT-NAME>
<APPLICANT-NAME>
XEROX CORPORATION
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
BHARAT KRISHNA A
</INVENTOR-NAME>
<INVENTOR-NAME>
ESCHBACH REINER
</INVENTOR-NAME>
<INVENTOR-NAME>
KLASSEN ROBERT VICTOR
</INVENTOR-NAME>
<INVENTOR-NAME>
BHARAT, KRISHNA A.
</INVENTOR-NAME>
<INVENTOR-NAME>
ESCHBACH, REINER
</INVENTOR-NAME>
<INVENTOR-NAME>
KLASSEN, ROBERT VICTOR
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The invention relates to an apparatus and a method for controlling colors printed by
a printer or displayed on a monitor to reduce the visibility of error diffusion dot patterns, and
more particularly, to an apparatus and method for performing vector error diffusion with
output color control.Reproduction and display of continuous tone images on color monitors and color
printers using spatial grayscale or halftoning techniques is well known. However, the resulting
halftone images display various amounts or levels of "graininess" resulting from error inherent
in the halftoning process.Digital halftoning is the process of converting a continuous tone image to bi-level.
Many output devices, including many printers and some CRT (cathode ray tube) and LCD
(liquid crystal display) based devices are intrinsically bi-level, that is, the process can only print
or display a dot or no dot. Thus, a variety of geometrical patterns are created such that a group
of dots and blank areas represent the continuous tone image as closely as possible. Because the
halftoned image is only an approximate representation of the continuous tone image, there
are differences between the continuous tone image and the halftone image. Those areas of
the halftone pattern that do not match the original image are noise or error. An objective of
much research in digital halftoning is reducing the amount of visible noise.Digital halftoning can be classified into two classes: "conventional, passive
halftoning" and "active halftoning," with error diffusion being a widespread method of choice
in the latter category. Conventional passive halftoning (discussed first) yields an appearance
that is similar to that provided by classical analogue processes developed before digital
techniques were available; it is most appropriate for devices that cannot display isolated pixels.
Error diffusion produces an image appearance more like that created by the pointillist painters
at around the end of the 19th century. It is most appropriate for devices that can display
isolated pixels. Error diffusion tends to have noise at higher, and hence less visible spatial
frequencies, often resulting in a more pleasing appearance, see for instance: "Threshold
Modulation in Error Diffusion," by K. T. Knox and R. Eschbach, Journal of Electronic Imaging 3,
pp. 185-192(1993) and the references cited therein.Several attempts have been made to reduce the sensitivity to process noise and
maintain the appearance of the tonal gradation of the continuous tone image for
convention
</DESCRIPTION>
<CLAIMS>
A method for determining a color of a pixel from an
original image, comprising the steps of:


a) determining (104) an ink contribution of the pixel based on
input data derived from the original image and a value (106) from

an ink error diffusion buffer, the ink contribution
representing the amount of ink needed to print the pixel;
b) determining a modified color of the pixel based on the
color of the pixel in the original image and a diffused

color error;
c)
comparing (108) the determined ink contribution with a

predetermined value and, if the result of the comparison
satisfies a predetermined condition

selecting (112) the colour of the pixel from a distorted
multi-dimensional color space

using the modified colour of the pixel,
wherein distances from

colors within the color space to vertices of a color cube
are such as to favour a predetermined color;
d) performing (114, 122) an ink error diffusion process in accordance
with the difference between the determined ink contribution of the

pixel and an ink
amount needed to print a pixel of

the selected color
to update values in the ink error diffusion buffer for

neighbouring pixels;
e) performing (118, 120) a colour error diffusion process in accordance
with the difference between the selected color of the pixel

and the modified color of the pixel to update the diffused
color error for neighboring pixels; and
f) setting (116) the selected color of the pixel in an output
bitmap representing the original image.
The method of claim 1, wherein the input data used for
determining the ink contribution uses the following

equation:

(Ink Amount)
input data
 = 3 - red - green - blue.
The method of claim 1, wherein the input data used for
determining the ink contribution uses the following

equation: 

(Ink Amount)
input data
 = cyan + magenta + yellow.
The method of claim 1, wherein the value used to update the ink
error diffusion buffer and the diffused color error are

derived from a color selected for one or more neighboring
pixels.
The method of claim 4, wherein the value used to update the ink
error diffusion buffer is based on an ink amount associated

with the selected color subtracted (114) from the determined ink
contribution.
The method of claim 5, wherein the ink amount
associated with the selected color equals one of the

following: zero if the selected color is white; one if the
selected color is one of cyan, magenta and yellow, and the

color requires setting a pixel in one separation; two if
the closest color is one of red, green and blue, and the

color requires setting a pixel in two separations; and
three if the closest color is black.
The method of claim 5, wherein the ink amount equals
one of the following: zero if the closest color is black;

one if the closest color is one of red, green and blue, and
the color requires setting a pixel in one separation; two

if the closest color is one of cyan, magenta and yellow,
and the color requires setting a pixel in two

separations; and three if the closest color is white.
The method of claim 1, wherein the step of selecting
the color based on the distorted color space is by

determining a smallest distance between a color
representing the input data and each of the ink colors in

the distorted space by using the following equations:

D
cyan
 = ∥(red,green,blue)-(-P
cyan
, 1+P
cyan
, 1+P
cyan
)∥
D
magenta
 = ∥(red,green,blue)-(1+P
mag
, -P
mag
, 1+P
mag
)∥
D
yellow
 = ∥(red,green,blue)-(1+P
yel
, 1+P
yel
, -P
yel
)∥
D
black
 = ∥(red,green,blue)-(-P
blk
, -P
blk
, -P
blk
)∥
D
red
 = ∥(red,green,blue)-(1+P
red
, -P
red
, -P
red
)∥
D
green
 = ∥(red,green,blue)-(-P
grn
, 1+P
grn
, -P
grn
)∥
D
blue
 = ∥(red,green,blue)-(-P
blue
, -P
blue
, 1+P
blue
)∥
D
white
 = ∥(red,green,blue)-(1+P
wht
, 1+P
wht
, 1+P
wht
)∥
 
where, for example, D
cyan
 is the distance between the color
representing the input data and cyan, and P
cyan
 is a
predetermined penalty associated with cyan.
The method of claim 1, wherein the step (108) of selecting
the color of the pixel is partially based on comparing the

determined ink contribution to a predetermined value such
that:


when the determined ink contribution is below the
predetermined value, no color is selected; and
when the determined ink contribution is above the
predetermined value, the closest color in distorted space

is selected.
An apparatus for determining colors of a plurality of
pixels based on an original image, the apparatus

comprising:

a scanner (202) for scanning the original image and forming
input data representing an actual color;
a computer (204) for determining the color of the plurality
of pixels, the computer including:
an ink error diffusion buffer,
a determinator for determining (104) an ink contribution of
the pixel based on input data derived from the original

image and a value (106) from the ink error diffusion buffer, the
ink contribution representing the amount of ink needed to

print the pixel, and for determining a modified color of
the pixel based on the color of the pixel in the original

image and a diffused color error;
a comparator for comparing (108) the determined ink contribution
with a predetermined value ;
a selector
which, if the result of the comparison satisfies a predetermined

condition,
selects the color of the pixel

from a distorted multi-dimensional color space
using the modified colour of the pixel,

wherein
distances from colors within the color space to vertices of
a color cube are such as to favour a predetermined
color;
an updater for performing (114,122) an ink error diffusion process
in accordance with the difference between the determined ink

contribution of the pixel and an ink amount needed to print a pixel
of the selected color to update values in the ink error 

diffusion buffer for neighboring pixels, and for performing
(118,120)

a colour error diffusion process in accordance with the
difference between the selected color of the pixel and the

modified color of the pixel to update the diffused color
error for neighboring pixels;
a designator for setting the selected color of the
pixel in an output bitmap representing the original image;

and,
a printer (206) for formatting the output bitmap data.
</CLAIMS>
</TEXT>
</DOC>
