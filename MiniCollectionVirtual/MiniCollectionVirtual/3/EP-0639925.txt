<DOC>
<DOCNO>EP-0639925</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Motion vector detection
</INVENTION-TITLE>
<CLASSIFICATIONS>G06T720	G06T720	H04N732	H04N732	H04N726	H04N726	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G06T	G06T	H04N	H04N	H04N	H04N	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G06T7	G06T7	H04N7	H04N7	H04N7	H04N7	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
A reference block is divided (at 6) in the horizontal direction 
into small blocks, and is also divided in the vertical direction into 

small blocks. Feature values representing each of the small blocks 
formed from the reference block are obtained (at 8A, 8B). Similarly, 

a check block is divided (at 7) in the horizontal and vertical 
directions into small blocks and feature values representing the small 

blocks formed from the check block are obtained (at 9A, 9B). The 
feature values in the horizontal direction of the reference and check 

blocks are compared (at 10A), and the feature values in the vertical 
direction of the reference and check blocks are compared (at 10B). The 

results of the two comparisons comprise an evaluation value by which 
the degree of matching of the reference and check blocks is evaluated. 

The check block is moved (by 14) throughout a predetermined search 
range, and the process is repeated for each position of the check 

block. A motion vector is produced (by 12) between the reference block 
and the check block position at which the check block best matches the 

reference block. 

</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
SONY CORP
</APPLICANT-NAME>
<APPLICANT-NAME>
SONY CORPORATION
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
OGURA EIJI
</INVENTOR-NAME>
<INVENTOR-NAME>
TAKASHIMA MASATOSHI
</INVENTOR-NAME>
<INVENTOR-NAME>
YAMASHITA KEITARO
</INVENTOR-NAME>
<INVENTOR-NAME>
OGURA, EIJI
</INVENTOR-NAME>
<INVENTOR-NAME>
TAKASHIMA, MASATOSHI
</INVENTOR-NAME>
<INVENTOR-NAME>
YAMASHITA, KEITARO
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to detection of motion vectors
between two images, and, more particularly, is directed to efficient
detection of motion vectors.An example of a system in which motion vector detection is useful
is a system according to the Moving Picture Coding Experts Group (MPEG)
standard, which is concerned with high efficiency compression coding of
a moving image. In the MPEG standard, an image is encoded using
discrete cosine transformation (DCT) and predictive encoding with
motion compensation. Motion vectors are used during motion
compensation.Fig. 1 shows an example of an apparatus according to the MPEG
standard. Image data, also referred to as pixel data, is supplied to
an input terminal 201, which applies the image data to a motion vector
detecting circuit 202 and to a subtracting circuit 203.The motion vector detecting circuit 202 produces motion vectors
for a present frame relative to a reference frame, and supplies these
motion vectors to a motion compensating circuit 204 which applies the
motion vectors to the reference frame stored in frame memory 205 to
generate motion compensated image data. That is, the circuit 204
performs motion compensation on the reference frame read from frame
memory 205 using the motion vectors from circuit 202. The circuit 204
supplies the motion compensated image data to the subtracting circuit
203 and to an adding circuit 206.The subtracting circuit 203 functions to subtract the motion
compensated image data of the reference frame from the image data of
the present frame supplied from input terminal 201 to produce
difference data, and to supply the difference data to a DCT circuit
207.The DCT circuit 207 operates to transform the difference data to
produce coefficient data, and to supply the coefficient data to a
quantizer 208 which functions to quantize the coefficient data and to
supply quantized data to an output terminal 209 and to an inverse
quantizer 210.The inverse quantizer 210 dequantizes the quantized data supplied
thereto to produce recovered coefficient data, and applies the
recovered coefficient data to an inverse DCT circuit 211 which inverse
transforms the recovered coefficient data to produce recovered 
difference data and supplies the recovered difference data to the
adding circuit 206. The adding circuit 206 adds the motion compensated
image data of the reference frame to the recovered difference data to
produce predicted image data of the present frame and supplies the
predicted present frame image data to the frame memory 205
</DESCRIPTION>
<CLAIMS>
An apparatus for detecting motion vectors, comprising:

first storage means (1) for storing present image data and
reading out a reference block (15) of the present image data

having a first size;
first small block forming means (6) for dividing the read
out reference block in each of two directions, thus providing a set of small

blocks for each of said two directions (HA1 etc, VA1 etc);
second storage means (3) for storing a search range (SV) of
reference image data, which search range has a second size as

least as large as said first size, and for reading out different
portions of the stored search range as check blocks (16) having

said first size in response to a control signal;
second small block forming means (7) for dividing the read
out check block in each of said two directions, thus providing a set of

small blocks for each of said two directions (HB1 etc, VB1 etc);
control signal generating means (14) for generating said
control signal indicating said different portions of said search

range stored in said second storage means (3); and
means (10, 11, 12) for comparing said sets of small blocks
produced by the first and second block forming means (6,7) in

each of said two directions to determine which of the check
blocks read out from said search range best matches said

reference block, and for producing a motion vector between said
reference block and the best matching check block.
The apparatus of claim 1, wherein said two directions
comprise a vertical direction and a horizontal direction.
The apparatus of claim 1, wherein said two directions
comprise a first oblique direction substantially perpendicular

to a second oblique direction.
The apparatus of claim 1, wherein said first and second
small block forming means are respectively operative to divide

each of said small blocks formed in one of said two directions
in the other of said two directions.
The apparatus of claim 1 or claim 2, wherein said means for 
comparing is operative to compare the small blocks formed from

said read out reference block in a first one of said two
directions with the small blocks formed from said read out check

block in said first direction, and is also operative to compare
the small blocks formed from said read out reference block in the

second of said two directions with the small blocks formed from
said read out check block in said second direction.
The apparatus of claim 5, wherein said means for comparing
is operative to weight the comparison of said small blocks in

said first direction relative to the comparison of said small
blocks in said second direction.
The apparatus of any preceding claim, wherein said means
for comparing comprises difference means (10A, 10B) for obtaining

differences between respective small blocks of said first and
second sets of small blocks formed from said read out reference

and check blocks, absolute value means (10A, 10B) for obtaining
respective absolute values of said differences, and means (10A,

10B) for summing the absolute values of the differences between
said small blocks of said read out reference and check blocks.
The apparatus of any preceding claim, comprising first
feature means (8A, 8B) for genera
ting at least one first feature
value for each of the small blocks produced by the first block

forming means (6), second feature means (9A, 9B) for generating
at least one second feature value for each of the small blocks

produced by the second small block forming means (7), and wherein
said means for comparing is operative to compare said first and

second feature values.
The apparatus of claim 8, wherein each of the small blocks
formed from said read out reference block and said read out check

block comprises pixels; and each of said at least one first and
second feature values comprises one of a sum of the pixels in

said each of the small blocks, an average of the pixels in said
each of the small blocks, minimum and maximum values of the

pixels in said each of the small blocks, at least one Hadamard
conversion coefficient for the pixels in said each of the small

blocks, at least one DCT coefficient for the pixels in said each 
of the small blocks, at least one wavelet conversion coefficient

for the pixels in said each of the small blocks, maximum and
minimum values of at least one Hadamard conversion coefficient

for the pixels in said each of the small blocks, maximum and
minimum values of at least one DCT coefficient for the pixels in

said each of the small blocks, and maximum and minimum values of
at least one wavelet conversion coefficient for the pixels in

said each of the small blocks.
The apparatus of claim 8 or claim 9, wherein each of said
first and second feature means comprises low pass filter means

for low pass filtering said each of said small blocks produced
by the first and second block forming means (6,7) respectively.
The apparatus of any of claims 8 to 10, wherein said second
feature means is operative to modify the feature value for a

current one of said small blocks formed from said read out check
block to produce the feature value for a next one of said small

blocks formed from said read out check block.
The apparatus of claim 11, wherein each of the small blocks
formed from said read out check block comprises pixels; and said

second feature means comprises means (41) for adding a pixel of
said next one of said small blocks to said feature value for a

current one of said small blocks to produce an intermediate
result, and means (43) for subtracting a pixel of said current

one of said small blocks from said intermediate result to produce
said feature value for said next one of said small blocks.
The apparatus of any of claims 8 to 12, wherein said first
and second small block forming means are respectively operative

to form first and second sets of small blocks in said two
directions; said first and second feature means each comprise

first means for generating at least one feature value for each
of the small blocks formed in a first of said two directions, and

second means for generating at least one feature value for each
of the small blocks formed in the second of said two directions;

and said means for comparing is operative to compare the small
blocks formed from said read out reference block in said first

direction with the small blocks formed from said read out check 
block in said first direction, and is also operative to compare

the small blocks formed from said read out reference block in
said second direction with the small blocks formed from said read

out check block in said second direction.
The apparatus of claim 13, wherein said means for comparing
is operative to weight the comparison of said small blocks in

said first direction relative to the comparison of said small
blocks in said second direction.
The apparatus of any of claims 8 to 14, comprising means
(125) for interpolating the feature values for said small blocks

in said second set of small blocks to produce interpolated
feature values, and wherein said means for comparing is operative

to compare said feature values for said first set of small blocks
with said interpolated feature values for said second set of

small blocks so that said motion vector has a resolution of
higher than one pixel.
The apparatus of any preceding claim, wherein said search
range comprises pixels; said means for indicating said different

portions of said search range is operative to indicate coarse
portions of said search range respectively differing by at least

two pixels, and second read control means is operative to
indicate fine portions of a subset of said search range

respectively differing by one pixel; and said means for producing
a motion vector is operative to produce a coarse motion vector

in response to the read out check blocks from said coarse
portions of said search range and is operative to produce a fine

motion vector in response to the read out check blocks from said
fine portions of said subset of said search range.
The apparatus of claim 16, wherein said means for
indicating comprises first read control means (105) for

indicating said coarse portions of said search range and second
read control means (106) for indicating said fine portions of

said subset of said search range.
The apparatus of claim 16, comprising interpolating means
for interpolating the portion read out of said subset of said 

search range to form interpolated data; and wherein said second
small block forming means is operative to also form said

interpolated data into said second set of small blocks so that
said fine motion vector has a resolution of higher than one

pixel.
The apparatus of claim 1, wherein said search range
comprises pixels; and comprising interpolating means (125) for

interpolating the pixels read out of said stored search range to
form interpolated pixels; and wherein said second small block

forming means is operative to also form said interpolated pixels
into said second set of small blocks so that said motion vector

has a resolution of higher than one pixel.
The apparatus of claim 19, wherein said interpolating means
is operative to interpolate two pixels read out of said search

range to form one of said interpolated pixels.
</CLAIMS>
</TEXT>
</DOC>
