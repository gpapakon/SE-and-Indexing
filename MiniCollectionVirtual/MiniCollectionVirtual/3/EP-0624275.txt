<DOC>
<DOCNO>EP-0624275</DOCNO> 
<TEXT>
<INVENTION-TITLE>
METHOD AND SYSTEM FOR THE ARRANGEMENT OF VOCODER DATA FOR THE MASKING OF TRANSMISSION CHANNEL INDUCED ERRORS
</INVENTION-TITLE>
<CLASSIFICATIONS>G10L1900	H04B166	G10L1900	H03M1335	H04L100	H03M1300	H04L100	G10L1902	H04B166	G10L1906	H04J1302	H04J1302	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G10L	H04B	G10L	H03M	H04L	H03M	H04L	G10L	H04B	G10L	H04J	H04J	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G10L19	H04B1	G10L19	H03M13	H04L1	H03M13	H04L1	G10L19	H04B1	G10L19	H04J13	H04J13	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
A method and system (16) by which parameter data representative of vocoded speech are organized into a data packet for transmission so as to reduce the impact of transmission channel induced errors on the data packet. A data packet is constructed with certain most perceptually significant bits of parameter data at the beginning of the data packet. Following in the data packet are lesser perceptually significant bits of the same parameter data. Other parameter data then follows in the data packet. Interleaved in the data packet following the most perceptually significant bits at the beginning of the data packet are most perceptually significant bits of other parameter data. A parity check code is computed from the most perceptually significant bits in the data packet and also interleaved in the data packet following the most perceptually significant bits at the beginning of the data packet.
</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
QUALCOMM INC
</APPLICANT-NAME>
<APPLICANT-NAME>
QUALCOMM INCORPORATED
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
GARDNER WILLIAM R
</INVENTOR-NAME>
<INVENTOR-NAME>
JACOBS PAUL E
</INVENTOR-NAME>
<INVENTOR-NAME>
GARDNER, WILLIAM, R.
</INVENTOR-NAME>
<INVENTOR-NAME>
JACOBS, PAUL, E.
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to the organization of data for transmission. More particularly, the present invention
relates to a novel and improved method and system for the packing of variable rate vocoder generated data
into data packets for transmission, and for the unpacking of received variable vocoder data packets for speech reconstruction.In the field of digital communications, various arrangements of digital data for transmission are used. The
data bits are commonly organized into data packets for transfer over the communication medium. In the case of data
generated by a vocoder, the data is also organized for transmission.Generally in the preparation of a data packet for transmission over a communication channel, some form of
forward error correction encoding may be used to protect the data from transmission channel induced errors. In the
event that channel errors do occur in the error correction encoded data, in many instances the errors may be detected
and corrected.Interleaving of data is a well known technique for protecting data from transmission channel induced errors.
This technique is described in, for example, US-A-4,922,537 to Frederiksen dated May 1, 1990.While error correction techniques do provide a valuable method for reducing channel errors, such techniques
alone may not sufficiently provide the level of protection necessary. In the case where portions of the data packet are
of significantly greater importance than others, it is desirable to provide further forms of protection from channel errors.
An example of such a case is where the data packet contains vocoder data where certain parameters are of greater
significance in reconstruction of the speech data therefrom.US-A-4,903,301 to Kondo et al. dated February 20, 1990 discloses a speech signal transmission system for
transmitting coded speech signals with variable bit rate, which comprises a coder for analyzing digital speech signals
inputted in a one-frame period and transforming them into coded data. The coded data comprises a plurality of parameters
indicating characteristics of inputted speech signals. The system also comprises a data arranging circuit for
arranging the coded data outputted by the coder in the order of the priority in the decoding of the speech signals and
outputting them, and a bit stealer allowing a series of coded data outputted successively by the data arranging circuit
to pass through only in a period of time determined by the transmission bit rate. The bit arranging circuit outputs the
parameters in
</DESCRIPTION>
<CLAIMS>
A method for use in a vocoding system, for formatting 
vocoded
 speech parameter data
into a data packet for transmission,

said method comprising steps of:

generating said 
vocoded
 speech parameter data in response to an input frame of
speech samples, wherein certain data of said speech parameter data is of greater

relative importance than other data of said speech parameter data; and
providing a beginning packet portion of a data packet consisting of 
some bits of said certain
data as
 a certain portion of said certain data;
characterized by
providing in a remaining packet portion of said data packet following said beginning
packet portion, interleaved data formed by interleaving a remaining portion of

said certain data with said other data, so that said certain portion of said certain data
is said beginning packet portion and said remaining portion of said certain

data is interleaved throughout said remaining packet portion.
The method of Claim 1, further comprising the steps of:

computing an error correcting code from said certain data: and
interleaving said error correcting code within said interleaved data in said remaining packet portion.
A method according to Claim 1 or Claim 2, 
characterized by
 providing, within said remaining packet portion of said
data packet, another certain portion of said certain data.
A method according to Claim 3, wherein said certain portion comprises data of a first parameter type, said another
certain portion comprises data of said first parameter type and data of a second parameter type and said step of

providing said another certain portion of said certain data comprises the steps of:

providing data of said first parameter type immediately following said certain portion of said certain data in
said data packet; and
providing data of said second parameter type immediately following data of said first parameter type in said
data packet.
A method according to Claim 3, wherein said certain portion comprises data of a first parameter type and said
another certain portion of said certain data comprises data of a second parameter type and data of a third parameter

type, and wherein said other data comprises data of a third parameter type and data of a fourth parameter type,
and said step of providing interleaved data in a remaining packet portion of said data packet comprises the steps of:


providing data of said third parameter type immediately following said certain portions in said data packet; and
providing data of said fourth parameter type immediately following data of said third parameter type in said
data packet.
A method according to Claim 2, for use in a vocoding system in which a variable rate linear prediction coding (LPC)
vocoder encodes frames of speech samples to produce corresponding sets of encoded speech parameter data

based upon an analysis of speech samples in each speech sample frame and predetermined subframes thereof,
for formatting a frame of one rate parameter data for transmission to reduce the impact of transmission channel

induced errors in a transmitted frame of parameter data as received and reconstructed into a corresponding frame
of speech samples, wherein the method includes the steps of:


receiving Line Spectral Pair (LSP) frequency data,
receiving pitch data,
receiving codebook data,

and wherein said step of computing an error correcting code comprises:

computing a parity check code from certain ones of said LSP frequency data, said pitch data and said codebook 
data; and
said steps of providing data in a packet and interleaving said error correcting code comprise:

assembling in a predetermined sequence within a beginning packet portion of a data packet, a first portion of
each one of said LSP frequency data;
assembling in a predetermined sequence, other than within said beginning packet portion, a second portion
of each one of said LSP frequency data, said sequence of second portions of LSP frequency data following

said sequence of first portions of said LSP frequency data in said data packet;
providing, other than within said beginning packet portion, a sequence of said pitch data and said codebook
data following said sequence of said second portions of LSP frequency data in said data packet; and
providing said parity check code within said data packet other than within said beginning packet portion.
A method according to Claim 6, further comprising the step of interleaving said parity check code within said data
packet following said first portions of each one of said LSP frequency data.
A method according to Claim 7, further comprising the step of interleaving within said data packet, a portion of
each codebook data within said sequence of second portions of each one of said LSP frequency data and within

said sequence of said pitch data and said codebook data, wherein said parity check codes are interleaved within
said sequence of pitch data and codebook data following said interleaved portions of codebook data.
A method according to Claim 6, wherein, at said one rate, a first plurality of sets of pitch data comprises four sets
of pitch data with each set of pitch data comprising pitch lag and pitch gain data, and a first plurality of sets of

codebook data comprises eight sets of codebook data with each set of codebook data comprising codebook index
and codebook gain data.
A method according to Claim 6, for formatting a frame of another rate parameter data for transmission, further
comprising the steps of:


receiving second Line Spectral Pair (LSP) frequency data;
receiving second pitch data;
receiving second codebook data;
assembling in a predetermined sequence at a beginning of a data packet, each one of said LSP frequency
data of said second LSP frequency data; and
assembling in a predetermined sequence, said second pitch data and codebook data following said sequence
of LSP frequency data in said data packet.
A method according to Claim 2, for providing a frame of full rate variable rate vocoder data from received speech
samples, said method comprising the steps of:


generating speech parameter data representative of the received speech samples;
providing, from the speech parameter data, an ordered sequence of most significant line spectral pair (LSP)
bits;
providing, from the speech parameter data, an interleaved sequence of less significant LSP bits and certain
ones of most significant codebook gain (CBGAIN) bits; and
providing, from the speech parameter data, an interleaved sequence of remaining CBGAIN bits, pitch gain
(PGAIN) bits, pitch lag (PLAG) bits, codebook index (CBINDEX) bits and parity check bits (PCB).
A method according to Claim 1, for providing a frame of half rate variable rate vocoder data from received speech
samples, said method comprising the steps of: 


generating speech parameter data representative of the received speech samples;
providing, from the speech parameter data, an ordered sequence of line spectral pair (LSP) bits; and
providing, from the speech parameter data, an ordered sequence of codebook gain (CBGAIN) bits, pitch gain
(PGAIN) bits, pitch lag (PLAG) bits and codebook index (CBINDEX) bits.
A method according to Claim 1 for providing a frame of quarter rate variable rate vocoder data from received
speech samples, said method comprising the steps of:


generating speech parameter data representative of the received speech samples;
providing, from the speech parameter data, an ordered sequence of line spectral pair (LSP) bits; and
providing, from the speech parameter data, an ordered sequence of codebook gain (CBGAIN) bits, pitch gain
(PGAIN) bits, pitch lag (PLAG) bits and codebook index (CBINDEX) bits.
A method according to Claim 1, for providing a frame of eighth rate variable rate vocoder data from received speech
samples, said method comprising the steps of:


generating speech parameter data representative of the received speech samples;
providing, from the speech parameter data, an interleaved sequence of codebook seed (CBSEED) bits and
line spectral pair (LSP) bits; and
providing, from the speech parameter data, an ordered sequence of codebook gain (CBGAIN) bits.
A method of reordering speech parameter data within received variable data rate frames of vocoded speech parameter
data transmitted following formatting in a data packet by the method of Claim 1, for use in a vocoding

system in which vocoded speech parameter data are decoded into corresponding frames for reproduction of
speech samples, wherein parameter data of a highest rate frame contains a portion of each parameter data of one

parameter data type in a predetermined order within a beginning packet portion of the data packet, said beginning
packet portion being followed by a remaining packet portion within which is provided another portion of each parameter

data of said one parameter data type in a predetermined order, said another portions being followed within
said remaining packet portion by remaining parameter data of said variable data rate frame, and parity data being

provided within said remaining packet portion, said parity data being computed from parameter data within said
data packet, said method comprising the steps of:


receiving a highest rate frame of parameter data:
reassembling corresponding ones of said portion and said another portion of each parameter data of said one
parameter data type to provide reassembled data;
computing parity data from parameter data in said received highest rate frame of parameter data;
comparing said computed parity data with said parity data in said received highest rate frame of parameter
data; and
providing said reassembled data and said remaining parameter data for the reproduction of said speech samples,
if said computed parity data is the same as said received parity data.
A method according to Claim 15, wherein lower rate frames of parameter data are formatted with parameter data
in a data packet in a predetermined order corresponding to the data rate of said variable data rate frame, further

comprising the steps of:

receiving an indication of a data rate for each received variable data rate frame of parameter data; and
providing parameter data in a predetermined format according to said received variable data rate frame data 
rate indication.
A method according to Claim 15, wherein said highest rate frame of parameter data further has a portion of each
parameter data of another parameter data type interleaved within said another portion of parameter data of said

one parameter data type, further comprising the step of reassembling each interleaved portion of parameter data
of said another parameter data type with a corresponding remaining portion of each of said parameter data of said

another parameter data type.
A method according to Claim 15, further comprising the steps of:

receiving a full rate likely indication for said received highest rate frame of parameter data, said full rate likely
indication being indicative of at least one error in at least one of said parameter data and said parity data;
computing parity data from parameter data in said received highest rate frame of parameter data;
comparing said computed parity data with said parity data in said received highest rate frame of parameter data;
detecting from said comparison of said computed parity data with said parity data in said received highest rate
frame of parameter data, an error in at least one of said parameter data and said parity data in said received

highest rate frame of parameter data;
correcting said detected error if occurring in certain ones of said parameter data and said parity data in said
received highest rate frame of parameter data;
reassembling corresponding ones of said portions and said another portions of each parameter data of said
one parameter data type; and
providing an output of said parameter data when said detected error occurs in said certain ones of said parity
data and from corrected parameter data when said detected error occurs in said certain ones of said parameter

data.
A vocoding system for formatting 
vocoded
 speech parameter data into a data packet for
transmission, the system comprising:


(a) means for generating 
vocoded
 speech parameter data in response to an input frame
of speech samples wherein certain data of said speech parameter data is of greater

relative importance than other data of said speech parameter data; and
(b) means for providing a beginning packet portion of a data packet consisting of 
some bits of
said certain data as
 a certain portion of said certain data;
characterized in that
 the system further comprises:
(c) means for providing in a remaining packet portion of said data packet following
said beginning packet portion, interleaved data formed by interleaving the remaining

portion of said certain data with said other data, so that said certain portion of
said certain data is said beginning packet portion and said remaining portion

of said certain data is interleaved throughout said remaining packet portion.
A system according to claim 19, for use in digital communication for transmitting a frame of data wherein transmission
errors will most likely be in a burst format affecting the later bits in said data packet, the system further

comprising:

control means (34) for providing an ordering signal indicative of an ordered sequence of data wherein said
ordering signal is indicative of a packet format in which the most significant bits of said frame of data are

provided in a first part of said data packet and the most significant bits of the remaining data of said frame of
data are interleaved throughout a second part of said data packet; and
input means (36) for receiving said frame of data and providing said data packet in accordance with said
ordering signal.
A system according to Claim 20, wherein said control means (34) is responsive to a data rate signal.
A system according to Claim 20 or 21, including a vocoder (16) comprising:

vocoder engine means (30) for receiving a frame of speech samples and providing speech parameter data
representing said frame of speech samples in accordance with a predetermined speech model; and
ordering means (34, 32, 36) for receiving said speech parameter data and providing a packet of speech parameter
data, wherein the most perceptually significant portions of said speech parameter data are provided

in a first part of said packet, remaining portions of said speech parameter data are provided in a second part
of said packet following said first part, and portions of said remaining portions of speech parameter data are

interleaved throughout said second part of said packet in accordance with at least one predetermined format.
A system according to Claim 22, wherein said vocoder engine means (30) comprises:

means for providing linear predictive code (LPC) data;
means for providing pitch data; and
means for providing codebook data.
A system according to Claim 23, further comprising means for converting said LPC data to line spectral pair (LSP)
data.
A system according to Claim 24, wherein said ordering means (34, 32, 36) provides said LSP data first in said
packet.
A system according to Claim 22, wherein said vocoder engine means (30) provides said parameter data at a
selected data rate and provides a data rate signal indicative of said selected data rate, and said ordering means

(34, 32, 36) is responsive to said data rate signal.
A system according to Claim 20, further comprising:

parity check bit computation means (38) for receiving a frame rate indication and predetermined portions of
a frame of parameter data, said parity check bit computation means (38) being responsive to a highest frame

rate indication for computing and providing an output of parity check bit data; and
data packing means (34, 32, 36) for receiving said frame rate indication, said frame of parameter data and
said parity check bit data, said data packing means (34, 32, 36) being responsive to said frame rate indication

for organizing said frame of parameter data for output according to a predetermined format in a data packet,
wherein, at said highest frame rate indication, said data packing means (34, 32, 36) arranges said data packet

such that a sequence of a portion of each parameter data of one parameter data type is provided in a beginning
packet portion, and a sequence of a remaining portion of each parameter data of said one parameter data

type is provided, within a remaining packet portion following said beginning packet portion, with remaining
parameter data of said frame of parameter data and said parity check bit data.
A system according to Claim 27, wherein said data packing means (34, 32, 36), in response to said highest frame
rate indication, is further for arranging said data packet with a portion of said remaining parameter data and said

parity check bit data interleaved throughout said remaining portions of each parameter data of said one parameter
data type and said remaining parameter data.
A system according to Claim 28, wherein said data packing means (34, 32, 36) is responsive to rate indications
other than said highest frame rate indication, for arranging said data packet to begin with a data sequence of one

parameter data type, followed by data sequences of remaining parameter data types.
A system according to Claim 29, wherein said data packing means (34, 32, 36) comprises:

frame buffer means (32) for receiving and storing said frame of parameter data, and for receiving a first output
signal and providing an output of selected parameter data and portions thereof; 
packet buffer means (36) for receiving and storing said output of selected parameter data and portions thereof
from said frame buffer means (32) and said parity check bit data from said parity check bit computation means

(38), and for providing an output of said selected parameter data and portions thereof as said data packet; and
packing means (34) for receiving said rate indication and generating a said first output signal for controlling
the output of data from said packet buffer means (36).
A system according to Claim 20, comprising:

a buffer subsystem (32, 36) having a first input for receiving a frame of vocoder parameter data, a second
input for receiving an ordering signal, and an output, wherein said buffer subsystem (32, 36) is responsive to

an ordering signal for providing at said output a reordered frame of data; and
packing logic (34) having an output coupled to said second input of said buffer subsystem (32, 36), for generating
and providing said ordering signal at said packing logic (34) output.
A system according to Claim 31, wherein said packing logic (34) has an input for receiving a rate signal.
A system according to Claim 31, wherein said buffer subsystem (32, 36) further comprises a third input, said system
further comprising a parity computation logic (38) having an input for receiving said frame of vocoder data and an

output coupled to said third input of said buffer subsystem (32, 36).
A system according to Claim 31, further comprising a microprocessor interface (18) having an input coupled to
said buffer subsystem (32, 36) output and having an output.
A system according to Claim 31, wherein said buffer subsystem (32, 36) comprises:

an output frame buffer (32) having two inputs and an output; and
an output packet buffer (36) having an input coupled to said output frame buffer (32) output and having an
output.
A system according to Claim 31, wherein said packing logic (34) generates said ordering signal based upon a
frame rate of vocoder parameter data.
A system according to Claim 19, for use in digital communication wherein data from a frame of data is reordered
to provide more significant portions of said data in a first portion of a transmission packet, remaining portions of

said data are provided in a second portion of said transmission packet distinct from said first portion of said transmission
packet, and portions of said remaining data are interleaved throughout said second portion of said transmission

packet, the system further comprising, for reordering said frame of data:

control means (44) for providing a control signal based upon a frame rate associated with said transmission
packet, said control signal being indicative of an unpacking order for said transmission packet; and
input means (42) for receiving said transmission packet and providing reordered data from said transmission
packet in accordance with said control signal.
A system according to Claim 37, wherein said transmission packet further comprises at least one parity bit, said
system further comprising a parity check means (48) for receiving said transmission packet and determining in

accordance with a predetermined parity format, at least one check bit, comparing said at least one check bit with
said at least one parity bit, and providing a signal indicative of the equality of said at least one parity bit and said

at least one check bit.
A system according to Claim 37 or Claim 38, for use in communication wherein a frame of speech samples is
encoded according to a speech model to provide a frame of parameter data, said frame of parameter data is

reordered to provide more significant portions of said parameter data in a first portion of a transmission packet,
remaining portions of said parameter data are provided in a second portion of said transmission packet distinct

from said first portion of said transmission packet, and portions of said remaining data are interleaved throughout 
said second portion of said transmission packet, the system further comprising, for providing an estimate of said

frame of speech samples from said transmission packet:

ordering means (44, 42, 46) for receiving said transmission packet and providing reconstructed estimates of

said parameter data from said transmission packet, said reconstructed estimates of said parameter data being
ordered in response to a frame rate associated with said transmission packet; and
vocoder means (30) for receiving said reconstructed estimates of said parameter data and decoding said
reconstructed estimates of said parameter data in accordance with said speech model to provide an estimate

of said frame of speech samples.
A system according to Claim 39, wherein said transmission packet comprises parameter data at a selected data
rate, said selected data rate is selected from a plurality of data rates, and said vocoder means (30) is further for

decoding said parameter data in accordance with said selected data rate.
A system according to any one of Claims 37 to 40, for unpacking an ordered packet of vocoder data to provide
unpacked vocoder data, the system further comprising:


a buffer subsystem (42, 46) having a first input for receiving said ordered packet of vocoder data, a second
input addressed by an unpacking signal, and an output for providing a sequence of data bits corresponding

to said unpacked vocoder data, said sequence being of an order determined in accordance with said unpacking
signal; and
an unpacking logic (44) having an output coupled to said second input of said buffer subsystem (42, 46), for
generating said unpacking signal at said unpacking logic (44) output.
A system according to Claim 41, wherein said unpacking logic (44) has an input for receiving a rate signal.
A system according to Claim 42, wherein said unpacking logic (44) has an additional input, said system further
comprising a parity check bit logic (48) having an input for receiving said ordered packet of vocoder data and an

output coupled to said additional input of said unpacking logic (44).
A system according to Claim 41, wherein said buffer subsystem (42, 46) comprises:

an input packet buffer (42) having two inputs and an output; and
an input frame buffer (46) having an input coupled to said output of said input packet buffer (42) and an output.
A system according to Claim 41, wherein said unpacking logic (44) generates said unpacking signal at least partially
in response to a frame rate indication associated with said ordered packet of vocoder data.
A system according to Claim 37, in which received variable rate frames of data contain vocoded speech parameter
data with the frame data formatted according to a predetermined format, and the parameter data is decoded into

corresponding frames of speech samples, the system further comprising, for reorganizing parameter data; within
each received variable rate frame of parameter data:


input means (42) for receiving and storing a frame of data, and for providing an ordered sequence of data of
said received frame of data in accordance with a control signal; and
unpacking means (44) for providing said control signal in accordance with said received frame of data.
A system according to Claim 46, wherein a highest rate frame of data contains a portion of each parameter data
of one parameter data type in a predetermined order at a beginning of the data packet, said beginning of the data

packet being followed by another portion of each parameter data of said one parameter data type in a predetermined
order, said another portions being followed by remaining parameter data, and parity data being provided

within said data packet, said system further comprising:

parity check means (48) for receiving said parity data in a received highest rate frame of parameter data, 
computing parity data from parameter data in said received highest rate frame, comparing said computed

parity data with said received highest rate frame parity data, and providing an indication when said computed
parity data is the same as said received parity data;


said input means (42) being responsive to said control signal and said indication for providing an output of
said parameter data comprised of reassembled corresponding ones of said portions and said another portions

of each parameter data of said one parameter data type.
A system according to Claim 47, wherein said highest rate frame of parameter data further has a portion of each
parameter data of another parameter data type interleaved within said another portions of parameter data of said

one parameter date type, said input means (42) being further responsive to said control signal for providing an
output of each interleaved portion of parameter data of said another parameter data type with a corresponding

remaining portion of each of said parameter data of said another parameter date type.
A system according to Claim 47, wherein:

said unpacking means (44) and said parity check means (48) further receive a full rate likely indication for said
received highest rate frame of parameter data, said full rate likely indication being indicative of at least one

error in at least one of said parameter data and said parity data;
said parity check means (48) is further for detecting from said comparison of said computed parity data with
said parity data in said received highest rate frame of parameter data, an error in at least one of said parameter

data and said parity data in said received highest rate frame of parameter data, and for correcting said detected
error if occurring in certain ones of said parameter data and said parity data in said received highest rate frame

of parameter data; and
said input means (42) is responsive to said control signal and said indication for providing an output of said
parameter data when said detected error occurs in said certain ones of said parity data, and an output of

corrected parameter data when said detected error occurs in said certain ones of said parameter data, and
said output parameter data and corrected parameter data being comprised of reassembled corresponding

ones of said portions and said another portions of each parameter data of said one parameter data type.
A method according to any of Claims 1 to 18, or a system according to any of Claims 19 to 49, when used in Code
Division Multiple Access (CDMA) communications.
</CLAIMS>
</TEXT>
</DOC>
