<DOC>
<DOCNO>EP-0658044</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Image production using color error diffusion
</INVENTION-TITLE>
<CLASSIFICATIONS>H04N152	H04N152	G06T500	H04N164	G06F312	H04N164	G06T500	G06T100	G06T100	G06F312	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>H04N	H04N	G06T	H04N	G06F	H04N	G06T	G06T	G06T	G06F	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>H04N1	H04N1	G06T5	H04N1	G06F3	H04N1	G06T5	G06T1	G06T1	G06F3	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
A color printing system (10) includes a discrete CMY color 
printer (12), a LAB color error diffuser (14), and a LAB/CMY 

converter (16). The diffuser includes an image compensator (20), a color 
space reverter (22), an error calculator (24), and an error diffuser (26). 

The color space reverter provides for error diffusion in a (LAB) color 
space that is different from the (CMY) color space of the printer. The 

perceptual linearity of the LAB color space provides for enhanced color 
fidelity in the printed image. In addition, color conversion and error 

diffusion are performed together, minimizing computational error 
accumulation and maximizing computational throughput. 


</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
HEWLETT PACKARD CO
</APPLICANT-NAME>
<APPLICANT-NAME>
HEWLETT-PACKARD COMPANY
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
DISPOTO GARY J
</INVENTOR-NAME>
<INVENTOR-NAME>
MOTTA RICARDO J
</INVENTOR-NAME>
<INVENTOR-NAME>
DISPOTO, GARY J.
</INVENTOR-NAME>
<INVENTOR-NAME>
MOTTA, RICARDO J.
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to color image production,
for example to production of color images on a discrete-tone
color production device.Despite the obvious appeal of color printers, monochrome printers
dominate the marketplace for several reasons. One reason for the
relative paucity of color printers is the added complexity and expense of
producing color. Beyond this, there is the problem of producing or
reproducing "faithful" color. Human perception can be forgiving of
variations in brightness of a monochrome image, but relatively
intolerant of variations in hue in a color image. For example, errors in
the blue of the sky, the green of grass, and fleshtones are often quite
objectionable.Faithful color reproduction is a challenge for all color printers. In
general, the image to be printed is described in a different color space
than that used by the printer. For example, color images stored in
computers are often edited in an RGB (red-green-blue) color space,
typically used by color monitors. Printers typically print in a CMY
(cyan-magenta-yellow) color space. Thus, an RGB to CMY conversion is
required for printing. The color space conversion is far from trivial, and
can require substantial processing. Even when the original image is
nominally in the same color space as the printer, e.g., both are CMY,
differences among CMY color spaces can require color conversion.
Further complicating matters is the trend in small desktop printers to
use black ink in addition to color inks to provide more acceptable blacks;
color conversion is then to a four-dimensional space, e.g., CMYK, where
"K" is black. Even whit proper color conversion, faithful color reproduction is a
problem, particularly for printers that are not continuous tone.
"Continuous tone" refers to a capability of producing every color within a
printer's color gamut that can be distinguished by the human eye.
Continuous tone printers can print thousands, if not millions, of
different colors. Thus, for a continuous-tone printer, the problem of
faithful color production is primarily a problem of communicating to the
printer which colors to print.Discrete-tone color printers cannot print all distinguishable colors
within their gamut. Early popular ink jet printers provided only eight
colors; more recent ink jet printers can provide dozens of distinguishable
colors by varying dot size. Such limited color palettes are useful for
"business graphics", e.g., bar graphs and pie charts, but nor for general
image production. One could not, for example,
</DESCRIPTION>
<CLAIMS>
A color production system (10) for producing a color image from
source image data, said system comprising:


a discrete-tone color image production device (12) for producing said
color image as a function of output image data, said output image data

assigning to image pixels colors from a device state color space (discrete-CMY);
an error diffuser (14) including a colour space reverter (22) operable to convert
output image data into LAB space as reverted image data, the error diffuser being

operable to implement colour error diffusion in a CIELAB diffusion colour space to
provide adjusted image data from said source image data as a function of said output

image data in said diffusion colour space, said source image data assigning colours in
said diffusion colour space to said pixels, said adjusted image data assigning colours

in said diffusion colour space to said pixels, said diffusion colour space having greater
colour resolution than said device state colour space; and
a vector colour space converter (16) for converting said adjusted image data to said
output image data, said colour space converter performing a vector colour space

conversion on said adjusted image data directly into the device state colour space to
obtain said output image data, said colour space converter being coupled to said error

diffuser for receiving said adjusted image data therefrom, said colour space converter
being coupled to said colour image production device for providing said output image

data thereto.
A system as recited in Claim I wherein said diffusion space is perceptually
linear. 
A system as recited in Claim 1 or 2, wherein said error
diffuser includes:


an image compensator (20) for adjusting said source image data by
combining compensation vectors therewith on a pixel-by-pixel basis to

provide said adjusted image data;
an error calculator (24) for calculating colour errors between said adjusted image data
and said reverted image data, said error calculator being coupled to said image

compensator for receiving said adjusted image data therefrom, said error calculator being
coupled to said colour space reverter for receiving said reverted image data therefrom;

and
an error distributor (26) for determining said compensation vectors as a function of
said colour errors, said error distributor being coupled to said error calculator for

receiving said colour errors therefrom, said error distributor being coupled to said image
compensator for providing said compensation vectors thereto.
A method of producing a colour image from source image data, comprising the steps
of:


producing said colour image as a function of output image data, said
output image data assigning to image pixels colours from a device colour space

(discrete-CMY);
converting output image data into LAB space as reverted image data;
implementing, on the basis of said reverted image data, colour error diffusion in a CIELAB diffusion colour space to
provide adjusted image data from said source image data as a function of said output

image data in said diffusion colour space, said source image data assigning colours in
said diffusion colour space to said pixels, said adjusted image data assigning colours in

said diffusion colour space to said pixels, said diffusion colour space having greater
colour resolution than said device colour space; and
converting said adjusted image data to said output image data, by
performing a vector colour space conversion on said adjusted image data directly into the

device state colour space to obtain said output image data.
A method as recited in claim 4, wherein said diffusion colour space is
perceptually linear. 
A method as recited in Claim 4 or 5, wherein said step
of performing error diffusion involves:


adjusting (202) said source image data by combining
therewith compensation vectors on a pixel-by-pixel basis;
calculating color errors (205) by comparing said
adjusted image data with said reverted image data on a pixel-by-pixel

basis; and
determining said compensation vectors (206) as a
function of said color errors.
A method of producing an image on a device from source
image data, said device producing colors in response to

device image data, said source image data assigning to pixels
colors in a source color space, which is also diffusion color

space, said diffusion color space being different from and having higher resolution than said device color space, said method comprising the steps of:

a) causing said device to produce some colors having
known device coordinates in said device color space;
b) color analyzing each color produced in step a to
determine their source coordinates in said source color

space;
c) assigning to each source coordinate determined in
step b the corresponding device coordinate produced in step

a;
d) for each unassigned source coordinate not
assigned in step c error diffusion is advised by:


1) finding a closest source coordinate from those
assigned in step c,
2) determining the corresponding device coordinate of
the corresponding color produced in step a,
3) determining a vector error between the unassigned
source coordinate and the closest assigned source coordinate,
4) adding the vector error determined in d3 to the 
unassigned source coordinate to obtain an adjusted source

coordinate,
5) repeating, replacing said unassigned source coordinate by said adjusted source coordinate, steps d1 through d4 sufficiently so that
the respective average device coordinate resulting from

iterations of step d2 converges, and
6) assigning said respective average device
coordinate to said unassigned source coordinate;
e) for each pixel of said image, converting its color
in said source colour space directly to the colour to which

it is assigned in said device colour space by steps c or
d6; and, for each pixel,
f) producing said pixel with the device colour
space colour assigned in step e.
</CLAIMS>
</TEXT>
</DOC>
