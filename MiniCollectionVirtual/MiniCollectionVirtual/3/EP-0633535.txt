<DOC>
<DOCNO>EP-0633535</DOCNO> 
<TEXT>
<INVENTION-TITLE>
IMAGE PROCESSOR
</INVENTION-TITLE>
<CLASSIFICATIONS>G06T520	G06T520	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G06T	G06T	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G06T5	G06T5	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
This processor comprises 
a spacial filter calculating unit in 

which the coefficients of i lines 
and j columns are determined, 

data on the pixels of an input 
image is inputted in a state of 

a pixel matrix of i lines and j 
columns, and the coefficients corresponding 

to the respective inputted 
pixel data are multiplied 

by each other; a memory having 
a plurality of coefficient registers 

corresponding to the coefficients 
set in the spatial filter calculating 

unit; a unit for creating coefficient 
selection information which represents 

the coefficients to be fetched 
from the coefficient registers and 

changing the content of the information 
in accordance with the 

pixel data; and a coefficient selecting 
unit for fetching the coefficients 

corresponding to the coefficient 
selection information from 

the coefficient registers and setting 
the coefficients in the spacial 

filter calculating unit. 

</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
OLYMPUS OPTICAL CO
</APPLICANT-NAME>
<APPLICANT-NAME>
OLYMPUS OPTICAL CO., LTD.
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
ARAMAKI SHINJI
</INVENTOR-NAME>
<INVENTOR-NAME>
KOBAYASHI SHIGERU
</INVENTOR-NAME>
<INVENTOR-NAME>
MASUYAMA HIDEYUKI
</INVENTOR-NAME>
<INVENTOR-NAME>
SHIMIZU KAZUO
</INVENTOR-NAME>
<INVENTOR-NAME>
ARAMAKI, SHINJI
</INVENTOR-NAME>
<INVENTOR-NAME>
KOBAYASHI, SHIGERU
</INVENTOR-NAME>
<INVENTOR-NAME>
MASUYAMA, HIDEYUKI
</INVENTOR-NAME>
<INVENTOR-NAME>
SHIMIZU, KAZUO
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
The present invention relates to an image processing
apparatus for performing a process (for example,
interpolation, shading, pattern recognition, correction
of gradation, enlarging, reducing) on a region (at
least one pixel) of an input image, by using a spatial
filter.Hitherto known is an image processing apparatus
which has a spatial filter which can be represented by a
matrix of i rows and j columns. The spatial filter used
in the image processing apparatus can have a desired
filtering function, if a given coefficient is set in it.
Depending on the pattern of the coefficient set in it,
the spatial filter can perform a process, such as edge-emphasizing
or noise-removing, on the input image.FIG. 39 shows a spatial filter of the type incorporated
in such an image processing apparatus.The spatial filter shown in FIG. 39 comprises a 3 × 3
matrix. Each row of the matrix has data latch circuits
1 to 3 which are connected in series for sequentially
latching pixel data items for the corresponding line.
The pixel data items latched by the data latch circuits
1 to 3 are supplied to multiplying sections 4 to 6, 
respectively. Each of the sections 4 to 6 multiplies
the pixel data item by a predetermined coefficient. The
coefficients set to the multiplying sections 4 to 6 are
stored in coefficient registers 7 to 9. They are supplied
to the multiplying sections 4 to 6 through coefficient
latch circuits 11 to 13, respectively.Pixel data for the first line is input to the
first-stage line 14. Pixel data for the second line is
input to the second-stage line 15, and pixel data for
the third line to the third-stage line 16. The product
of the pixel value latched by each data latch and the
coefficient stored in the corresponding coefficient register
is input to an adder 17. The adder 17 adds the
nine products input to it, and outputs the sum as the
output of the spatial filter.In the spatial filter of this structure, a frame
image data is input three consecutive lines 14 to 16.
The data is shifted by one pixel in each line. The
pixel data for one line is thereby spatially filtered.In the case of a 3 × 3 matrix filter, the pixel
data processed by a single multiplication-addition operation
represents the pixel located at the center of the
matrix (i.e., the intersection of the second row and the
second column).Upon completion of the processing for one line, the
line data input to the first to third lines 14 to 16 is
shifted upwards or downwards by one line or more lines,
and the image data for one line is processed
</DESCRIPTION>
<CLAIMS>
An image processing apparatus for performing a
plurality of modes of spatial processing on an input image,

comprising:

spatial filtering means (22; 115; 132; 143; 219)comprises means for
storing coefficients arranged in i rows and j columns, means for

receiving pixel data items representing the input image and
arranged in i rows and j columns, means for multiplying each pixel

data item by a corresponding coefficient, thereby to
perform any of a plurality of desired modes of spatial

processing, and extracting a particular frequency component
of the input image;
coefficient storing means (36-40; 64-1 to 64-7) comprises
a plurality of groups (36-40; 64-1 to 64-7) of coefficient

registers (217-1 to 217-8), each of said coefficient
register (217-1 to 217-8) for storing a plurality of coefficients

to be set in said spatial filtering means (22; 115;
132; 143; 219) to achieve one of said plurality of desired

modes of spatial processing, said plurality of groups of
registers means corresponding to i x j coefficients to be set in

said spatial filtering means (22; 115; 132; 143; 219);
selection data generating means (51-53; 133, 137; 153,
154; 216; 216-1, 216-2; 216'; 216", 220) comprising means for generating

coefficient-selecting data representing coefficients to be
read from the coefficient registers means (217-1 to 217-8) of

each group (36-40; 64-1 to 64-7) in accordance with a
desired one of said spatial processing modes and means for changing

the coefficient-selecting data in accordance with the pixel
data items which is to be input to said spatial filtering

means (22; 115; 132; 143; 219); and
coefficient selecting means (41-45; 65-1 to 65-7) comprises means for
receiving the coefficient-selecting data generated by said

selection data generating means (51-53; 133, 137; 153, 154;
216; 216-1, 216-2; 216'; 216", 220), means for reading coefficients

from the coefficient registers (217-1 to 217-8) of each
group (36-40; 64-1 to 64-7) in accordance with the 

coefficient-selecting data, and means for setting the coefficients in
said spatial filtering means (22; 115; 132; 143; 219).
The image processing apparatus according to claim
1, 
characterized in that
:

said selection data generating means (51-53) further comprises
coefficient information storing means (52) and coefficient

reading means (52);
said coefficient information storing means (52) for storing
a plurality of types of coefficient-selecting data items,

each of which is provided for at least one pixel of a
spatial region of the input image, each of said types

corresponding to one of said plurality of spatial
processing modes; and
said coefficient reading means (52) further comprises means for reading the
coefficient-selecting data item corresponding to a pixel

data item to be processed by said spatial filtering means
(22), from said coefficient information storing means (52)

at the same time the input image is supplied to said
spatial filter means (22).
The image processing apparatus according to claim
1, 
characterized in that
:

said spatial filtering means (22) further comprises i x j pixel data
holding sections means (25-29) for holding pixel data items, i x

j coefficient holding sections means (46-50) for holding
coefficients, i x j multiplying sections means (31-35), and an

adder section means (30) for adding data items output from the
multiplying sections means (31-35);
said pixel data holding sections means (25-29) for forming i
parallel lines (21-1 to 21-4), each consisting of j pixel

data holding sections means (25-29) connected in series such that
a pixel data item input to the pixel data holding section

(25) provided at an input end of each line (21-1 to 21-4)
is transferred sequentially to the adjacent pixel data

holding sections (26-29) of the same line; 
said coefficient holding sections means (46-50) being
connected to the corresponding groups of coefficient

registers (36-40), respectively, and associated with said
pixel data holding sections means (25-29), respectively. for

holding the coefficients which have been read from said
groups of coefficient registers (36-40) by said coefficient

selecting means (41-45); and
said multiplying sections means (31-35) being associated with
said pixel data holding sections means (25-29) and said

coefficient holding sections means (46-50), respectively, for
multiplying the pixel data item stored in each of said

pixel data holding sections means (25-29) by the coefficient held
in the coefficient holding section means (46-50) associated with

the pixel data holding section means (25-29).
The image processing apparatus according to claim
3, 
characterized in that
 (i - 1) line buffers means (23) for
delaying the input image by one line being connected to

inputs (25) of the pixel data holding sections means (25-29)
provided at the input ends of said lines (24-1 to 24-4),

respectively, and means to input pixel data items forming a row
to the pixel data holding sections means (25) provided at the

input ends of said lines (24-1 to 24-4).
The image processing apparatus according to claim
2, 
characterized in that
 said coefficient information
storing means (52) has a frame memory means (52) having a

storage capacity corresponding to the input image for
storing the coefficient-selecting data items at addresses

corresponding to the pixels forming the input image.
The image processing apparatus according to claim
1, 
characterized by
 further comprising:

clock signal generating means (134; 155) for supplying
operation clock signals to said spatial filtering means

(132; 143), thereby to cause said spatial filtering means
(132; 143) to perform spatial filtering, and means for changing 

operation clock signals supplied to said spatial filtering
means (132; 143) in accordance with a ratio at which to

enlarge or reduce pixel data which said spatial filtering
means (132; 143) is to process;
memory means (135; 157) for storing results of the
process performed by said spatial filtering means (132;

143); and
control means (136; 156) for controlling writing of

pixel data into, and reading of pixel data from, said
memory means (135; 157),

   wherein said spatial filtering means (132; 143) further comprises means for setting
again the coefficients arranged in i rows and j columns, in

synchronization with the operation clock signals,
means for multiplying those of the pixel data items arranged in i rows

and j columns which are required for interpolation, by the
coefficients corresponding to the pixel data items, and

means for adding these pixel data items, thereby generating new
interpolated data representing one pixel.
The image processing apparatus according to claim
6, 
characterized in that
:

said coefficient storing means (46-49) comprising means for storing a plurality of coefficient patterns for use in enlarging the
image;
said clock signal generating means (134; 155)
comprising means for generating high-speed clock signals when the pixel data

items to be processed by said spatial filtering means (132;
143) belongs to an image region to be enlarged, said high

speed clock signals corresponding to a ratio at which to
enlarge that image region;
said selection data generating means (133, 137; 153,
154) further comprises coefficient information storing means (133; 153) for storing a plurality of image-enlarging coefficient-selecting

data items and means for sequentially setting the plurality
of coefficient patterns for use in enlarging the image, for

that region of the input image which is to be enlarged, and
means for reading the image-enlarging coefficient-selecting data items 

sequentially from said coefficient information storing
means (133; 153) in synchronization with the high-speed

operation clock signals; and
said spatial filtering means (132; 143) further comprises means for performing
filtering in accordance with the coefficient patterns in

synchronization with the high-speed operation clock
signals.
The image processing apparatus according to claim
6, 
characterized in that
:

said clock signal generating means (134; 155)
further comprises means for generating low-speed operating clock signals when the pixel

data items to be processed by said spatial filtering means
(132; 143) belongs to an image region to be reduced, said

low-speed clock signals corresponding to a ratio at which
to reduce that image region;
said spatial filtering means (132; 143) further comprises means for performing
filtering in synchronization with the low-speed operation

clock signals, thereby interpolating a number of pixel data
items which are required to display one line of a reduced

image; and
said control means (136; 156) further comprises means for writing into said memory
means (135; 157) interpolated line data corresponding to

the ratio at which to reduce the image region.
The image processing apparatus according to claim
6, 
characterized in that
:

said clock signal generating means (134; 155)
further comprises means for generating low-speed operating clock signals when the pixel

data items to be processed by said spatial filtering means
(132; 143) belongs to an image region to be reduced, said

low-speed clock signals corresponding to a ratio at which
to reduce that image region;

   said spatial filtering means (132; 143) further comprises means for performing
filtering in synchronization with the low-speed operation

clock signals, thereby interpolating a number of pixel data 
items which are required to display one line of a reduced

image; and
said control means (136; 156) further comprises means for writing into said memory
means (135; 157) all interpolated line data items output

from said spatial filtering means (132; 143) and means for reading some
of the interpolated line data items from said memory means

(135; 157), while removing the remaining interpolated line
data items in accordance with the ratio at which to reduce

the image region.
The image processing apparatus according to claim
6, 
characterized in that
:

said clock signal generating means (134; 155)
further comprises means for generating normal-speed operating clock signals when the

pixel data items to be processed by said spatial filtering
means (132; 143) belongs to an image region to be reduced;

and
said control means (136; 156) further comprises means for writing into said memory
means (135; 157) some of interpolated data items output

from said spatial filtering means (132; 143), while
removing the remaining interpolated data items in

accordance with the ratio at which to reduce the image
region.
The image processing apparatus according to claim
6, 
characterized in that
:

said clock signal generating means (134; 155)
further comprises means for generating normal-speed operating clock signals when the

pixel data items to be processed by said spatial filtering
means (132; 143) belong to an image region to be reduced;

and
said control means (136; 156) further comprises means for writing interpolated data
items output from said spatial filtering means (132; 143)

into said memory means (135; 157), without removing any one
of the interpolated data items, and means for reading some of the

interpolated data items from said memory means (135; 157),
while removing the remaining interpolated line data items 

in accordance with the ratio at which to reduce the image
region.
The image processing apparatus according to claim
1, 
characterized by
 further comprising:

a first image memory means (112) for storing an input image
to be processed;
a memory controller means (114) for reading from said first
image memory pixel data items representing the input image,

and repeatedly reading those of the pixel data items
belonging to an image region to be enlarged or reduced

which define the same line, in accordance with a ratio at
which to enlarge or reduce that image region;
clock signal generating means (125) for changing
operation clock signals to be supplied to said spatial

filtering means (115), in accordance with the ratio at
which to enlarge or reduce that image region, when the

pixel data items to be processed by said spatial filtering
means belongs to that image region; and
a second image memory means (127) for storing the input
image which has been enlarged or reduced by said spatial

filtering means (115).
The image processing apparatus according to claim
1, 
characterized by
 further comprising:

a first image memory means (112) for storing an input image
to be processed;
a first memory controller means (114) for reading pixel data
items representing the input image, from said first image

memory (112);
a second image memory means (127) for storing the input
image processed by said spatial filtering means (115); and
a second memory controller means (126) for writing pixel
data items output from said spatial filtering means (115)

to predetermined addresses in said second image memory
(127), and for writing some of the pixel data items into

said second image memory (127), while removing the 
remaining pixel data items in accordance with a ratio at

which to enlarge or reduce the input image.
The image processing apparatus according to claim

1, 
characterized by
 further comprising:

a first conversion means (213) for converting a color
image signal of an input image to a colorimetric system

signal; and
a second conversion means (221) for converting pixel
data obtained by filtering the colorimetric system signal

by means of said spatial filtering means (219; 215-1, 215-2),
into the original color image signal,

   wherein said spatial filtering means further comprises means for (215-1, 215-2)
receiving the colorimetric system signal from said first

conversion means (213) in the form of pixel data items
arranged in i rows and j columns. and said selection data

generating means (216; 216-1, 216-2) further comprises means for generating coefficient-selecting
data in accordance with a hue parameter which

changes based on the hue of the input image represented by
the colorimetric system signal output from said first

conversion means (213).
The image processing apparatus according to claim
1, 
characterized by
 further comprising:

a first conversion means (213) for converting a color
image signal of an input image to a uniform perceptual

space signal; and
a second conversion means (221) for converting pixel
data obtained by filtering the uniform perceptual space

signal by means of said spatial filtering means (219), into
the original color image signal,

   wherein said spatial filtering means (219) further comprises means for receiving
the uniform perceptual space signal from said first

conversion means (213) in the form of pixel data items
arranged in i rows and j columns, and said selection data

generating means (216) further comprises means for generating coefficient-selecting data
in accordance with a hue parameter which changes based on 

those of pixel data items which forms the uniform
perceptual space signal by said first conversion means

(213).
The image processing apparatus according to claim
1, 
characterized by
 further comprising: a first conversion
means (213) for performing polar coordinate conversion on a

color-different signal contained in a color image signal
representing an input image; and a second conversion means

(221) for converting pixel data obtained by said spatial
filtering means (219) into an original color image signal,

   wherein said spatial filtering means (219)
further comprises means for receiving the pixel data items from said first conversion

means (213) in the form of pixel data items arranged in i
rows and j columns, and said selection data generating

means (216) further comprises means for generating coefficient-selecting data in
accordance with a hue parameter which changes based on a

hue parameter contained in the pixel data subjected to the
polar coordinate conversion in said first conversion means

(213).
The image processing apparatus according to claim
14, 
characterized in that
:

said spatial filtering means (215-1, 215-2) further comprises
first filtering section means (215-1) for receiving pixel data

which is brightness data contained in the colorimetric
system signal output from said first conversion means

(213), and a second filtering section means (215-2) for receiving
pixel data which is chroma data contained in the

colorimetric system signal output from said first
conversion means (213); and
said selection data generating means (216-1, 216-2,
220) further comprises means for comparing a plurality of preset reference values

with the hue parameter output from said first conversion
means (213), thereby to generate coefficient-selecting data

based on the reference value more similar to the hue
parameter than any other reference value.
The image processing apparatus according to claim
17, 
characterized in that
 said selection data generating
means (216-1, 216-2, 220) further comprising a first comparator

(216-1) means for comparing the preset reference values with the
hue parameter output from said first conversion means

(213), thereby to generate coefficient-selecting data
designating a coefficient pattern to be set in the first

spatial filtering section (215-1), and a second comparator
(216-2) means for comparing the preset reference values with the

hue parameter output from said first conversion means
(213), thereby to coefficient-selecting data designating a

coefficient pattern to be set in the second spatial
filtering section (215-2).
The image processing apparatus according to claim
1, 
characterized in that
 said selection data generating
means (216, 220; 216'; 216") further comprising comparator means

(216; 216'; 216") for comparing at least one reference
value with a luminance value of pixel data to be input to

said spatial filtering means (219), said coefficient
storing means (217-1 to 217-4) further comprising coefficient memory

means (217-1, 217-2; 217-1 to 217-4) storing coefficient
data representing a coefficient pattern optimal for a high-luminance

part of the input image and coefficient data
representing a coefficient pattern optimal for a low

luminance part of the input image, said coefficient
selecting means (65-1) further comprises means for generating

coefficient data for the high-luminance or low-luminance
part of the input image in accordance with the result of

comparison performed by said comparator means (216; 216';
216").
The image processing apparatus according to claim
19, 
characterized by
 further comprising reference value
generating means (90) for detecting a luminance value of

the input image and supplying said comparator means (216; 
216'; 216") with a reference value corresponding to the

luminance value detected.
The image processing apparatus according to claim
1, 
characterized by
 further comprising gradation
compressing means (300) for performing gradation

compression on the pixel data output from said spatial
filtering means (219), and 
characterized in that
 said
selection data generating means (216') further comprises comparator means

(216') for comparing at least one preset reference value
with a luminance value of the pixel data to be input to

said spatial filtering means (219).
The image processing apparatus according to claim
21, 
characterized in that
 said gradation compression means
(300) further comprises means for compressing the high-luminance and low-luminance parts

of the input image to a greater degree than any other part
of the input image.
</CLAIMS>
</TEXT>
</DOC>
