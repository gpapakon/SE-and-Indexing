<DOC>
<DOCNO>EP-1215559</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Method and system for time synchronization
</INVENTION-TITLE>
<CLASSIFICATIONS>H04J306	G06F114	H04L2908	H04L2908	H04L2906	H04L2906	H04J306	G06F114	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>H04J	G06F	H04L	H04L	H04L	H04L	H04J	G06F	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>H04J3	G06F1	H04L29	H04L29	H04L29	H04L29	H04J3	G06F1	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
A method for synchronizing a timing device of a client station via a communications network is disclosed. A plurality of packets is sent from a time server to the client station via the communications network. Upon receipt of the plurality of packets at the client station a time indicative of a local time of receipt of the plurality of packets is determined and the plurality of packets are returned to the time server via the communications network. Upon receipt of the plurality of packets at the time server data in dependence upon round trip delay of the packets and variance in packet spacing are determined and compared to threshold values. If the determined data are within the threshold values data indicative of a time correction are determined and sent from the time server to the client station.

</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
CHRYSALIS ITS INC
</APPLICANT-NAME>
<APPLICANT-NAME>
CHRYSALIS- ITS INC.
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
COUILLARD BRUNO
</INVENTOR-NAME>
<INVENTOR-NAME>
COUILLARD, BRUNO
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
This invention relates to time synchronization, and in particular to a method for synchronizing a time clock of a client station via a communications network having an unknown transmission time.Most conventional computer systems maintain an internal clock to keep track of the time of day. Accurate time of day measurements are required in a wide variety of applications such as managing and tracking electronic mail, timing back-ups of data on a network, synchronizing communications between clients and servers, managing multimedia teleconferences, and assigning a correct time to documents or transactions. Since the internal clock is not perfectly accurate, as time goes by the internal time maintained by the internal clock diverges from the external time with which the internal clock was previously synchronized. This time divergence is sometimes called "clock drift". Typically the internal clock's time drifts away from the time as a linear function of elapsed time since synchronization. To prevent the clock drift from getting too large, from time to time the internal clock is resynchronized with the external reference time. Time services exist which provide accurate time information using an "atomic clock". One well-known time service is WWV, which broadcasts a Universal Time Signal. Various solutions have been developed to synchronize the time clock of a computer system. A simple method is for a user of the computer system to manually adjust the clock whenever the clock appears to have drifted. This technique, however, is both inconvenient for the user and subject to its own inaccuracies.Also, time sources such as WWV occasionally introduce "leap seconds" to synchronize their time with the motions of the planet Earth. To prevent error from accumulating due to drift and leap seconds, it is particularly desirable to synchronize the internal clock of a computer system with the external reference time automatically without intervention of a user or network administrator.Some prior art methods for synchronizing the internal clock employ a round trip scheme in which a computer system sends a synchronization request to a time service and the time service responds by sending a synchronization message. The inaccuracy of time provided to a computer system is directly related to the total elapsed time for the round trip sequence of messages. Thus, the precision with which clock synchronization can be achieved is limited by the time required for the round trip sequence.A particular type of round trip synchronization,
</DESCRIPTION>
<CLAIMS>
A method of synchronizing a timing device (4) of a client station (1) comprising the steps of:

a) sending (101) a plurality of packets, each packet being sent at a predetermined time having a predetermined temporal spacing from other packets, from a time server (3) to the client station (1) via a communications network (2);
b) receiving (102) the plurality of packets at the client station (1);
c) determining a time indicative of a local time of receipt of each packet of the plurality of packets at the client station (1) and storing (104) time data in dependence thereon;
d) returning (106) the plurality of packets to the time server (3) via the communications network (2);
e) determining (109) a time indicative of a local time of receipt (107) of each packet of the plurality of packets at the time server (3);
f) determining (111) synchronisation data in dependence upon round trip delay of the packets and variance in temporal spacing of received packets;
g) comparing the synchronisation data to threshold values (113);
h) determining (117) data indicative of a time correction if the determined synchronization data of step f) are within the threshold values the determining being based on said round trip delays of the packets;
i) sending (119) a signal comprising the data indicative of a time correction from the time server (3) to the client station (1).
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 1, wherein the plurality of packets are sent at predetermined times such that temporal spacing between consecutive packets are a same.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 1, comprising the steps of:

j) receiving the signal comprising the data indicative of a time correction at the client station (1); and,
k) synchronizing the timing device (4) of the client station (1) in dependence upon the received signal.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 1, wherein during the step a) the time server (3) sends a plurality of packets, each packet being sent at a predetermined time, to each of a plurality of client stations (1) via the communications network (2).
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 1, wherein each packet comprises a binary signal of m bits, the binary signal comprising an identifier of the packet and an identifier of the time server (3).
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 5, wherein the identifier of the time server (3) comprises at least a random number.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 5, comprising the step of:

attaching to at least one of the packets authentication data for identifying the client station (1), the data attached by the client station (1).
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 5, comprising the steps of:

comparing upon receipt of the packets at the time server (3) the identifier of the time server (3) with a reference identifier; and,
if the comparison result is not indicative of a match, repeating steps a) to e).
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 7, comprising the steps of:

comparing upon receipt of the packets at the time server (3) the authentication data identifying the client station (1) with reference authentication data; and,
if the comparison result is not indicative of a match, repeating steps a) to e).
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 1, wherein step i) comprises the step of:

signing securely at the time server (3) the signal comprising the data indicative of a time correction.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 10, comprising the steps of:

receiving the signal comprising the data indicative of a correct time at the client station (1);
verifying the signature of the time server (3); and,
if the signature is verified, synchronizing the timing device (4) of the client station (1) in dependence upon the received signal.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 5,
 comprising the step of:

time-stamping each of the packets at the client station (1) by adding time data indicative of the client station (1)'s timing device (4) time at the time instance of receipt of each of the packets.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 1, comprising the step of:

providing a warning signal if the round trip delays of the packets are not within a threshold value, the threshold value being determined using a statistical estimate of round trip delays of the communications network (2).
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 8, wherein step h) comprises the steps of:

determining a round trip delay value for each of the plurality of packets;
determining a minimum round trip delay value; and,
calculating data indicative of a correct time by adding half of the minimum round trip delay value to the predetermined time the packet having the minimum round trip delay value has been sent by the server.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 1, wherein step h) comprises the steps of:

determining a round trip delay value for each of the plurality of packets;
determining a minimum round trip delay value by interpolating using at least two round trip delay values;
determining an interpolated predetermined time corresponding to the interpolated round trip delay value; and,
calculating data indicative of a correct time by adding half of the interpolated minimum round trip delay value to the interpolated predetermined time.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 12, wherein step h) comprises the steps of:

determining a round trip delay value for the first packet of the plurality of packets;
determining for each packet following the first packet a first time difference between the first packet and the each packet at the time sent from the server;
determining for the each packet following the first packet a second time difference between the first packet and the each packet at the time received at the client station (1);
determining a third time difference by subtracting the second time difference from the first time difference for the each packets;
determining a maximum third time difference and a corresponding packet, the corresponding packet having a minimum travel time from the server to the client station (1);
determining the minimum travel time by subtracting the maximum third time difference from half of the round trip delay value of the first packet; and,
calculating data indicative of a correct time by adding the minimum travel time to the predetermined time of the corresponding packet.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 12, wherein step h) comprises the steps of:

determining a round trip delay value for each of the plurality of packets;
determining a minimum round trip delay value;
determining for each packet a first time difference between the packet having the minimum round trip delay and the each packet at the time sent from the server, wherein time differences of packets sent before the packet having the minimum round trip delay are of negative value;
determining for the each packet a second time difference between the packet having the minimum round trip delay and the each packet at the time received at the client station (1), wherein time differences of packets received before the packet having the minimum round trip delay are of negative value;
determining a third time difference by subtracting the second time difference from the first time difference for the each packets;
determining a maximum third time difference and a corresponding packet, the corresponding packet having a minimum travel time from the server to the client station (1);
determining the minimum travel time by subtracting the maximum third time difference from half of the round trip delay value of the packet having the minimum round trip delay;
calculating data indicative of a correct time by adding the minimum travel time to the predetermined time of the corresponding packet.
A method of synchronizing a timing device (4) of a client station (1) as defined in claim 12, wherein step h) comprises the steps of:

determining a travel time for each of the plurality of packets from the time server (3) to the client station (1), the travel time being the difference between the predetermined time the packet was sent from the server and the local time the packet was received at the client station (1), wherein the time of the client station (1) is within known error bounds;
determining a minimum travel time from the travel times of the plurality of packets; and,
calculating data indicative of a correct time by adding the minimum travel time to the predetermined time of the corresponding packet.
A system of synchronizing a timing device (4) of a client station (1) via a communications
 network (2) comprising:

first processing means connected to the communications network (2) and a time clock; and,
second processing means connected to the communications network (2) and the timing device (4),

wherein the first processing means comprise:

means for sending in real time a plurality of packets, each packet being sent at a predetermined time, via the communications network (2) to second processing means;
means for receiving the plurality of packets from the second processing means in real time;
means for determining in real time a time indicative of a time of receipt of each of the plurality of packets;
means for determining synchronization data in dependence upon round trip delay of the packets and variance in packet temporal spacing and comparing said synchronization data to threshold values;
means for determining data indicative of a correct time in dependence upon time data from the time clock and the data in dependence upon round trip delay of the packets and variance in packet temporal spacing if the determined synchronization data is within the threshold values, and
means for sending a signal comprising the data indicative of a time correction to the second processing means via the communications network (2);

and,

wherein the second processing means comprise:

means for receiving a plurality of packets from the first processing means in real time;
means for determining in real time a time indicative of a time of receipt of each of the plurality of packets;
means for returning the plurality of packets in real time to the first processing means;
means for receiving a signal comprising the data indicative of a time correction from the first processing means; and,
means for synchronizing the timing device (4) in dependence upon the data indicative of the time correction.
A system of synchronizing a timing device (4) of a client station (1) via a communications network (2) as defined in claim 19, the second processing means comprising means for timestamping each of the packets in real time.
A system of synchronizing a timing device (4) of a client station (1) via a communications network (2) as defined in claim 19, the second processing means comprising means for attaching in real time to at least one of the packets an authenticator identifying the client station (1).
A system of synchronizing a timing device (4) of a client station (1) via a communications network (2) as defined in claim 19, the first processing means comprising means for identifying the client station (1) by its authenticator.
A system of synchronizing a timing device (4) of a client station (1) via a communications network (2) as defined in claim 19, the first processing means comprising means for retrieving time data from each time stamped packet.
</CLAIMS>
</TEXT>
</DOC>
