<DOC>
<DOCNO>EP-0650299</DOCNO> 
<TEXT>
<INVENTION-TITLE>
Method of processing luminance levels in a composite image and image processing system applying this method
</INVENTION-TITLE>
<CLASSIFICATIONS>G06T540	G06T500	G06T300	G06T300	G06T100	H04N718	G06T500	H04N5262	H04N5262	G06T540	G06T100	H04N718	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G06T	G06T	G06T	G06T	G06T	H04N	G06T	H04N	H04N	G06T	G06T	H04N	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G06T5	G06T5	G06T3	G06T3	G06T1	H04N7	G06T5	H04N5	H04N5	G06T5	G06T1	H04N7	</CLASSIFICATIONS-FOURTH>
<ABSTRACT>
Digital image processing system with:   - a system of n real fixed cameras (C1,...Ci, Cj,... Cn), the individual fields of view of which merge together for taking a view of a panoramic scene, - an image construction system (GVVB) simulating a moving camera (Cv) called virtual camera, which continuously scans the panoramic scene in order to furnish an arbitrary sub-image thereof, called target image (lv), which is digital and constructed from adjacent source images (I1,...Ii, Ij,... In) from the real cameras, - a luminance equalisation system, including modules (LUT.A, LUT.B) which apply correction laws (Gi, Gj) respectively to the sets (R and F(R)) of the corresponding luminance levels in the parts (Ivi, Ivj) of a digital target image (Iv) which is constructed from two adjacent digital source images (Ii, Ij), in order to equalise these levels according to the relation Gi(R) = Gj[F(R)]
.   Application: monitoring devices, panoramic viewing devices for moving vehicles. 
<
IMAGE
>
</ABSTRACT>
<APPLICANTS>
<APPLICANT-NAME>
PHILIPS ELECTRONICS NV
</APPLICANT-NAME>
<APPLICANT-NAME>
PHILIPS ELECTRONIQUE LAB
</APPLICANT-NAME>
<APPLICANT-NAME>
LABORATOIRES D'ELECTRONIQUE PHILIPS S.A.S.
</APPLICANT-NAME>
<APPLICANT-NAME>
PHILIPS ELECTRONICS N.V.
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
FLORENT RAOUL
</INVENTOR-NAME>
<INVENTOR-NAME>
LELONG PIERRE
</INVENTOR-NAME>
<INVENTOR-NAME>
FLORENT, RAOUL
</INVENTOR-NAME>
<INVENTOR-NAME>
LELONG, PIERRE
</INVENTOR-NAME>
</INVENTORS>
<CLAIMS>
An image processing method, including a step for forming a digital
composite image, referred to as a target image (Iv), by means of at least two adjacent

image portions (Ivi, Ivj), formed from adjacent, fixed-field images which are referred to
as source images (Ii, Ij) and are supplied by a system of n fixed, real cameras which

are arranged in such a manner that their individual fields of view merge so as to form a
single wide-angle field of view for recording a panoramic scene, which method is

characterized in that it includes a step for equalizing the different luminance levels of
pixels which are referred to as corresponding pixels, are situated in the adjacent image

portions (Ivi, Ivj) and would have the same luminance level if they were situated in the
same image portion, which step includes the sub-steps of:


determining first and second sets (S, R) of luminance levels of the pixels of the
first and second adjacent image portions (Ivi, Ivj),
determining first and second sub-sets (s, r) of luminance levels of the first and
second sub-sets (Ai, Aj) of corresponding pixels (m'i, m'j) of the first and second

image portions (Ivi, Ivj), respectively,
determining a rule (F) of correspondence between the luminance levels of the
corresponding pixels (m'i, m'j) of the first and second sub-sets (s, r) of luminance

levels,
determining, in dependence on said correspondence rule (F), first and second
overall equalization rules [Gi(R), Gj(S)]
 for the luminance levels of the corresponding
pixels of the first and second sets of luminance levels (S, R),
applying first and second overall luminance equalization rules [Gi(R), Gj(S)] to

the first and second image portions (Ivi, Ivj), respectively.
An image processing method as claimed in Claim 1, characterized in that
the sub-step for determining the correspondence rule (F) includes:

   computing a function which makes the luminance levels of the pixels of the first
sub-set(s) of luminance levels correspond to the luminance levels of the corresponding

pixels of the second sub-set (r) of luminance levels by means of a relation which has an 
order higher than 2 and is formed as : s = F(r).
An image processing method as claimed in Claim 2, characterized in that
the sub-step for determining the first and second luminance sub-sets (r, s) include:


determining the position of a boundary line (L) which is located between two
juxtaposed edges of the two image portions (Ivi, Ivj) formed from two adjacent source

images (Ii, Ij) positioned edge-to-edge,
selecting pixels, arranged in rows or columns parallel to the boundary line and
symmetrically with respect thereto, in the first and second image portions (Ivi, Ivj),

respectively, in order to form the first and second sub-sets (Ai, Aj) of pixels,
classifying the pixels of the first and second sub-sets (ai, Aj) in pairs of pixels
which are said to be corresponding if they have as their coordinates the same coordinate

on an axis parallel to the boundary line and a coordinate which is symmetrical with
respect to that of the boundary line on an axis perpendicular to said boundary line in a

system of axes in the target image (Iv),
forming the first and second sub-sets (s, r) of luminance levels by means of the
first and second pixels of the corresponding pairs (m'i, m'j) of pixels.
An image processing method as claimed in Claim 2, characterized in that
the sub-step for determining the first and second sub-sets of luminance (r, s) includes:


determining an overlapping band (LiLj) of two adjacent image portions (Ivi, Ivj)
formed from two source images (Ii, Ij) with a zone of intersection,
selecting the pixels of the overlapping band which are situated in the first and
second adjacent image portions (Ivi, Ivj) in order to form the first and second sub-sets

(Ai, Aj) of pixels,
classifying the pixels of the first and second sub-sets (Ai, Aj) into pairs of
pixels which are said to be corresponding if they have the same coordinates in a system

of axes in the target image (Iv),
forming the first and second sub-sets (s, r) of luminance levels by means of the
first and second pixels, respectively, of the pairs (m'i, m'j) of corresponding pixels.
An image processing method as claimed in one of the Claims 3 or 4,
characterized in that the sub-step for determining the correspondence rule (F) includes

the execution of an iterative method which is referred to as a thinning-out method and
includes:


a first step for computing a first correspondence function (F) with a first 
representative curve of the form s = F(r) which passes best through the points of a first

cluster of points (N1) formed by the luminance level s(r, s) of the corresponding pixel
pairs,
a second step for computing a second correspondence function (F) with a
second representative curve which passes best through the points of a second cluster of

points (N2) formed by the luminance levels (r, s) of the corresponding pixel pairs,
weighted as a function of their distance from the first representative curve, the lowest

weights being assigned to the points situated furthest from the first representative curve,
and further steps for computing successive correspondence functions (F) with
representative curves which pass best through the clusters of points successively formed

while reducing, upon each step, the weights of the points situated furthest from the
representative curve of the correspondence function computed during the preceding step,

until a representative curve of a function s = F(r) passes substantially through the
remaining points with assigned weights exceeding a predetermined value,
determining the function computed during the last step as the correspondence
rule (F) used to compute the first and second overall equalization rules (Gi, Gj).
An image processing method as claimed in Claim 5, characterized in that
the weights assigned to the points of the clusters situated further than predetermined

distances from the representative curves considered during a step are set to zero so as to
exclude these points from the next computing step.
A method as claimed in one of the Claims 5 or 6, characterized in that the
correspondence rule is a so-called gamma function of the form F(r) = a + br
c
, where r
represents the luminance levels of the first sub-set (r) of luminance levels of the first

sub-set (Ai) of pixels (m'i), and where a, b and c are constants,

and in that it includes a step for determining the constants a, b and c by iteration.
An image processing method as claimed in Claim 7, characterized in that
it includes the determination of the correspondence rule F by a double iteration, in

which the first computing step includes:

a first phase for determining the parameters a, b, c which is carried out by
means of a first stage in which a first value of the parameter c of the exponent is fixed

and the parameters a and b are computed for a first cluster (N1) of pairs of points (r,
s), and later stages in which second, third, ... etc. values of the parameter c of the

exponent are fixed and in which the parameters a and b are computed for the same first 
cluster (N1) of pairs of points (r, s), after which the values of a group of parameters a,

b, c are selected as yielding a first correspondence function (F) such that F(r) = a +
br
c
 passes best through the first cluster (N1) of points (r,s),
a second phase for thinning out in which, during a first step, the points of the
first cluster (N1) which are situated furthest from the representative curve of the

function (F) determined during the first phase are eliminated in order to preserve a
second, thinned-out cluster (N2) of points, and double iteration in which the second

computing step includes:
a first phase for determining the parameters a, b, c which is carried out while
using the value of the parameter c determined during the first step and while selecting

the parameters a, b in such a manner that the function F(r) = a + br
c
 passes best
through the second, thinned-out cluster (N2) of points (r,s),
and a second phase which is carried out by continuing attempts while using the
value of the parameter c around the value determined during the first step until the

function F(r) = a + br
c
 passes best through the remaining points (r, s) whose distance
from the representative curve of this function (F) is less than a predetermined distance.
An image processing method as claimed in one of the Claims 1 to 8,
characterized in that it includes:

   the computing of the first (Gi) and the second (Gj) overall equalization rule as
linear functions of the correspondence rule (F).
An image processing method as claimed in Claim 9, characterized in that
the first overall equalization rule is chosen to be of the form Gi(R) = kF(R) + (1-k)R

and the second overall equalization rule is chosen to be of the form Gj[S] = kS + (1-k)

F
-1
(S), where F is the correspondence rule, k is a constant which takes into account the
proportion of the surface area of one of the image portions (Ivi, Ivj) in the overall target

image (Iv), and R and S are corresponding luminance levels of the first and second sets
(R,S) of luminance levels.
An image processing system, including:

a system for the digitization of images,
a system of n fixed real cameras (C1,...Ci,...Cj,...Cn) which are arranged in
such a manner that their individual fields of view merge so as to form a single wide-angle

field of view for recording a panoramic scene, which cameras supply a series of
adjacent images which are referred to as source images (I1,...Ii, Ij...In), 
an image construction system (GVVB) which simulates a camera, referred to as
a virtual camera (Cv), which continuously scans the panoramic 
scene so as to supply a
sub-image which is referred to as a target image (IV) and is formed by at least two

adjacent image portions (Ivi, Ivj), corresponding to a selected section of the wide-angle
field of view, and constructed from adjacent source images (Ii, Ij),

characterized in that this processing system also includes means for carrying out a
method as claimed in Claim 1, said means including a luminance equalization system

for equalizing overall the different luminance levels of so-called corresponding pixels
which are situated in the adjacent image portions (Ivi, Ivj) and would have the same

luminance level if they were situated in the same image portion, including:

memory modules (MEM.A, MEM.B) for supplying the first and second sets
(S,R) of luminance levels of the pixels of the first and second portions (Ivi, Ivj) of

adjacent images, respectively, and for supplying the first and second sub-sets (s, r) of
luminance levels of the first and second sub-sets (Ai, Aj), respectively, of the

corresponding pixels (m'i, m'j) of the first and second image portions (Ivi, Ivj),
a module (LUT.CALCUL) for computing a rule (F) of correspondence between
the luminance levels of the corresponding pixels (m'i, m'j) of the first and second sub-sets

(s, r) of luminance levels,
a first and a second table module (LUT.A, LUT.B) for applying the first and
second overall equalization rules [Gi(R), Gj(S)]
 in the first and second image portions
(Ivi, Ivj) to the luminance levels of the corresponding pixels of the first and second sets

of luminance levels (S, R), said rules being computed in dependence on said
correspondence rule (F).
A system as claimed in Claim 11, characterized in that for the
construction of the target image (Iv) in the construction system (GVVB) it also includes:

   a control module (CONTROL) which controls the mobile virtual camera (Cv)
by way of 3 parameters:


1) the variation of the panoramic orientation (PAN), referred to as variation of
azimuth, of its optical axis, corresponding to a variation of the orientation parallel to a

horizontal plane of this optical axis which passes through a fixed optical center which is
common to all fixed real cameras and to the mobile virtual camera;
2) the variation of the orientation(TILT), referred to as variation of lie, of its
optical axis, still passing through the fixed optical center, in a vertical plane; 
3) the variation of the focal distance of the virtual camera, enabling the supply
of a more or less enlarged target image,

   and a multiplexing module for selecting, from among all real cameras
(C1,...Cn), the two cameras (Ci, Cj) which correspond to the source images (Ii, Ij)

required to supply the data of the target image portions (Ivi, Ivj) used in the
construction of the target image (Iv).
A system as claimed in one of the Claims 11 and 12, characterized in that
it also includes modules (PART.A, PART.B) for storing processed data of the first and

second target image portions (Ivi, Ivj) and a module (D) for display or recording.
</CLAIMS>
</TEXT>
</DOC>
