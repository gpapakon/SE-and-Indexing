<DOC>
<DOCNO>EP-0617870</DOCNO> 
<TEXT>
<INVENTION-TITLE>
METHOD AND APPARATUS FOR COMPRESSION OF IMAGES.
</INVENTION-TITLE>
<CLASSIFICATIONS>G06T900	G06T900	H03M746	H03M746	H04N1411	H04N1411	</CLASSIFICATIONS>
<CLASSIFICATIONS-THIRD>G06T	G06T	H03M	H03M	H04N	H04N	</CLASSIFICATIONS-THIRD>
<CLASSIFICATIONS-FOURTH>G06T9	G06T9	H03M7	H03M7	H04N1	H04N1	</CLASSIFICATIONS-FOURTH>
<APPLICANTS>
<APPLICANT-NAME>
CARTESIAN PROD INC
</APPLICANT-NAME>
<APPLICANT-NAME>
CARTESIAN PRODUCTS, INC.
</APPLICANT-NAME>
</APPLICANTS>
<INVENTORS>
<INVENTOR-NAME>
MARK PETER B
</INVENTOR-NAME>
<INVENTOR-NAME>
SHIEBER STUART M
</INVENTOR-NAME>
<INVENTOR-NAME>
MARK, PETER, B.
</INVENTOR-NAME>
<INVENTOR-NAME>
SHIEBER, STUART, M.
</INVENTOR-NAME>
</INVENTORS>
<DESCRIPTION>
 Method and Apparatus for Compression of ImagesBackground of the InventionThis invention relates to compression of images, in particular, to compression methods employing symbol matching.A standard 8.5 by 11 inch page, when scanned as a binary image at 300 dots per inch (DPI), comprises over 8,000,000 bits of information — about a megabyte. The same page, when scanned at 200 DPI, the scan rate of fax fine mode, comprises almost half a megabyte of information. Because of the large capacity needed to store such images, some sort of image compression is typically implemented in image storage and transmission devices.One current standard method for binary image compression, in widespread use as the standard for facsimile transmission, is the CCITT-3 standard. This is a lossless binary image compression algorithm based on Huffman encoding of a run-length encoding of the image. The CCITT-3 standard typically compresses an image by an order of magnitude by taking into account first-order statistical regularities in the lengths of runs. Thus, a 300 DPI image may be compressed from a megabyte to 100 kilobytes.Symbol matching can be used to increase compression ratios for binary images which consist primarily of machine-printed text. Such text is characterized by many small regions of connected black pixels, representing characters, surrounded by white pixels. A typical document might use only a few hundred different characters representing the letters of the alphabet in upper- and lowercase in a few different type faces (e.g., Times and Helvetica ) and type styles (e.g., plain, bold, italics). In compression techniques employing symbol matching, similar characters are grouped, and their description as an array of black pixels is represented only once as a template. The entire binary image is represented as a sequence of templates along with references to their positions within the image. In this way, the representation contains far fewer bits than the original image. The amount of compression that can be achieved using symbol matching depends on how many characters are matched, how the templates are represented, and how the character positions are represented.Unfortunately, characters that appear similar to the human eye are not usually pixel- identical. The printing method, subsequent photocopying, and, most importantly, the scanning process itself introduce error into the original image. An example is illustrated in Fig. 1, which depicts two instances of the letter "b" in 12 point Courier scanned at 200 DPI.
</DESCRIPTION>
<CLAIMS>
 Claims
1. A method for compressing images comprising: precompressing a first representation of an image, said first representation based on pixels of a first type and a second type, to generate a precompressed representation of said image, identifying symbols in said precompressed representation of said image, comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, and generating a compressed representation of said image including a representation υf templates, and an indication of a location and a template for symbols in said image.
2. The method of claim 1 wherein said first representation of an image is precom¬ pressed by run-length encoding.
3. The method of claim 2 wherein said first representation is based on rows and columns of pixels, and symbols are identified by associating runs of said first type of pixel in adjacent rows of said precompressed representation which have at least one pixel of said first type in the same column or in the same or adjacent columns.
4. A method for compressing images comprising: identifying symbols in a first representation of an image, comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, wherein said library is augmented during image compression by storing in said library symbols for which no matching template is found as new templates, and wherein templates are defined by a representation determined by a plurality of the symbols which match, and generating a compressed representation of said image including a representation of templates, and an indication of a location and a template for symbols in said image.
5. The method of claim 4 wherein each template is defined by a unique spatial distri¬ bution of pixels, said distribution determined by the distributions of pixels of a plurality of the symbols which match said template.
6. The method of claim 5 wherein the distribution of pixels defining a template is determined by averaging the distributions of pixels of a plurality of the symbols which match said template.
7. The method of claim 5 wherein the distribution of pixels defining a template is determined by taking one symbol matching the template and changing a pixel in that symbol only if more than a predetermined fraction of the other symbols matching the template disagree with that pixel. 


 8. A method for compressing images comprising: identifying symbols in a first representation of an image. comparing a plurality of identified symbols to each-of at least one template in a library of templates to match identified symbols to templates, said comparing step including iden¬ tifying error locations, performing at least one test on said error locations and on other global features of the symbol and the template, and declaring a match between a symbol and a template only if all of the tests in at least one of a set of predetermined groups of tests are passed, and generating a compressed representation of said image including a representation of templates, and an indication of a location and a template for symbols in said image.
9. The method of claim 8 wherein a match is declared only if every test in said at least one test is passed.
10. The method of claim 8 wherein said first representation is based on rows and columns of pixels of a first type and a second type, said comparing step including identifying error pixel locations which have a pixel of said first type in only said symbol or said template, but not both, and performing at least one test on said error pixel locations and other global features of the symbol and the template, a match between a symbol and a template being declared only if all of the tests in at least one of a set of predetermined groups of tests are passed.
11. The method of claim 10 wherein said error locations are run-length encoded.
12. The method of claim 10 wherein one of said at least one test is passed if the distance between each error pixel location and the nearest pixel of the first type in the template or symbol having a pixel of the second type at the error pixel location is less than a predetermined value.
13. The method of claim 10 wherein one of said at least one test is passed if the distance between each error pixel location and the nearest pixel of the second type in the template or symbol having a pixel of the first type at the error pixel location is less than a predetermined value.
14. The method of claim 10 wherein one of said at least one test depends on the sizes, shapes, and orientations of contiguous groups of error pixels in some error map.
15. The method of claim 14 wherein one of said at least one test is passed if all contiguous groups of error pixel locations are smaller than predetermined sizes and shapes.
16. The method of claim 14 wherein one of said at least one test is passed if inferred shifts of the symbol relative to the template are consistent.
17. The method of claim 16 wherein shifts are inferred from the sizes, shapes, and orientations of contiguous groups of error pixel locations and their relation to adjacent 


pixels.
18. The method of claim 17 wherein shifts are inferred from triangles of pixeis in the template and symbol error maps such that the inferred shift is towards or away from the fourth pixel in the square bounding the triangle depending on whether said fourth pixel has the same or different parity, respectively, as the triangle pixels in the template.
19. The method of claim 10 wherein one of said at least one test is passed if the difference in heights between a template and a symbol is less than a predetermined value.
20. The method of claim 10 wherein one of said at least one test is passed if the difference in widths between a template and a symbol is less than a predetermined value.
21. The method of claim 10 wherein one of said at least one test is passed if the ratio of the number of pixels of the first type in the symbol and the number of pixels of the first type in the template is within a predetermined range.
22. The method of claim 10 wherein one of said at least one test is passed if the ratio of the number of error pixel locations to the number of pixels of the first type in said template or said symbol, or the minimum or maximum of the two, is less than a predetermined value.
23. The method of claim 10 wherein one of said at least one test is passed if the ratio of the number of error pixel locations to the number of pixels of the first type adjacent to a pixel of said second type in said template or said symbol, or the minimum or maximum of the two, is less than a predetermined value.
24. The method of claim 8, 9, or 10 wherein at least one of said at least one test depends on symbol size.
25. A method for compressing images comprising: identifying symbols in a first representation of an image, comparing a plurality of identified symbols to each of at least one template in a library of templates to match identified symbols to templates, wherein each said template is defined by a representation based on a spatial distribution of pixels of a first type, and generating a compressed representation of said image including a representation of templates, and an indication of a location and a template for symbols in said image, wherein the representation of a plurality of said templates is a representation of the boundary of the spatial distribution of pixels of the first type for the templates.
26. A method for compressing images comprising: identifying symbols in a first represeir.ation of an image, comparing a plurality of identified symbols to each of at least one template in a library of templates to match identified symbols to templates, and 


 generating a compressed representation of said image including a representation of templates, and an indication of a location and a template for symbols in said image, wherein the representation of a plurality of said templates comprises a reference to a frame template for defining an outer boundary of said template and a list of hole templates with associated positions within said irame template for defining any inner boundaries of said template.
27. The method of claim 26 wherein said frame templates and hole templates are represented by representations of the boundary of said frame templates and hole templates.
28. A method for compressing images comprising: identifying symbols in a first representation of an image, comparing a plurality of identified symbols to each of at least one template in a library of templates to match identified symbols to templates, wherein the templates are indexed in said library according to template features, and wherein said step of comparing proceeds according to the index, whereby those templates more likely, based on features, to match a symbol are compared to the symbol before templates less likely to match, and those templates whose indexed features indicate that the likelihood of a match falls below a predetermined threshold are not compared, and generating a compressed representation of said image including a representation of templates, and an indication of a location and a template for symbols in said image.
29. A method for compressing images comprising: identifying symbols in a first representation of an image, comparing a plurality of identified symbols to each of at least one template in a library of templates to match identified symbols to templates, generating a compressed representation of said image including a representation of templates, and an indication of a location and a template for symbols in said image, and reducing the resolution of the representation of a plurality of templates.
30. The method of claim 1, 2, or 3 wherein each template is defined by a unique spatial distribution of pixels, said distribution determined by the distributions of pixels of a plurality of the symbols which match said template.
31. The method of clai 4 and 5 wherein said comparing step includes identifying error locations, performing at least one test on said error locations and on other global features of the symbol and the template, and declaring a match between a symbol and a template only if all of the tests in at least one of a set of predetermined groups of tests are passed.
32. The method of claim 1, 2, or 3 wherein said comparing step includes identifying error pixel locations which have a pixel of said first type in only said symbol or said 


template, but not both, and performing at least one test on said error pixel locations and on other global features of the symbol and the template, a match between a symbol and a template being declared only if all of the tests in at least one of a set of predetermined groups of tests are passed.
33. The method of claim 1. 2. 3, 4, 5, 8, 9. or 10 wherein said first representation is based on pixels of a first type and a second type, and the representation of a plurality of said templates is a representation of the boundary of the spatial distribution of pixels of the first type for the template.
34. The method of claim 1, 2, 3, 4, 5, 8, 9. or 10 wherein the representation of each said template comprises a reference to a frame template for defining an outer boundary of said template and a list of hole templates with associated positions within said frame template for defining any inner boundaries of said template.
35. The method of claim 1 , 2, 3, 4, 5, 8, 9, 10, 25, or 26 wherein the templates are indexed in said library according to template features, and wherein said step of comparing proceeds according to the index, whereby those templates more likely, based on features, to match a symbol are compared to the symbol before templates less likely to match, and those templates whose indexed features indicate that the likelihood of a match falls below a predetermined threshold are not compared.
36. The method of claim 1, 2, 3, 4, 5, 8, 9, 10. 25. 26, or 28 further comprising reducing the resolution of the representation of a plur: ;f templates.
37. The method of any of claims 1 , 2, 3, 4, 5, 8, y, ±0, 25, 26, 28, or 29 wherein said compressed representation of said image includes a plurality of data streams, and wherein at least one of said streams is further compressed.
38. The method of any of claims 1, 2, 3, 4, 5, 8, 9, 10, 25, 26, 28, or 29 wherein said compressed representation of said image includes a template stream, a template reference stream, and row and column position streams, and wherein at least one of said streams is further compressed.
39. The method of any of claims 1 , 2, 3, 4, 5, 8, 9, 10, 25, 26, 28, or 29 further comprising splitting templates comprising a region smaller than a predetermined size and shape into more than one template.
40. The method of claim 39 further comprising comparing templates formed by splits to other templates and merging templates formed by splits which match another template with that template.
41. The method of any of claims 1, 2, 3. 4. 5, 8, 9, 10. 25, 26, 28, or 29 further comprising eliminating symbols smaller than predetermined sizes and shapes.
42. The method of any of claims 1 , 2, 3. 4, 5, 8, 9, 10, 25, 26, 28, or 29 wherein the 


 indications of locations for symbols in said image are represented by the difference between the actual offset between a given symbol and a preceding symbol and a standard offset for the symbol pair defined by said given symbol and preceding symbol.
43. The method of claim 42 wherein said standard offset is the offset last seen for the symbol pair.
44. The method of claim 42 wherein said standard offset is the most frequently seen offset for the symbol pair.
45. The method of claim 42 wherein the difference between the standard offset and the actual offset is determined at a lower resolution than the resolution of the first repre¬ sentation of said image.
46. The method of any of claims 1, 2, 3, 4, 5, 8, 9, 10, 25, 26, 28, or 29 further comprising determining approximate reading order of said symbols and generating said compressed representation of said image according to said reading order.
47. The method of claim 46 wherein said reading order is determined by locating symbols on a single line and sorting the symbols.
48. The method of claim 47 wherein the symbols on a line are determined by using a beam to search along the line, the size of said beam varying according to the size of one or more adjacent symbols.
49. The method of claim 48 wherein bounds on the size of the beam are imposed.
50. The method of any of claims 1, 2, 3, 4, 5, 8, 9, 10, 25, 26, 28, or 29 applied to an image transmission system.
51. The method of any of claims 1, 2, 3, 4, 5, 8, 9, 10, 25, 26, 28, or 29 applied to a facsimile transmission system.
52. The method of any of claims 1. 2, 3, 4, 5, 8, 9, 10, 25, 26, 28, or 29 applied to an image enhancement system.
53. The method of any of claims 1, 2, 3, 4, 5, 8, 9, 10, 25, 26, 28, or 29 applied to an image storage system.
54. Apparatus for compressing images comprising: input means for accepting a first representation of an image, and processing means for a) precompressing said first representation of said image to generate a precompressed representation of said image, b) identifying symbols in said precompressed representation of said image, c) comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, and 


 d) generating a compressed representation of said image including a representation of templates, and an indication of a location and a template corresponding to symbols in said image.
55. Apparatus for compressing images comprising: input means for accepting a first representation of an image, and processing means for a) identifying symbols in said first representation of said image, b) comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, wherein said library is aug¬ mented during image compression by storing in said library symbols for which no matching template is found as new templates, and wherein templates are defined by representations determined by a plurality of the symbols which match, and c) generating a compressed representation of said image including a representation of templates, and an indication of a location and a template corresponding to symbols in said image.
56. Apparatus for compressing images comprising: input means for accepting a first representation of an image, and processing means for a) identifying symbols in said first presentation of said image, b) comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, said comparing step in¬ cluding identifying error locations, performing at least one test on said error locations and on other global features of the symbol and the template, and declaring a match between a symbol and a template only if all of the tests in at least one of a set of predetermined groups of tests are passed, and c) generating a compressed representation of said image including a representation of templates, and an indication of a location and a template corresponding to symbols in said image.
57. Apparatus for compressing images comprising: input means for accepting a first representation of an image, and processing means for a) identifying symbols in said first representation of said image, b) comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, wherein each said template is defined by a representation based on a spatial distribution of pixels of a first type, and 


 c) generating a compressed representation of said image including a representation of templates, and an indication of a location and a template corresponding to symbols in said image, wherein the representation of a plurality of said. templates is a representation of the boundary of the spatial distribution of pixels of the first type for the templates.
58. Apparatus for compressing images comprising: input means for accepting a first representation of an image, and processing means for a) identifying symbols in said first representation of said image, b) comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, and c) generating a compressed representation of said image including a representation of templates, and an indication of a location and a template corresponding to symbols in said image, wherein the representations of a plurality of said templates comprise a reference to a frame template for defining an outer boundary of the template and a list of hole templates with associated positions within said frame template for defining any inner boundaries of said template.
59. Apparatus for compressing images comprising: input means for accepting a first representation of an image, and processing means for a) identifying symbols in said first representation of said image, b) comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, wherein the templates are indexed in said library according to template features, and wherein said step of comparing proceeds according to the index, whereby those templates more likely, based on features, to match a symbol are compared to the symbol before templates less likely to match, and those templates whose indexed features would preclude a match are not compared, and c) generating a compressed representation of said image including a representation of templates, and an indication of a location and a template corresponding to symbols in said image.
60. Apparatus for compressing images comprising: input means for accepting a first representation of an image, and processing means for a) identifying symbols in said first representation of said image, b) comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to a template, 


 c) generating a compressed representation of said image including a representation of templates, and an indication of a location and a template corresponding to symbols in said image, and d) reducing the resolution of the representations of a plurality of the templates.
61. The apparatus of any of claims 54-60 further comprising output means for pro¬ viding said compressed representation of said image.
62. The apparatus of any of claims 54-60 wherein said input means is a scanner.
63. The apparatus of claim 62 wherein said output means is a modem.
64. A method for compressing images comprising: precompressing a first representation of an image, said first representation based on pixels of a first type and a second type, to generate a precompressed representation of said image, identifying symbols in said precompressed representation of said image, comparing a plurality of identified symbols to each of at least one template from a library of templates to match identified symbols to templates, and generating a compressed representation of said image including an indication of a location and a template for symbols in said image.
65. The method of claim 64 wherein said first representation of an image is precom¬ pressed by run-length encoding.
66. The method of claim 65 wherein said first representation is based on rows and columns of pixels, and symbols are identified by associating runs of said first type of pixel in adjacent rows of said precompressed representation which have at least one pixel of said first type in the same column or in the same or adjacent columns.
67. A method for compressing images comprising: identifying symbols in a first representation of an image, comparing a plurality of identified symbols to each of at least one template in a library of templates to match identified symbols to templates, said comparing step including iden¬ tifying error locations, performing at least one test on said error locations and on other global features of the symbol and the template, and declaring a match between a symbol and a template only if all of the tests in at least one of a set of predetermined groups of tests are passed, and generating a compressed representation of said image including an indication of a location and a template for symbols in said image.
68. The method of claim 67 wherein a match is declared only if every test in said at least one test is passed. 


 69. The method of claim 67 wherein said first representation is based on rows and columns of pixels of a first type and a second type, said comparing step including identifying error pixel locations which have a pixel of said first type in only said symbol or said template, but not both, and performing at least one test on said error pixel locations and other global features of the symbol and the template, a match between a symbol and a template being declared only if all of the tests in at least one of a set of predetermined groups of tests are passed.
70. The method of claim 69 wherein said error locations are run-length encoded.
71. The method of claim 69 wherein one of said at least one test is passed if the distance between each error pixel location and the nearest pixel of the first type in the template or symbol having a pixel of the second type at the error pixel location is less than a predetermined value.
72. The method of claim 69 wherein one of said at least one test is passed if the distance between each error pixel location and the nearest pixel of the second type in the template or symbol having a pixel of the first type at the error pixel location is less than a predetermined value.
73. The method of claim 69 wherein one of said at least one test depends on the sizes, shapes, and orientations of contiguous groups of error pixels in some error map.
74. The method of claim 73 wherein one of said at least one test is passed if all contiguous groups of error pixel locations are smaller than predetermined sizes and shapes.
75. The method of claim 73 wherein one of said at least one test is passed if inferred shifts of the symbol relative to the template are consistent.
76. The method of claim 75 wherein shifts are inferred from the sizes, shapes, and orientations of contiguous groups of error pixel locations and their relation to adjacent pixels.
77. The method of claim 76 wherein shifts are inferred from triangles of pixels in the template and symbol error maps such that the inferred shift is towards or away from the fourth pixel in the square bounding the triangle depending on whether said fourth pixel has the same or different parity, respectively, as the triangle pixels in the template.
78. The method of claim 69 wherein one of said at least one test is passed if the difference in heights between a template and a symbol is less than a predetermined value.
79. The method of claim 69 wherein one of said at least one test is passed if the difference in widths between a template and a symbol is less than a predetermined value.
80. The method of claim 69 wherein one of said at least one test is passed if the ratio of the number of pixels of the first type in the symbol and the number of pixels of the first type in the template is within a predetermined range. 


 81. The method of claim- 69 wherein one of said at least one test is passed if the ratio of the number of error pixel locations to the number of pixels of the first type in said template or said symbol, or the minimum or maximum of the two, is less than a predetermined value.
82. The method of claim 69 wherein one of said at least one test is passed if the ratio of the number of error pixel locations to the number of pixels of the first type adjacent to a pixel of said second type in said template or said symbol, or the minimum or maximum of the two, is less than a predetermined value.
83. The method of claim 67, 68, or 69 wherein at least one of said at least one test depends on symbol size.
84. A method for compressing images comprising: identifying symbols in a first representation of an image, comparing a plurality of identified symbols to each of at least one template in a library of templates to match identified symbols to templates, wherein the templates are indexed in said library according to template features, and wherein said step of comparing proceeds according to the index, whereby those templates more likely, based on features, to match a symbol are compared to the symbol before templates less likely to match, and those templates whose indexed features indicate that the likelihood of a match falls below a predetermined threshold are not compared, and generating a compressed representation of said image including an indication of a location and a template for symbols in said image. 

</CLAIMS>
</TEXT>
</DOC>
